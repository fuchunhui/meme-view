var Fe=Object.defineProperty,be=Object.defineProperties;var $e=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ae=(a,e,s)=>e in a?Fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,P=(a,e)=>{for(var s in e||(e={}))Ce.call(e,s)&&ae(a,s,e[s]);if(te)for(var s of te(e))De.call(e,s)&&ae(a,s,e[s]);return a},ne=(a,e)=>be(a,$e(e));import{a as we,d as B,r as F,o as h,c as b,F as W,b as le,e as y,t as M,n as X,f as z,w as Be,g as Y,i as se,h as H,j as $,u as g,p as oe,k as ke,l as ue,m as Ee,q as Ie}from"./vendor.47fcb162.js";const Ae=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const r of u.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&t(r)}).observe(document,{childList:!0,subtree:!0});function s(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerpolicy&&(u.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?u.credentials="include":n.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function t(n){if(n.ep)return;n.ep=!0;const u=s(n);fetch(n.href,u)}};Ae();const re={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},Le=()=>"https://imeme.vercel.app";var Te=a=>async(e={},s={})=>{const{url:t,method:n}=a,u=Le();return we.request({withCredentials:!1,url:u+t,method:n,[n==="get"?"params":"data"]:e}).then(r=>{const d=r.data;return(s==null?void 0:s.stream)?r:d.errNo===0?d.data:Promise.reject(d)}).catch(r=>Promise.reject(r))};const N={};for(const a in re)N[a]=Te(re[a]);const Me={class:"side"},Ve={class:"side-content-title"},Pe=["onClick"],ze=B({emits:["change"],setup(a,{emit:e}){const s=F([]),t=F(""),n=()=>{N.getCatalog({}).then(r=>{s.value=r})},u=(r,d)=>{t.value=d.mid,e("change",P({type:r},d))};return n(),(r,d)=>(h(),b("div",Me,[(h(!0),b(W,null,le(s.value,_=>(h(),b("div",{key:_.id,class:"side-content"},[y("p",Ve,M(_.text),1),(h(!0),b(W,null,le(_.children,c=>(h(),b("div",{key:c.mid,class:X({"side-content-cell":!0,"side-content-cell-active":t.value===c.mid}),onClick:p=>u(_.type,c)},M(c.title),11,Pe))),128))]))),128))]))}});var ie=(a,e)=>{for(const[s,t]of e)a[s]=t;return a};const Ne=B({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){const{label:e}=z(a);return{localLabel:e}}});function Re(a,e,s,t,n,u){return h(),b("button",{class:X(["meme-button",{disabled:a.disabled}])},M(a.localLabel),3)}var J=ie(Ne,[["render",Re]]);const Se=B({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:e}){const s=F(null),t=u=>{e("update:modelValue",u.target.value)};return{input:s,blur:u=>{t(u),e("blur")}}}}),je=["title","value"];function Ue(a,e,s,t,n,u){return h(),b("input",{ref:"input",class:X(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:e[0]||(e[0]=(...r)=>a.blur&&a.blur(...r)),onKeyup:e[1]||(e[1]=Be(r=>{var d;return(d=a.input)==null?void 0:d.blur()},["enter"]))},null,42,je)}var R=ie(Se,[["render",Ue]]);const Oe=500,qe=300;B({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Oe},interval:{type:Number,default:qe}},created(){this.showChange(this.show)},setup(a){const{show:e,interval:s,min:t}=z(a),n=F(e.value);let u,r=0;const d=()=>{const p=new Date().getTime()-r;p>t.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(t.value-p,0))},_=c=>{c?s.value===0?(n.value=!0,r=new Date().getTime()):u=window.setTimeout(()=>{n.value=!0,r=new Date().getTime()},s.value):(clearTimeout(u),d())};return Y(e,()=>{_(e.value)}),{localShow:n,showChange:_}}});const Ge={class:"meme-radio"},Ke=["name","value","checked"],We={class:"meme-radio-label"},ce=B({props:{label:null,name:null,value:null,checked:null},emits:["toggle"],setup(a,{emit:e}){const s=t=>{e("toggle",t)};return(t,n)=>(h(),b("label",Ge,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:n[0]||(n[0]=u=>s(a.value))},null,40,Ke),y("span",We,M(a.label),1)]))}});const Xe={class:"meme-file-upload"},Ye={class:"file-button"},He=y("i",{class:"file-glyphicon"},null,-1),Je=y("span",null,"UPLOAD FILE",-1),Ze=y("i",{class:"file-tips"},"Drop files here to upload",-1),Qe=[Ze],et=B({emits:["change"],setup(a,{emit:e}){const s=l=>{const i=l.target.files;if(!i)return!1;c(i)},t=l=>{l.stopPropagation(),l.preventDefault()},n=l=>{l.stopPropagation(),l.preventDefault()},u=l=>{l.stopPropagation(),l.preventDefault();const i=l.dataTransfer.files;c(i)},r=l=>{l.stopPropagation(),l.preventDefault();const i=l.clipboardData.files;c(i)},d=2*1024*1024,_=/^image\//,c=l=>{if(l.length!==1)return p("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const i=l[0],{name:S,size:j,type:A}=i;if(!_.test(A))return p(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${A}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;if(j>d)return p("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52362M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const L=new FileReader;L.onload=E=>{const V=E.target.result;k(S,V)},L.onerror=()=>{p(L.error.message)},L.readAsDataURL(i)},p=l=>{alert(l)},k=(l,i)=>{e("change",{name:l,base64:i})};return(l,i)=>(h(),b("div",Xe,[y("div",Ye,[He,Je,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",onChange:s},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:t,onDragover:n,onDrop:u,onPaste:r},Qe,32)]))}});const tt={class:"property"},at=B({props:{max:null,size:null,color:null,align:null},emits:["change"],setup(a,{emit:e}){const s=a,t=se("text"),n=se("updateText"),{max:u,size:r,color:d,align:_}=z(s),c=H(()=>_.value==="start"),p=(k,l)=>{const i={max:u.value,size:r.value,color:d.value,align:_.value};i[l]=["color","align"].includes(l)?k:parseInt(k),e("change",i)};return(k,l)=>(h(),b("div",tt,[$(g(R),{class:"property-max",value:g(u),"onUpdate:modelValue":l[0]||(l[0]=i=>p(i,"max"))},null,8,["value"]),$(g(R),{class:"property-size",value:g(r),"onUpdate:modelValue":l[1]||(l[1]=i=>p(i,"size"))},null,8,["value"]),$(g(R),{class:"property-color",value:g(d),"onUpdate:modelValue":l[2]||(l[2]=i=>p(i,"color"))},null,8,["value"]),$(g(ce),{label:"start",name:"align",value:"start",checked:g(c),onToggle:l[3]||(l[3]=i=>p(i,"align"))},null,8,["checked"]),$(g(ce),{label:"end",name:"align",value:"end",checked:!g(c),onToggle:l[4]||(l[4]=i=>p(i,"align"))},null,8,["checked"]),$(g(R),{class:"property-text",value:g(t),"onUpdate:modelValue":g(n)},null,8,["value","onUpdate:modelValue"])]))}});const nt={class:"container"},lt={class:"container-header"},st={class:"container-title"},ot={key:0,class:"container-wall"},ut={class:"container-wraper"},rt={class:"container-footer"},it=B({props:{story:null},emits:["change","create","replace"],setup(a,{emit:e}){const t=z(a).story,n=F(null),u=F(null),r=F(null),d=F(!0),_=F(!0);let c=null;const p=F("\u91D1\u9986\u957F"),k=o=>{p.value=o,U()};oe("text",p),oe("updateText",k);const l=F(0),i=F(0),S=(o,v)=>{t.value.x=o,t.value.y=v},j=o=>{const{max:v,size:m,color:f,align:x}=o;t.value.max=v,t.value.font=`${m}px sans-serif`,t.value.color=f,t.value.align=x},A=H(()=>{const o=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(o[1])*1}),L=H(()=>{var f;return((f=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:f[0])||"png"}),E=new Image,V=()=>{E.onload=async()=>{const o=n.value;o.width=E.naturalWidth,o.height=E.naturalHeight,l.value=o.width,i.value=o.height,de(),U(),Z()},E.onerror=o=>{console.error(o)},E.src=t.value.image},de=()=>{const o=u.value;o.style.width=`${l.value}px`,o.style.height=`${i.value}px`},U=()=>{const o=n.value,v=o.getContext("2d");v.drawImage(E,0,0);const{x:m,y:f,font:x,color:C,align:D,max:w}=t.value;v.font=x,v.fillStyle=C,v.textAlign=D,v.fillText(p.value,m,f,w||o.width)},Z=()=>{const{x:o,y:v,max:m,align:f}=t.value,x=r.value;x.style.width=`${m}px`,x.style.height=`${A.value}px`,x.style.top=`${v-A.value+2}px`,x.style.left=f==="start"?`${o}px`:`${o-m}px`};Y(t,(o,v)=>{o.mid!==v.mid?V():(U(),Z())},{deep:!0});let O=0,q=0;const I=20;let T=!1;const pe=o=>{T=!0;const{clientX:v,clientY:m}=o;O=v,q=m},ge=o=>{if(!T)return;const{clientX:v,clientY:m}=o,f=r.value,{width:x,height:C}=f.getBoundingClientRect();let D=f.offsetLeft+v-O,w=f.offsetTop+m-q;D<-I||w<-I||D>l.value-x+I||w>i.value-C+I?T=!1:(O=v,q=m),D=Math.max(Math.min(D,l.value-x+I),-I),w=Math.max(Math.min(w,i.value-C+I),-I);const{align:G,max:K}=t.value;D+=G==="end"?K:0,w+=A.value-2,S(D,w)},me=()=>{!T||(T=!1)},ve=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0\uFF1F\uFF1F\u4F60\u8FD9\u4E48\u62FD\uFF1F\uFF1F"),d.value?d.value=!1:(d.value=!0,_.value=!0,Q(c))},fe=()=>{const o=n.value;let m=`image/${["jpeg","jpg"].includes(L.value)?"jpeg":"png"}`;const f=o.toDataURL(m),x=`imeme_${t.value.title}_${p.value}`,C=document.createElement("a");C.setAttribute("download",x),C.setAttribute("href",f),C.setAttribute("target","_blank"),C.click()},_e=()=>{d.value?e("change",t.value):_.value||e("create",t.value)},he=({name:o,base64:v})=>{_.value=!1;const{mid:m,title:f,feature:x,image:C,x:D,y:w,max:G,font:K,color:ye,align:xe}=t.value;c={mid:m,title:f,feature:x,image:C,x:D,y:w,max:G,font:K,color:ye,align:xe};const ee=o.slice(0,o.lastIndexOf("."));Q({mid:`meme_${new Date().getTime()}`,title:ee,feature:ee,image:v,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start"})},Q=o=>{e("replace",o)};return ke(()=>{V()}),(o,v)=>(h(),b("div",nt,[y("div",lt,[y("div",st,M(`${g(t).title}.${g(L)}`),1),$(g(J),{label:d.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:ve},null,8,["label"]),$(g(J),{label:"\u4E0B\u8F7D",u:"primary",onClick:fe})]),!d.value&&_.value?(h(),b("div",ot,[$(g(et),{onChange:he})])):(h(),b(W,{key:1},[y("div",ut,[y("canvas",{class:"container-canvas",ref:(m,f)=>{f.canvasRef=m,n.value=m}},null,512),y("div",{class:"container-area",ref:(m,f)=>{f.areaRef=m,u.value=m},onMousemove:ge,onMouseup:me},[y("div",{class:"container-drag",ref:(m,f)=>{f.dragRef=m,r.value=m},onMousedown:pe},null,544)],544)]),$(at,{max:g(t).max,color:g(t).color,size:g(A),align:g(t).align,onChange:j},null,8,["max","color","size","align"])],64)),y("footer",rt,[$(g(J),{label:d.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:_e},null,8,["label"])])]))}});const ct={class:"image-wrap"},dt=B({setup(a){const e=F(""),s=F("");let t=F({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:c,mid:p})=>{e.value!==p&&(e.value=p,s.value=c)};Y([e,s],()=>{u(e.value,s.value)});const u=(c,p)=>{N.openImage({mid:c,type:p}).then(k=>{t.value=k})},r=c=>{console.log("story change value: ",P({},c));const p=ne(P({},c),{image:""});N.saveImage(p)},d=c=>{t.value=c},_=c=>{console.log("db story",c)};return(c,p)=>(h(),b("div",ct,[$(ze,{onChange:n}),g(t).image&&g(t).mid?(h(),ue(it,{key:0,story:g(t),onChange:r,onReplace:d,onCreate:_},null,8,["story"])):Ee("",!0)]))}});const pt=B({setup(a){return(e,s)=>(h(),ue(dt))}});Ie(pt).mount("#app");
