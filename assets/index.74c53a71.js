var Ze=Object.defineProperty,Qe=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Te=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var Be=(e,a,s)=>a in e?Ze(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,Ie=(e,a)=>{for(var s in a||(a={}))tt.call(a,s)&&Be(e,s,a[s]);if(Te)for(var s of Te(a))at.call(a,s)&&Be(e,s,a[s]);return e},Se=(e,a)=>Qe(e,et(a));import{r as nt,c as Z,o as F,d as L,t as oe,a as T,F as Fe,b as ze,u as l,e as w,f as Q,n as se,g as ot,h as st,i as C,w as lt,j as ce,k as be,l as R,m as Ae,p as M,q as le,s as ke,v as ie,x as de,y as Le,z as De,A as rt,B as ut,C as ct,D as it}from"./vendor.7337bdb3.js";const dt=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&t(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}};dt();var Re=(e,a)=>{const s=e.__vccOpts||e;for(const[t,n]of a)s[t]=n;return s};const vt={};function pt(e,a){const s=nt("router-view");return F(),Z(s)}var gt=Re(vt,[["render",pt]]);const mt={class:"side"},ft={class:"side-content-title"},ht=["onClick"],_t=L({props:{catalogList:null,current:null},emits:["change"],setup(e,{emit:a}){const t=oe(e).catalogList,n=(r,u)=>{a("change",{type:r,child:u})};return(r,u)=>(F(),T("div",mt,[(F(!0),T(Fe,null,ze(l(t),p=>(F(),T("div",{key:p.id,class:"side-content"},[w("p",ft,Q(p.text),1),(F(!0),T(Fe,null,ze(p.children,$=>(F(),T("div",{key:$.mid,class:se({"side-content-cell":!0,"side-content-cell-active":e.current===$.mid}),onClick:k=>n(p.type,$)},Q($.title),11,ht))),128))]))),128))]))}});const K=L({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(e){return(a,s)=>(F(),T("button",{class:se(["meme-button",{disabled:e.disabled}])},[ot(a.$slots,"default",{},()=>[st(Q(e.label),1)])],2))}});const yt=L({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:a}){const s=C(null),t=r=>{a("update:modelValue",r.target.value)};return{input:s,blur:r=>{t(r),a("blur")}}}}),xt=["title","value"];function $t(e,a,s,t,n,r){return F(),T("input",{ref:"input",class:se(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:a[0]||(a[0]=(...u)=>e.blur&&e.blur(...u)),onKeyup:a[1]||(a[1]=lt(u=>{var p;return(p=e.input)==null?void 0:p.blur()},["enter"]))},null,42,xt)}var ve=Re(yt,[["render",$t]]);const wt=500,Ct=300;L({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:wt},interval:{type:Number,default:Ct}},created(){this.showChange(this.show)},setup(e){const{show:a,interval:s,min:t}=oe(e),n=C(a.value);let r,u=0;const p=()=>{const x=new Date().getTime()-u;x>t.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(t.value-x,0))},$=k=>{k?s.value===0?(n.value=!0,u=new Date().getTime()):r=window.setTimeout(()=>{n.value=!0,u=new Date().getTime()},s.value):(clearTimeout(r),p())};return ce(a,()=>{$(a.value)}),{localShow:n,showChange:$}}});const Ft={class:"meme-radio"},bt=["name","value","checked"],kt={class:"meme-radio-label"},re=L({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(e,{emit:a}){const s=t=>{a("toggle",t)};return(t,n)=>(F(),T("label",Ft,[w("input",{class:"meme-radio-input",type:"radio",name:e.name,value:e.value,checked:e.checked,onChange:n[0]||(n[0]=r=>s(e.value))},null,40,bt),w("span",kt,Q(e.label),1)]))}});const Dt={class:"meme-file-upload"},Et={class:"file-button"},Mt=w("i",{class:"file-glyphicon"},null,-1),Tt=w("span",null,"UPLOAD FILE",-1),Bt=w("i",{class:"file-tips"},"Drop files here to upload",-1),It=[Bt],St=L({emits:["change"],setup(e,{emit:a}){const s=be("commands"),t=v=>{const i=v.target.files;if(!i)return!1;x(i)},n=v=>{v.stopPropagation(),v.preventDefault()},r=v=>{v.stopPropagation(),v.preventDefault()},u=v=>{v.stopPropagation(),v.preventDefault();const i=v.dataTransfer.files;x(i)},p=v=>{v.stopPropagation(),v.preventDefault();const i=v.clipboardData.files;x(i)},$=1*1024*1024,k=/^image\//,x=v=>{if(v.length!==1)return D("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const i=v[0],{name:f,size:y,type:b}=i;if(!k.test(b))return D(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${b}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const I=f.replace(/\.\w*$/g,"");if(s.value.includes(I))return D(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${f}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${I}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(y>$)return D("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const E=new FileReader;E.onload=O=>{const te=O.target.result;A(f,te)},E.onerror=()=>{D(E.error.message)},E.readAsDataURL(i)},D=v=>{alert(v)},A=(v,i)=>{a("change",{name:v,base64:i})};return(v,i)=>(F(),T("div",Dt,[w("div",Et,[Mt,Tt,w("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:t},null,32)]),w("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:r,onDrop:u,onPaste:p},It,32)]))}});const zt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},At=w("title",null,"dice",-1),Lt=["fill"],Rt=L({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:a}){const s=e,t=R(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),n=()=>{a("click")};return(r,u)=>(F(),Z(l(K),{class:"dice-button",u:"icon",onClick:n},{default:Ae(()=>[(F(),T("svg",zt,[At,w("path",{fill:l(t),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Lt)]))]),_:1}))}});const Pt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Nt=w("title",null,"picker",-1),Vt=["fill"],Ut=L({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:a}){const s=e,t=R(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),n=()=>{a("click")};return(r,u)=>(F(),Z(l(K),{class:"picker-button",u:"icon",onClick:n},{default:Ae(()=>[(F(),T("svg",Pt,[Nt,w("path",{fill:l(t),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Vt)]))]),_:1}))}});const Wt={class:"property"},Pe=L({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(e,{emit:a}){const s=e,t=be("text"),n=be("updateText"),{max:r,size:u,color:p,align:$,direction:k}=oe(s),x=(v,i)=>{const f={max:r.value,size:u.value,color:p.value,align:$.value,direction:k.value};f[i]=["color","align","direction"].includes(i)?v:parseInt(v),a("change",f)},D=()=>{const v="#"+Math.floor(Math.random()*16777215).toString(16);x(v,"color")},A=()=>{a("pick")};return(v,i)=>(F(),T("div",Wt,[M(l(ve),{class:"property-max",value:l(r),"onUpdate:modelValue":i[0]||(i[0]=f=>x(f,"max"))},null,8,["value"]),M(l(ve),{class:"property-size",value:l(u),"onUpdate:modelValue":i[1]||(i[1]=f=>x(f,"size"))},null,8,["value"]),M(l(ve),{class:"property-color",value:l(p),"onUpdate:modelValue":i[2]||(i[2]=f=>x(f,"color"))},null,8,["value"]),M(Rt,{color:l(p),onClick:D},null,8,["color"]),M(Ut,{color:l(p),onClick:A},null,8,["color"]),M(l(re),{label:"start",name:"align",value:"start",checked:l($)==="start",onToggle:i[3]||(i[3]=f=>x(f,"align"))},null,8,["checked"]),M(l(re),{label:"center",name:"align",value:"center",checked:l($)==="center",onToggle:i[4]||(i[4]=f=>x(f,"align"))},null,8,["checked"]),M(l(re),{label:"end",name:"align",value:"end",checked:l($)==="end",onToggle:i[5]||(i[5]=f=>x(f,"align"))},null,8,["checked"]),M(l(ve),{class:"property-text",value:l(t),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"]),M(l(re),{label:"up",name:"direction",value:"up",checked:l(k)==="up",onToggle:i[6]||(i[6]=f=>x(f,"direction"))},null,8,["checked"]),M(l(re),{label:"down",name:"direction",value:"down",checked:l(k)==="down",onToggle:i[7]||(i[7]=f=>x(f,"direction"))},null,8,["checked"])]))}}),Ee=1.2,S=11,N=14,Ne=N*S,Ve=N*S,ee=N*S,Ue=N,Xt=(()=>{const e=[];for(let a=1;a<S;a++)e.push([a,0,a,S]),e.push([0,a,S,a]);return e.map(a=>a.map(s=>s*N))})(),Yt=(e,a,s)=>{let t=0,n=e.length-1;for(;t<=n;){const r=Math.floor((t+n)/2),u=s.measureText(e.substring(0,r)).width,p=s.measureText(e.substring(0,r+1)).width;if(u<=a&&p>a)return r;u<a?t=r+1:n=r-1}return-1},jt=(e,a,s)=>{const t=[];let n=0;for(;(n=Yt(e,a,s))!==-1;)t.push(e.substring(0,n)),e=e.substring(n);return e&&t.push(e),t},We=(e,a,s,t)=>{const{x:n,y:r,font:u,color:p,align:$,max:k,direction:x}=t;e.font=u||"32px sans-serif",e.fillStyle=p||"#000000",e.textAlign=$||"center";const D=k||a,A=u.match(/(\d{1,3})px/)||["","32"],v=Number(A[1]),i=jt(s,D,e);i.forEach((f,y)=>{const b=x==="down"?y:y-(i.length-1);e.fillText(f,n,r+b*v*Ee,D)})},Ot=e=>{e.imageSmoothingEnabled=!1,e.lineCap="round",e.beginPath(),e.strokeStyle="#000000",e.arc(S*N/2,S*N/2,S*N/2-1,0,Math.PI*2),e.stroke(),e.clip(),e.strokeStyle="#D6D6D6",Xt.forEach(a=>{const{0:s,1:t,2:n,3:r}=a;e.moveTo(s,t),e.lineTo(n,r)}),e.stroke(),e.beginPath(),e.strokeStyle="#FF0000",e.rect((S-1)*N/2,(S-1)*N/2,1*N,1*N),e.stroke()},Xe=(e,a,s,t)=>{a.style.left=`${s+Ue}px`,a.style.top=`${t+Ue}px`;const n=a.getContext("2d"),r=Math.min(Math.max(0,s-5),e.width-S),u=Math.min(Math.max(0,t-5),e.height-S);n.clearRect(0,0,Ne,Ve),n.drawImage(e,r,u,S,S,0,0,Ne,Ve),Ot(n)},Ye=(e,a,s)=>{const n=`image/${["jpeg","jpg"].includes(a)?"jpeg":"png"}`,r=e.toDataURL(n),u=document.createElement("a");u.setAttribute("download",s),u.setAttribute("href",r),u.setAttribute("target","_blank"),u.click()};const Ht={class:"container"},Gt={class:"container-header"},Kt={class:"container-title"},qt={key:0,class:"container-wall"},Jt={class:"container-wraper"},Zt=["width","height"],Qt={class:"container-footer"},ea=L({props:{story:null},emits:["change","create","replace"],setup(e,{emit:a}){const t=oe(e).story,n=C(null),r=C(null),u=C(null),p=C(!0),$=C(!0);let k=null;const x=C(!1),D=C(!1),A=C(null),v=C("\u91D1\u9986\u957F"),i=o=>{v.value=o,q()};le("text",v),le("updateText",i);const f=C(0),y=C(0),b=(o,d)=>{t.value.x=o,t.value.y=d},I=o=>{const{max:d,size:g,color:h,align:B,direction:X}=o;t.value.max=d,t.value.font=`${g}px sans-serif`,t.value.color=h,t.value.align=B,t.value.direction=X},E=R(()=>{const o=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(o[1])}),O=R(()=>{var h;return((h=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:h[0])||"png"}),te=R(()=>`${t.value.title}.${O.value} ${f.value} * ${y.value} (${t.value.x}, ${t.value.y})`),U=R(()=>{const o=t.value.max||f.value;return{start:0,center:Math.floor(o/2),end:o}[t.value.align]}),W=new Image,ae=()=>{W.onload=async()=>{const o=n.value;o.width=W.naturalWidth,o.height=W.naturalHeight,f.value=o.width,y.value=o.height,ne(),q(),J()},W.onerror=o=>{console.error(o)},W.src=t.value.image},ne=()=>{const o=r.value;o.style.width=`${f.value}px`,o.style.height=`${y.value}px`},q=()=>{const o=n.value,d=o.getContext("2d");d.drawImage(W,0,0),We(d,o.width,v.value,t.value)},J=()=>{const{x:o,y:d,max:g}=t.value,h=u.value;h.style.width=`${g}px`,h.style.height=`${E.value*Ee}px`,h.style.top=`${d-E.value+2}px`,h.style.left=`${o-U.value}px`};ce(t,(o,d)=>{o.mid!==d.mid?ae():(q(),J())},{deep:!0});let H=0,P=0;const z=20;let G=!1;const pe=o=>{G=!0;const{clientX:d,clientY:g}=o;H=d,P=g},ge=o=>{if(!G)return;const{clientX:d,clientY:g}=o,h=u.value,{width:B,height:X}=h.getBoundingClientRect();let V=h.offsetLeft+d-H,Y=h.offsetTop+g-P;V<-z||Y<-z||V>f.value-B+z||Y>y.value-X+z?G=!1:(H=d,P=g),V=Math.max(Math.min(V,f.value-B+z),-z),Y=Math.max(Math.min(Y,y.value-X+z),-z),V+=U.value,Y+=E.value-2,b(V,Y)},me=()=>{!G||(G=!1)},fe=()=>{p.value?p.value=!1:(p.value=!0,$.value=!0,k?(ue(k),k=null):ae())},he=()=>{const o=n.value,d=`imeme_${t.value.title}_${v.value}`;Ye(o,O.value,d)},_e=()=>{p.value?a("change",t.value):$.value||(a("create",t.value),p.value=!0,$.value=!0)},ye=({name:o,base64:d})=>{$.value=!1;const{mid:g,title:h,feature:B,image:X,x:V,y:Y,max:Oe,font:He,color:Ge,align:Ke,direction:qe,senior:Je}=t.value;k={mid:g,title:h,feature:B,image:X,x:V,y:Y,max:Oe,font:He,color:Ge,align:Ke,direction:qe,senior:Je};const Me=o.slice(0,o.lastIndexOf("."));ue({mid:`meme_${new Date().getTime()}`,title:Me,feature:Me,image:d,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",senior:0})},ue=o=>{a("replace",o)},xe=()=>{x.value=!0},$e=(o,d)=>{const g=n.value,h=A.value;Xe(g,h,o,d)},we=async o=>{if(!x.value)return!1;const{offsetX:d,offsetY:g}=o;d<0||g<0||(D.value=!0,$e(d,g))},Ce=()=>{if(!x.value)return!1;D.value=!1},c=o=>{const d=V=>V.toString(16).padStart(2,"0"),{0:g,1:h,2:B,3:X}=o.data;return`#${d(g)}${d(h)}${d(B)}${d(X)}`.toUpperCase()},m=(o,d)=>{const B=n.value.getContext("2d").getImageData(o,d,1,1);return c(B)},_=o=>{if(!x.value)return!1;const{offsetX:d,offsetY:g}=o;if(d<0||g<0)return;const h=m(d,g);t.value.color=h,D.value=!1,x.value=!1};return ke(()=>{ae()}),(o,d)=>(F(),T("div",Ht,[w("div",Gt,[w("div",Kt,Q(l(te)),1),M(l(K),{label:p.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:fe},null,8,["label"]),M(l(K),{label:"\u4E0B\u8F7D",u:"primary",onClick:he})]),!p.value&&$.value?(F(),T("div",qt,[M(l(St),{onChange:ye})])):(F(),T(Fe,{key:1},[w("div",Jt,[w("canvas",{ref:(g,h)=>{h.canvasRef=g,n.value=g},class:se({"container-canvas":!0,"container-pointer":x.value}),onMousemove:we,onMouseleave:Ce,onClick:_},null,34),ie(w("div",{class:"container-area",ref:(g,h)=>{h.areaRef=g,r.value=g},onMousemove:ge,onMouseup:me},[w("div",{class:"container-drag",ref:(g,h)=>{h.dragRef=g,u.value=g},onMousedown:pe},null,544)],544),[[de,!x.value]]),ie(w("canvas",{ref:(g,h)=>{h.layerRef=g,A.value=g},class:"container-layer",style:Le({borderRadius:`${l(ee)}px`}),width:l(ee),height:l(ee)},null,12,Zt),[[de,x.value&&D.value]])]),M(Pe,{max:l(t).max,color:l(t).color,size:l(E),align:l(t).align,direction:l(t).direction,onChange:I,onPick:xe},null,8,["max","color","size","align","direction"])],64)),w("footer",Qt,[M(l(K),{label:p.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:_e},null,8,["label"])])]))}});const ta={class:"container"},aa={class:"container-header"},na={class:"container-title"},oa={class:"container-wraper"},sa=["width","height"],la={class:"container-footer"},ra=L({props:{feature:null},emits:["change"],setup(e,{emit:a}){const t=oe(e).feature,n=C(null),r=C(null),u=C(null),p=C(!1),$=C(!1),k=C(null),x="\u91D1\u9986\u957F",D=C("\u91D1\u9986\u957F"),A=c=>{D.value=c,ne()};le("text",D),le("updateText",A);const v=C(0),i=C(0),f=R(()=>t.value.type==="TEXT"),y=R(()=>{var c;if(f.value){const m=((c=t.value.et)==null?void 0:c.font.match(/(\d{1,3})px/))||["","32"];return Number(m[1])}return 0}),b=R(()=>{var o;return((o=t.value.story.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:o[0])||"png"}),I=R(()=>`${t.value.story.title}.${b.value} ${v.value} * ${i.value} (${E.value.x}, ${E.value.y})`),E=R(()=>t.value.et),O=R(()=>{if(f.value){const c=E.value.max||v.value;return{start:0,center:Math.floor(c/2),end:c}[E.value.align]}return 0}),te=c=>{const{max:m,size:_,color:o,align:d,direction:g}=c;t.value.et.max=m,t.value.et.font=`${_}px sans-serif`,t.value.et.color=o,t.value.et.align=d,t.value.et.direction=g},U=new Image,W=()=>{U.onload=async()=>{const c=n.value;c.width=U.naturalWidth,c.height=U.naturalHeight,v.value=c.width,i.value=c.height,ae(),ne(),f.value&&q()},U.onerror=c=>{console.error(c)},U.src=t.value.story.image},ae=()=>{const c=r.value;c.style.width=`${v.value}px`,c.style.height=`${i.value}px`},ne=()=>{const c=n.value,m=c.getContext("2d");m.drawImage(U,0,0),m.save(),We(m,c.width,x,t.value.story)},q=()=>{if(f.value){const{x:c,y:m,max:_}=E.value,o=u.value;o.style.width=`${_}px`,o.style.height=`${y.value*Ee}px`,o.style.top=`${m-y.value+2}px`,o.style.left=`${c-O.value}px`}};ce(t,(c,m)=>{c.mid!==m.mid?W():(ne(),q())},{deep:!0});let J=0,H=0;const P=20;let z=!1;const G=c=>{z=!0;const{clientX:m,clientY:_}=c;J=m,H=_},pe=c=>{if(!z)return;const{clientX:m,clientY:_}=c,o=u.value,{width:d,height:g}=o.getBoundingClientRect();let h=o.offsetLeft+m-J,B=o.offsetTop+_-H;h<-P||B<-P||h>v.value-d+P||B>i.value-g+P?z=!1:(J=m,H=_),h=Math.max(Math.min(h,v.value-d+P),-P),B=Math.max(Math.min(B,i.value-g+P),-P),h+=O.value,B+=y.value-2,ge(h,B)},ge=(c,m)=>{E.value.x=c,E.value.y=m},me=()=>{!z||(z=!1)},fe=()=>{const c=n.value,m=`imeme_${t.value.story.title}_${D.value}`;Ye(c,b.value,m)},he=()=>{t.value,a("change",{mid:t.value.mid,type:t.value.type,options:t.value.et})},_e=()=>{p.value=!0},ye=(c,m)=>{const _=n.value,o=k.value;Xe(_,o,c,m)},ue=async c=>{if(!p.value)return!1;const{offsetX:m,offsetY:_}=c;m<0||_<0||($.value=!0,ye(m,_))},xe=()=>{if(!p.value)return!1;$.value=!1},$e=c=>{const m=h=>h.toString(16).padStart(2,"0"),{0:_,1:o,2:d,3:g}=c.data;return`#${m(_)}${m(o)}${m(d)}${m(g)}`.toUpperCase()},we=(c,m)=>{const d=n.value.getContext("2d").getImageData(c,m,1,1);return $e(d)},Ce=c=>{if(!p.value)return!1;const{offsetX:m,offsetY:_}=c;if(m<0||_<0)return;const o=we(m,_);t.value.story.color=o,$.value=!1,p.value=!1};return ke(()=>{W()}),(c,m)=>(F(),T("div",ta,[w("div",aa,[w("div",na,Q(l(I)),1),M(l(K),{label:"\u4E0B\u8F7D",u:"primary",onClick:fe})]),w("div",oa,[w("canvas",{ref:(_,o)=>{o.canvasRef=_,n.value=_},class:se({"container-canvas":!0,"container-pointer":p.value}),onMousemove:ue,onMouseleave:xe,onClick:Ce},null,34),ie(w("div",{class:"container-area",ref:(_,o)=>{o.areaRef=_,r.value=_},onMousemove:pe,onMouseup:me},[w("div",{class:"container-drag",ref:(_,o)=>{o.dragRef=_,u.value=_},onMousedown:G},null,544)],544),[[de,!p.value]]),ie(w("canvas",{ref:(_,o)=>{o.layerRef=_,k.value=_},class:"container-layer",style:Le({borderRadius:`${l(ee)}px`}),width:l(ee),height:l(ee)},null,12,sa),[[de,p.value&&$.value]])]),l(f)?(F(),Z(Pe,{key:0,max:l(E).max,color:l(E).color,size:l(y),align:l(E).align,direction:l(E).direction,onChange:te,onPick:_e},null,8,["max","color","size","align","direction"])):De("",!0),w("footer",la,[M(l(K),{label:"\u66F4\u65B0",u:"primary",onClick:he})])]))}}),je={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"}},ua=()=>"https://imeme.vercel.app";var ca=e=>async(a={},s={})=>{const{url:t,method:n}=e,r=ua();return rt.request({withCredentials:!1,url:r+t,method:n,[n==="get"?"params":"data"]:a}).then(u=>{const p=u.data;return(s==null?void 0:s.stream)?u:p.errNo===0?p.data:Promise.reject(p)}).catch(u=>Promise.reject(u))};const j={};for(const e in je)j[e]=ca(je[e]);const ia={class:"image-wrap"},da=L({setup(e){const a=C([]),s=C(""),t=C("");let n=C({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",senior:0}),r=C({mid:"",feature:"",type:"",story:n});const u=async()=>{const y=await j.getCatalog({});a.value=y},p=({type:y,child:b})=>{s.value!==b.mid&&(s.value=b.mid,t.value=y)};ce([s,t],()=>{$(s.value,t.value)});const $=(y,b)=>{i.value?j.openImage({mid:y,type:b}).then(I=>{n.value=I}):j.getFeatureImage({mid:y}).then(I=>{r.value=I})},k=y=>{const b=Se(Ie({},y),{image:""});j.saveImage(b)},x=y=>{n.value=y},D=async y=>{const b=await j.createImage(y).catch(I=>{alert(I.message)});await u(),s.value=b.mid},A=C([]);le("commands",A);const v=async()=>{const y=await j.getCommands({});A.value=y},i=R(()=>["STORY","SERIES","SPECIAL"].includes(t.value)),f=({mid:y,type:b,options:I})=>{console.log("\u66F4\u65B0feature \u6570\u636E",y,b,I),b==="TEXT"&&j.saveImage(I)};return ke(()=>{u(),v()}),(y,b)=>(F(),T("div",ia,[M(_t,{current:s.value,"catalog-list":a.value,onChange:p},null,8,["current","catalog-list"]),l(i)&&l(n).image&&l(n).mid?(F(),Z(ea,{key:0,story:l(n),onChange:k,onReplace:x,onCreate:D},null,8,["story"])):De("",!0),t.value==="FEATURE"&&l(r).mid?(F(),Z(ra,{key:1,feature:l(r),onChange:f},null,8,["feature"])):De("",!0)]))}});const va={class:"material-center"},pa=L({setup(e){return(a,s)=>(F(),T("div",va," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),ga=[{path:"/",component:da},{path:"/center",component:pa}],ma=ut({history:ct(),routes:ga});it(gt).use(ma).mount("#app");
