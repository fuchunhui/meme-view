var rt=Object.defineProperty,ut=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var We=(t,a,o)=>a in t?rt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,Ve=(t,a)=>{for(var o in a||(a={}))it.call(a,o)&&We(t,o,a[o]);if(je)for(var o of je(a))dt.call(a,o)&&We(t,o,a[o]);return t},Oe=(t,a)=>ut(t,ct(a));import{c as le,r as vt,o as $,d as U,t as ue,a as R,F as xe,b as Ue,u as l,e as C,f as oe,n as _e,g as pt,h as gt,i as x,w as ht,j as we,k as ce,l as N,m as He,p as S,q as ie,s as $e,v as Ce,x as be,y as Ge,z as ft,A as mt,B as Ne,C as _t,D as yt,E as xt}from"./vendor.76de7f3e.js";const wt=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};wt();var Ke=(t,a)=>{const o=t.__vccOpts||t;for(const[e,n]of a)o[e]=n;return o};const $t={};function Ct(t,a){const o=vt("router-view");return $(),le(o)}var bt=Ke($t,[["render",Ct]]);const Ft={class:"side"},kt={class:"side-content-title"},Mt=["onClick"],Dt=U({props:{catalogList:null,current:null},emits:["change"],setup(t,{emit:a}){const e=ue(t).catalogList,n=(r,c)=>{a("change",{type:r,child:c})};return(r,c)=>($(),R("div",Ft,[($(!0),R(xe,null,Ue(l(e),v=>($(),R("div",{key:v.id,class:"side-content"},[C("p",kt,oe(v.text),1),($(!0),R(xe,null,Ue(v.children,y=>($(),R("div",{key:y.mid,class:_e({"side-content-cell":!0,"side-content-cell-active":t.current===y.mid}),onClick:b=>n(v.type,y)},oe(y.title),11,Mt))),128))]))),128))]))}});const se=U({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){return(a,o)=>($(),R("button",{class:_e(["meme-button",{disabled:t.disabled}])},[pt(a.$slots,"default",{},()=>[gt(oe(t.label),1)])],2))}});const Et=U({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:a}){const o=x(null),e=r=>{a("update:modelValue",r.target.value)};return{input:o,blur:r=>{e(r),a("blur")}}}}),Tt=["title","value"];function It(t,a,o,e,n,r){return $(),R("input",{ref:"input",class:_e(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:a[0]||(a[0]=(...c)=>t.blur&&t.blur(...c)),onKeyup:a[1]||(a[1]=ht(c=>{var v;return(v=t.input)==null?void 0:v.blur()},["enter"]))},null,42,Tt)}var te=Ke(Et,[["render",It]]);const Bt=500,St=300;U({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Bt},interval:{type:Number,default:St}},created(){this.showChange(this.show)},setup(t){const{show:a,interval:o,min:e}=ue(t),n=x(a.value);let r,c=0;const v=()=>{const M=new Date().getTime()-c;M>e.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(e.value-M,0))},y=b=>{b?o.value===0?(n.value=!0,c=new Date().getTime()):r=window.setTimeout(()=>{n.value=!0,c=new Date().getTime()},o.value):(clearTimeout(r),v())};return we(a,()=>{y(a.value)}),{localShow:n,showChange:y}}});const Rt={class:"meme-radio"},Lt=["name","value","checked"],zt={class:"meme-radio-label"},ye=U({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(t,{emit:a}){const o=e=>{a("toggle",e)};return(e,n)=>($(),R("label",Rt,[C("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=r=>o(t.value))},null,40,Lt),C("span",zt,oe(t.label),1)]))}});const At={class:"meme-file-upload"},Pt={class:"file-button"},Vt=C("i",{class:"file-glyphicon"},null,-1),Ut=C("span",null,"UPLOAD FILE",-1),Nt=C("i",{class:"file-tips"},"Drop files here to upload",-1),Xt=[Nt],Yt=U({emits:["change"],setup(t,{emit:a}){const o=ce("commands"),e=f=>{const F=f.target.files;if(!F)return!1;M(F)},n=f=>{f.stopPropagation(),f.preventDefault()},r=f=>{f.stopPropagation(),f.preventDefault()},c=f=>{f.stopPropagation(),f.preventDefault();const F=f.dataTransfer.files;M(F)},v=f=>{f.stopPropagation(),f.preventDefault();const F=f.clipboardData.files;M(F)},y=1*1024*1024,b=/^image\//,M=f=>{if(f.length!==1)return m("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const F=f[0],{name:k,size:p,type:i}=F;if(!b.test(i))return m(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${i}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const D=k.replace(/\.\w*$/g,"");if(o.value.includes(D))return m(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${k}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${D}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(p>y)return m("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const I=new FileReader;I.onload=A=>{const P=A.target.result;_(k,P)},I.onerror=()=>{m(I.error.message)},I.readAsDataURL(F)},m=f=>{alert(f)},_=(f,F)=>{a("change",{name:f,base64:F})};return(f,F)=>($(),R("div",At,[C("div",Pt,[Vt,Ut,C("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:e},null,32)]),C("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:r,onDrop:c,onPaste:v},Xt,32)]))}});const jt=["value","selected"],Wt=U({props:{options:null,selected:null},emits:["change","update:model-value"],setup(t,{emit:a}){const o=e=>{const n=e.target.value;e.target.blur(),a("update:model-value",n),a("change",n)};return(e,n)=>($(),R("select",{class:"meme-select",onChange:o},[($(!0),R(xe,null,Ue(t.options,r=>($(),R("option",{key:r.value,class:"meme-option",value:r.value,selected:t.selected===r.value},oe(r.label),9,jt))),128))],32))}});const Ot={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Ht=C("title",null,"dice",-1),Gt=["fill"],Kt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const o=t,e=N(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),n=()=>{a("click")};return(r,c)=>($(),le(l(se),{class:"dice-button",u:"icon",onClick:n},{default:He(()=>[($(),R("svg",Ot,[Ht,C("path",{fill:l(e),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Gt)]))]),_:1}))}});const qt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Jt=C("title",null,"picker",-1),Zt=["fill"],Qt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const o=t,e=N(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),n=()=>{a("click")};return(r,c)=>($(),le(l(se),{class:"picker-button",u:"icon",onClick:n},{default:He(()=>[($(),R("svg",qt,[Jt,C("path",{fill:l(e),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Zt)]))]),_:1}))}});const ea={class:"property"},qe=U({props:{max:null,size:null,color:null,align:null,direction:null,blur:null,degree:null},emits:["change","pick"],setup(t,{emit:a}){const o=t,e=ce("text"),n=ce("updateText"),{max:r,size:c,color:v,align:y,direction:b,blur:M,degree:m}=ue(o),_=(k,p)=>{const i={max:r.value,size:c.value,color:v.value,align:y.value,direction:b.value,blur:M.value,degree:m.value};i[p]=["color","align","direction"].includes(p)?k:parseInt(k),a("change",i)},f=()=>{const k="#"+Math.floor(Math.random()*16777215).toString(16);_(k,"color")},F=()=>{a("pick")};return(k,p)=>($(),R("div",ea,[S(l(te),{class:"property-max",value:l(r),"onUpdate:modelValue":p[0]||(p[0]=i=>_(i,"max"))},null,8,["value"]),S(l(te),{class:"property-size",value:l(c),"onUpdate:modelValue":p[1]||(p[1]=i=>_(i,"size"))},null,8,["value"]),S(l(te),{class:"property-color",value:l(v),"onUpdate:modelValue":p[2]||(p[2]=i=>_(i,"color"))},null,8,["value"]),S(Kt,{color:l(v),onClick:f},null,8,["color"]),S(Qt,{color:l(v),onClick:F},null,8,["color"]),S(l(ye),{label:"start",name:"align",value:"start",checked:l(y)==="start",onToggle:p[3]||(p[3]=i=>_(i,"align"))},null,8,["checked"]),S(l(ye),{label:"center",name:"align",value:"center",checked:l(y)==="center",onToggle:p[4]||(p[4]=i=>_(i,"align"))},null,8,["checked"]),S(l(ye),{class:"property-end",label:"end",name:"align",value:"end",checked:l(y)==="end",onToggle:p[5]||(p[5]=i=>_(i,"align"))},null,8,["checked"]),S(l(te),{class:"property-text",value:l(e),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"]),S(l(ye),{label:"up",name:"direction",value:"up",checked:l(b)==="up",onToggle:p[6]||(p[6]=i=>_(i,"direction"))},null,8,["checked"]),S(l(ye),{label:"down",name:"direction",value:"down",checked:l(b)==="down",onToggle:p[7]||(p[7]=i=>_(i,"direction"))},null,8,["checked"]),S(l(te),{class:"property-degree",value:l(m),"onUpdate:modelValue":p[8]||(p[8]=i=>_(i,"degree"))},null,8,["value"])]))}}),Fe=1.2,X=11,O=14,Je=O*X,Ze=O*X,de=O*X,Qe=O,ta=(()=>{const t=[];for(let a=1;a<X;a++)t.push([a,0,a,X]),t.push([0,a,X,a]);return t.map(a=>a.map(o=>o*O))})(),aa=(t,a,o)=>{let e=0,n=t.length-1;for(;e<=n;){const r=Math.floor((e+n)/2),c=o.measureText(t.substring(0,r)).width,v=o.measureText(t.substring(0,r+1)).width;if(c<=a&&v>a)return r;c<a?e=r+1:n=r-1}return-1},na=(t,a,o)=>{const e=[];let n=0;for(;(n=aa(t,a,o))!==-1;)e.push(t.substring(0,n)),t=t.substring(n);return t&&e.push(t),e},Xe=(t,a,o,e)=>{const{x:n,y:r,font:c,color:v,align:y,max:b,direction:M,blur:m,degree:_}=e;t.font=c||"32px sans-serif",t.fillStyle=v||"#000000",m&&(t.filter=`blur(${m}px)`),t.textAlign=y||"center";const f=b||a,F=ke(c),k=na(o,f,t);k.forEach((p,i)=>{const D=M==="down"?i:i-(k.length-1);t.save(),_?(t.translate(n,r+D*F*Fe),t.rotate(_*Math.PI/180),t.fillText(p,0,0,f)):t.fillText(p,n,r+D*F*Fe,f),t.restore()})},la=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(X*O/2,X*O/2,X*O/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",ta.forEach(a=>{const{0:o,1:e,2:n,3:r}=a;t.moveTo(o,e),t.lineTo(n,r)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((X-1)*O/2,(X-1)*O/2,1*O,1*O),t.stroke()},et=(t,a,o,e)=>{a.style.left=`${o+Qe}px`,a.style.top=`${e+Qe}px`;const n=a.getContext("2d"),r=Math.min(Math.max(0,o-5),t.width-X),c=Math.min(Math.max(0,e-5),t.height-X);n.clearRect(0,0,Je,Ze),n.drawImage(t,r,c,X,X,0,0,Je,Ze),la(n)},ke=t=>{const a=t.match(/(\d{1,3})px/)||["","32"];return Number(a[1])},tt=t=>{var e;return((e=t.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:e[0])||"png"},at=(t,a,o)=>{const n=`image/${["jpeg","jpg"].includes(a)?"jpeg":"png"}`,r=t.toDataURL(n),c=document.createElement("a");c.setAttribute("download",o),c.setAttribute("href",r),c.setAttribute("target","_blank"),c.click()};const oa={class:"container"},sa={class:"container-header"},ra={class:"container-title"},ua={key:0,class:"container-wall"},ca={class:"container-wraper"},ia=["width","height"],da={class:"container-footer"},va=U({props:{story:null},emits:["change","create","replace"],setup(t,{emit:a}){const e=ue(t).story,n=x(null),r=x(null),c=x(null),v=x(!0),y=x(!0);let b=null;const M=x(!1),m=x(!1),_=x(null),f=x("\u91D1\u9986\u957F"),F=d=>{f.value=d,K()};ie("text",f),ie("updateText",F);const k=x(0),p=x(0),i=(d,h)=>{e.value.x=d,e.value.y=h},D=d=>{const{max:h,size:E,color:T,align:j,direction:J,blur:Y,degree:W}=d;e.value.max=h,e.value.font=`${E}px sans-serif`,e.value.color=T,e.value.align=j,e.value.direction=J,e.value.blur=Y,e.value.degree=W},I=N(()=>ke(e.value.font)),A=N(()=>tt(e.value.image)),P=N(()=>`${e.value.title}.${A.value} ${k.value} * ${p.value} (${e.value.x}, ${e.value.y})`),ve=N(()=>{const d=e.value.max||k.value;return{start:0,center:Math.floor(d/2),end:d}[e.value.align]}),ee=new Image,pe=()=>{ee.onload=async()=>{const d=n.value;d.width=ee.naturalWidth,d.height=ee.naturalHeight,k.value=d.width,p.value=d.height,re(),K(),ge()},ee.onerror=d=>{console.error(d)},ee.src=e.value.image},re=()=>{const d=r.value;d.style.width=`${k.value}px`,d.style.height=`${p.value}px`},K=()=>{const d=n.value,h=d.getContext("2d");h.drawImage(ee,0,0),Xe(h,d.width,f.value,e.value)},ge=()=>{const{x:d,y:h,max:E}=e.value,T=c.value;T.style.width=`${E}px`,T.style.height=`${I.value*Fe}px`,T.style.top=`${h-I.value+2}px`,T.style.left=`${d-ve.value}px`};we(e,(d,h)=>{d.mid!==h.mid?pe():(K(),ge())},{deep:!0});let he=0,Z=0;const H=20;let Q=!1;const fe=d=>{Q=!0;const{clientX:h,clientY:E}=d;he=h,Z=E},q=d=>{if(!Q)return;const{clientX:h,clientY:E}=d,T=c.value,{width:j,height:J}=T.getBoundingClientRect();let Y=T.offsetLeft+h-he,W=T.offsetTop+E-Z;Y<-H||W<-H||Y>k.value-j+H||W>p.value-J+H?Q=!1:(he=h,Z=E),Y=Math.max(Math.min(Y,k.value-j+H),-H),W=Math.max(Math.min(W,p.value-J+H),-H),Y+=ve.value,W+=I.value-2,i(Y,W)},ae=()=>{!Q||(Q=!1)},Me=()=>{v.value?v.value=!1:(v.value=!0,y.value=!0,b?(me(b),b=null):pe())},De=()=>{b&&(me(b),b=null)},Ee=()=>{const d=n.value,h=`imeme_${e.value.title}_${f.value}`;at(d,A.value,h)},Te=()=>{v.value?a("change",e.value):y.value||(a("create",e.value,De),v.value=!0,y.value=!0)},Ie=({name:d,base64:h})=>{y.value=!1;const{mid:E,title:T,feature:j,image:J,x:Y,y:W,max:s,font:u,color:g,align:w,direction:B,senior:L,blur:z,degree:V}=e.value;b={mid:E,title:T,feature:j,image:J,x:Y,y:W,max:s,font:u,color:g,align:w,direction:B,senior:L,blur:z,degree:V};const ne=d.slice(0,d.lastIndexOf("."));me({mid:`meme_${new Date().getTime()}`,title:ne,feature:ne,image:h,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",blur:0,degree:0,senior:0})},me=d=>{a("replace",d)},Be=()=>{M.value=!0},Se=(d,h)=>{const E=n.value,T=_.value;et(E,T,d,h)},Re=async d=>{if(!M.value)return!1;const{offsetX:h,offsetY:E}=d;h<0||E<0||(m.value=!0,Se(h,E))},Le=()=>{if(!M.value)return!1;m.value=!1},ze=d=>{const h=Y=>Y.toString(16).padStart(2,"0"),{0:E,1:T,2:j,3:J}=d.data;return`#${h(E)}${h(T)}${h(j)}${h(J)}`.toUpperCase()},Ae=(d,h)=>{const j=n.value.getContext("2d").getImageData(d,h,1,1);return ze(j)},Pe=d=>{if(!M.value)return!1;const{offsetX:h,offsetY:E}=d;if(h<0||E<0)return;const T=Ae(h,E);e.value.color=T,m.value=!1,M.value=!1};return $e(()=>{pe()}),(d,h)=>($(),R("div",oa,[C("div",sa,[C("div",ra,oe(l(P)),1),S(l(se),{label:v.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Me},null,8,["label"]),S(l(se),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ee})]),!v.value&&y.value?($(),R("div",ua,[S(l(Yt),{onChange:Ie})])):($(),R(xe,{key:1},[C("div",ca,[C("canvas",{ref_key:"canvasRef",ref:n,class:_e({"container-canvas":!0,"container-pointer":M.value}),onMousemove:Re,onMouseleave:Le,onClick:Pe},null,34),Ce(C("div",{class:"container-area",ref_key:"areaRef",ref:r,onMousemove:q,onMouseup:ae},[C("div",{class:"container-drag",ref_key:"dragRef",ref:c,onMousedown:fe},null,544)],544),[[be,!M.value]]),Ce(C("canvas",{ref_key:"layerRef",ref:_,class:"container-layer",style:Ge({borderRadius:`${l(de)}px`}),width:l(de),height:l(de)},null,12,ia),[[be,M.value&&m.value]])]),S(qe,{max:l(e).max,color:l(e).color,size:l(I),align:l(e).align,direction:l(e).direction,blur:l(e).blur,degree:l(e).degree,onChange:D,onPick:Be},null,8,["max","color","size","align","direction","blur","degree"])],64)),C("footer",da,[S(l(se),{label:v.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:Te},null,8,["label"])])]))}});const pa={class:"feature-property"},ga=U({props:{width:null,height:null,ipath:null},emits:["change"],setup(t,{emit:a}){const o=t,e=ce("text"),n=ce("updateText"),r=ce("paths"),{width:c,height:v,ipath:y}=ue(o),b=(M,m)=>{const _={width:c.value,height:v.value,ipath:y.value};_[m]=["ipath"].includes(m)?M:parseInt(M),a("change",_)};return(M,m)=>($(),R("div",pa,[S(l(te),{class:"feature-property-size",value:l(c),"onUpdate:modelValue":m[0]||(m[0]=_=>b(_,"width"))},null,8,["value"]),S(l(te),{class:"feature-property-size",value:l(v),"onUpdate:modelValue":m[1]||(m[1]=_=>b(_,"height"))},null,8,["value"]),S(l(Wt),{class:"feature-property-path",options:l(r),selected:l(y),"onUpdate:modelValue":m[2]||(m[2]=_=>b(_,"ipath"))},null,8,["options","selected"]),S(l(te),{class:"feature-property-text",value:l(e),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"])]))}}),nt={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getConfig:{url:"/image/config",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"},saveFeatureImage:{url:"/image/feature/save",method:"post"},getMaterialBase64:{url:"/material/base64",method:"get"},getMaterialCatalog:{url:"/material/catalog",method:"get"}},ha=()=>"https://imeme.vercel.app";var fa=t=>async(a={},o={})=>{const{url:e,method:n}=t,r=ha();return ft.request({withCredentials:!1,url:r+e,method:n,[n==="get"?"params":"data"]:a}).then(c=>{const v=c.data;return(o==null?void 0:o.stream)?c:v.errNo===0?v.data:Promise.reject(v)}).catch(c=>Promise.reject(c))};const G={};for(const t in nt)G[t]=fa(nt[t]);const ma={class:"container"},_a={class:"container-header"},ya={class:"container-title"},xa=["onMousedown"],wa=["width","height"],$a={class:"container-footer"},Ca=U({props:{feature:null},emits:["change"],setup(t,{emit:a}){const e=ue(t).feature,n=x(null),r=x(null),c=x(null),v=x(!1),y=x(!1),b=x(null),M="\u91D1\u9986\u957F",m=x("\u91D1\u9986\u957F"),_=x(""),f=s=>{m.value=s,p.value?Z():G.getMaterialBase64({ipath:P.value.ipath,value:s}).then(u=>{_.value=u,u?re.src=u:Z()})};ie("text",m),ie("updateText",f);const F=x(0),k=x(0),p=N(()=>e.value.type==="TEXT"),i=N(()=>{var s;return p.value?ke((s=e.value.et)==null?void 0:s.font):0}),D=N(()=>tt(e.value.story.image)),I=N(()=>{const s=p.value?A.value:P.value;return`${e.value.story.title}.${D.value} ${F.value} * ${k.value} (${s.x}, ${s.y})`}),A=N(()=>e.value.et),P=N(()=>e.value.ei),ve=N(()=>{if(p.value){const s=A.value.max||F.value;return{start:0,center:Math.floor(s/2),end:s}[A.value.align]}return 0}),ee=N(()=>{const{font:s,color:u,direction:g,blur:w,degree:B}=e.value.story,{x:L,y:z,width:V}=P.value;return{x:L+V/2,y:z+ke(s),max:V,font:s,color:u,align:"center",direction:g,blur:w,degree:B}}),pe=s=>{const{max:u,size:g,color:w,align:B,direction:L,blur:z,degree:V}=s;e.value.et.max=u,e.value.et.font=`${g}px sans-serif`,e.value.et.color=w,e.value.et.align=B,e.value.et.direction=L,e.value.et.blur=z,e.value.et.degree=V},re=new Image;re.onerror=s=>{console.error(s)},re.onload=()=>{Z()};const K=new Image,ge=()=>{K.onload=async()=>{const s=n.value;s.width=K.naturalWidth,s.height=K.naturalHeight,F.value=s.width,k.value=s.height,he(),Z(),H()},K.onerror=s=>{console.error(s)},K.src=e.value.story.image},he=()=>{const s=r.value;s.style.width=`${F.value}px`,s.style.height=`${k.value}px`},Z=()=>{const s=n.value,u=s.getContext("2d");if(u.drawImage(K,0,0),u.save(),Xe(u,s.width,M,e.value.story),p.value||!p.value&&!_.value){const g=p.value?A.value:ee.value;u.restore(),Xe(u,s.width,m.value,g)}else{const{x:g,y:w,width:B,height:L}=P.value;u.drawImage(re,g,w,B,L)}},H=()=>{let s=0,u=0,g=0,w=0;if(p.value){const{x:L,y:z,max:V}=A.value;s=V,u=i.value*Fe,g=z-i.value+2,w=L-ve.value}else{const{x:L,y:z,width:V,height:ne}=P.value;s=V,u=ne,g=z,w=L}const B=c.value;B.style.width=`${s}px`,B.style.height=`${u}px`,B.style.top=`${g}px`,B.style.left=`${w}px`};we(e,(s,u)=>{s.mid!==u.mid?ge():(Z(),H())},{deep:!0});let Q=0,fe=0;const q=20;let ae=!1;const Me=s=>{ae=!0;const{clientX:u,clientY:g}=s;Q=u,fe=g},De=s=>{if(!ae)return;const{clientX:u,clientY:g}=s,w=c.value,{width:B,height:L}=w.getBoundingClientRect();let z=w.offsetLeft+u-Q,V=w.offsetTop+g-fe;z<-q||V<-q||z>F.value-B+q||V>k.value-L+q?ae=!1:(Q=u,fe=g),z=Math.max(Math.min(z,F.value-B+q),-q),V=Math.max(Math.min(V,k.value-L+q),-q),Ee(z,V)},Ee=(s,u)=>{p.value?(A.value.x=s+ve.value,A.value.y=u+i.value-2):(P.value.x=s,P.value.y=u)},Te=()=>{!ae||(ae=!1)},Ie=()=>{const s=n.value,u=`imeme_${e.value.story.title}_${m.value}`;at(s,D.value,u)},me=()=>{const{mid:s,type:u,et:g,ei:w}=e.value;a("change",{mid:s,type:u,options:p.value?g:w})},Be=()=>{v.value=!0},Se=(s,u)=>{const g=n.value,w=b.value;et(g,w,s,u)},Re=async s=>{if(!v.value)return!1;const{offsetX:u,offsetY:g}=s;u<0||g<0||(y.value=!0,Se(u,g))},Le=()=>{if(!v.value)return!1;y.value=!1},ze=s=>{const u=z=>z.toString(16).padStart(2,"0"),{0:g,1:w,2:B,3:L}=s.data;return`#${u(g)}${u(w)}${u(B)}${u(L)}`.toUpperCase()},Ae=(s,u)=>{const B=n.value.getContext("2d").getImageData(s,u,1,1);return ze(B)},Pe=s=>{if(!v.value)return!1;const{offsetX:u,offsetY:g}=s;if(u<0||g<0)return;const w=Ae(u,g);e.value.et.color=w,y.value=!1,v.value=!1},d=x(null);let h=0,E=0,T=!1;const j=s=>{T=!0;const{clientX:u,clientY:g}=s;h=u,E=g},J=s=>{if(!T)return;const{clientX:u,clientY:g}=s,w=r.value,{x:B,y:L,width:z,height:V}=w.getBoundingClientRect();if(u<B||g<L||u>B+z||g>L+V){T=!1;return}const ne=u-h,lt=g-E,{width:ot,height:st}=P.value,Ye=c.value;Ye.style.width=`${ot+ne}px`,Ye.style.height=`${st+lt}px`},Y=s=>{if(!T)return;T=!1;const{clientX:u,clientY:g}=s,w=u-h,B=g-E,{width:L,height:z}=P.value;P.value.width=L+w,P.value.height=z+B},W=s=>{const{width:u,height:g,ipath:w}=s;e.value.ei.width=u,e.value.ei.height=g,e.value.ei.ipath=w};return $e(()=>{ge()}),(s,u)=>($(),R("div",ma,[C("div",_a,[C("div",ya,oe(l(I)),1),S(l(se),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ie})]),C("div",{class:"container-wraper",onMousemove:J,onMouseup:Y},[C("canvas",{ref_key:"canvasRef",ref:n,class:_e({"container-canvas":!0,"container-pointer":v.value}),onMousemove:Re,onMouseleave:Le,onClick:Pe},null,34),Ce(C("div",{class:"container-area",ref_key:"areaRef",ref:r,onMousemove:De,onMouseup:Te},[C("div",{class:"container-drag",ref_key:"dragRef",ref:c,onMousedown:Me},[l(p)?Ne("",!0):($(),R("div",{key:0,ref_key:"cornerRef",ref:d,class:"container-drag-corner",onMousedown:mt(j,["stop","prevent"])},null,40,xa))],544)],544),[[be,!v.value]]),Ce(C("canvas",{ref_key:"layerRef",ref:b,class:"container-layer",style:Ge({borderRadius:`${l(de)}px`}),width:l(de),height:l(de)},null,12,wa),[[be,v.value&&y.value]])],32),l(p)?($(),le(qe,{key:0,max:l(A).max,color:l(A).color,size:l(i),align:l(A).align,direction:l(A).direction,blur:l(A).blur,degree:l(A).degree,onChange:pe,onPick:Be},null,8,["max","color","size","align","direction","blur","degree"])):($(),le(ga,{key:1,width:l(P).width,height:l(P).height,ipath:l(P).ipath,onChange:W},null,8,["width","height","ipath"])),C("footer",$a,[S(l(se),{label:"\u66F4\u65B0",u:"primary",onClick:me})])]))}});const ba={class:"image-wrap"},Fa=U({setup(t){const a=x([]),o=x(""),e=x("");let n=x({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",blur:0,senior:0,degree:0}),r=x({mid:"",feature:"",type:"",story:n});const c=async()=>{const i=await G.getCatalog({});a.value=i},v=({type:i,child:D})=>{o.value!==D.mid&&(o.value=D.mid,e.value=i)};we([o,e],()=>{y(o.value,e.value)});const y=(i,D)=>{k.value?G.openImage({mid:i,type:D}).then(I=>{n.value=I}):G.getFeatureImage({mid:i}).then(I=>{r.value=I})},b=i=>{const D=Oe(Ve({},i),{image:""});G.saveImage(D)},M=i=>{n.value=i},m=async(i,D)=>{const I=await G.createImage(i).catch(A=>{alert(A.message)});I?(await c(),o.value=I.mid):D()},_=x([]),f=x();ie("commands",_),ie("paths",f);const F=async()=>{const{commands:i,paths:D}=await G.getConfig({});_.value=i,f.value=D.map(I=>({label:I,value:I}))},k=N(()=>["STORY","SERIES","SPECIAL"].includes(e.value)),p=({mid:i,type:D,options:I})=>{D==="TEXT"?G.saveImage(I):G.saveFeatureImage(Ve({mid:i,type:D},I))};return $e(()=>{c(),F()}),(i,D)=>($(),R("div",ba,[S(Dt,{current:o.value,"catalog-list":a.value,onChange:v},null,8,["current","catalog-list"]),l(k)&&l(n).image&&l(n).mid?($(),le(va,{key:0,story:l(n),onChange:b,onReplace:M,onCreate:m},null,8,["story"])):Ne("",!0),e.value==="FEATURE"&&l(r).mid?($(),le(Ca,{key:1,feature:l(r),onChange:p},null,8,["feature"])):Ne("",!0)]))}});const ka={class:"material-center"},Ma=U({setup(t){const a=()=>{G.getMaterialCatalog({type:"DB".toLowerCase()}).then(o=>{console.log(o)})};return $e(()=>{a()}),(o,e)=>($(),R("div",ka," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),Da=[{path:"/",component:Fa},{path:"/center",component:Ma}],Ea=_t({history:yt(),routes:Da});xt(bt).use(Ea).mount("#app");
