var fe=Object.defineProperty,_e=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,Fe=Object.prototype.propertyIsEnumerable;var Z=(a,e,s)=>e in a?fe(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s,P=(a,e)=>{for(var s in e||(e={}))ye.call(e,s)&&Z(a,s,e[s]);if(J)for(var s of J(e))Fe.call(e,s)&&Z(a,s,e[s]);return a},Q=(a,e)=>_e(a,he(e));import{a as xe,d as w,r as F,o as h,c as x,F as G,b as ee,e as y,t as V,n as K,f as z,w as be,g as W,i as te,h as X,j as $,u as d,p as ae,k as $e,l as ne,m as Ce,q as De}from"./vendor.47fcb162.js";const we=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};we();const le={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},Be=()=>"https://imeme.vercel.app";var Ee=a=>async(e={},s={})=>{const{url:t,method:n}=a,o=Be();return xe.request({withCredentials:!1,url:o+t,method:n,[n==="get"?"params":"data"]:e}).then(i=>{const r=i.data;return(s==null?void 0:s.stream)?i:r.errNo===0?r.data:Promise.reject(r)}).catch(i=>Promise.reject(i))};const N={};for(const a in le)N[a]=Ee(le[a]);const ke={class:"side"},Ae={class:"side-content-title"},Ie=["onClick"],Le=w({emits:["change"],setup(a,{emit:e}){const s=F([]),t=F(""),n=()=>{N.getCatalog({}).then(i=>{s.value=i})},o=(i,r)=>{t.value=r.mid,e("change",P({type:i},r))};return n(),(i,r)=>(h(),x("div",ke,[(h(!0),x(G,null,ee(s.value,m=>(h(),x("div",{key:m.id,class:"side-content"},[y("p",Ae,V(m.text),1),(h(!0),x(G,null,ee(m.children,v=>(h(),x("div",{key:v.mid,class:K({"side-content-cell":!0,"side-content-cell-active":t.value===v.mid}),onClick:_=>o(m.type,v)},V(v.title),11,Ie))),128))]))),128))]))}});var se=(a,e)=>{for(const[s,t]of e)a[s]=t;return a};const Te=w({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){const{label:e}=z(a);return{localLabel:e}}});function Me(a,e,s,t,n,o){return h(),x("button",{class:K(["meme-button",{disabled:a.disabled}])},V(a.localLabel),3)}var Y=se(Te,[["render",Me]]);const Ve=w({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:e}){const s=F(null),t=o=>{e("update:modelValue",o.target.value)};return{input:s,blur:o=>{t(o),e("blur")}}}}),Pe=["title","value"];function ze(a,e,s,t,n,o){return h(),x("input",{ref:"input",class:K(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:e[0]||(e[0]=(...i)=>a.blur&&a.blur(...i)),onKeyup:e[1]||(e[1]=be(i=>{var r;return(r=a.input)==null?void 0:r.blur()},["enter"]))},null,42,Pe)}var R=se(Ve,[["render",ze]]);const Ne=500,Re=300;w({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Ne},interval:{type:Number,default:Re}},created(){this.showChange(this.show)},setup(a){const{show:e,interval:s,min:t}=z(a),n=F(e.value);let o,i=0;const r=()=>{const _=new Date().getTime()-i;_>t.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(t.value-_,0))},m=v=>{v?s.value===0?(n.value=!0,i=new Date().getTime()):o=window.setTimeout(()=>{n.value=!0,i=new Date().getTime()},s.value):(clearTimeout(o),r())};return W(e,()=>{m(e.value)}),{localShow:n,showChange:m}}});const Se={class:"meme-radio"},je=["name","value","checked"],Ue={class:"meme-radio-label"},oe=w({props:{label:null,name:null,value:null,checked:null},emits:["toggle"],setup(a,{emit:e}){const s=t=>{e("toggle",t)};return(t,n)=>(h(),x("label",Se,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:n[0]||(n[0]=o=>s(a.value))},null,40,je),y("span",Ue,V(a.label),1)]))}});const Oe={class:"meme-file-upload"},qe={class:"file-button"},Ge=y("i",{class:"file-glyphicon"},null,-1),Ke=y("span",null,"UPLOAD FILE",-1),We=y("i",{class:"file-tips"},"Drop files here to upload",-1),Xe=[We],Ye=w({emits:["change"],setup(a,{emit:e}){const s=l=>{const c=l.target.files;if(!c)return!1;v(c)},t=l=>{l.stopPropagation(),l.preventDefault()},n=l=>{l.stopPropagation(),l.preventDefault()},o=l=>{l.stopPropagation(),l.preventDefault();const c=l.dataTransfer.files;v(c)},i=l=>{l.stopPropagation(),l.preventDefault();const c=l.clipboardData.files;v(c)},r=2*1024*1024,m=/^image\//,v=l=>{if(l.length!==1)return _("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const c=l[0],{name:S,size:I,type:L}=c;if(!m.test(L))return _(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${L}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;if(I>r)return _("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52362M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const C=new FileReader;C.onload=T=>{const j=T.target.result;D(S,j)},C.onerror=()=>{_(C.error.message)},C.readAsDataURL(c)},_=l=>{alert(l)},D=(l,c)=>{e("change",{name:l,base64:c})};return(l,c)=>(h(),x("div",Oe,[y("div",qe,[Ge,Ke,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",onChange:s},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:t,onDragover:n,onDrop:o,onPaste:i},Xe,32)]))}});const He={class:"property"},Je=w({props:{max:null,size:null,color:null,align:null},emits:["change"],setup(a,{emit:e}){const s=a,t=te("text"),n=te("updateText"),{max:o,size:i,color:r,align:m}=z(s),v=X(()=>m.value==="start"),_=(D,l)=>{const c={max:o.value,size:i.value,color:r.value,align:m.value};c[l]=["color","align"].includes(l)?D:parseInt(D),e("change",c)};return(D,l)=>(h(),x("div",He,[$(d(R),{class:"property-max",value:d(o),"onUpdate:modelValue":l[0]||(l[0]=c=>_(c,"max"))},null,8,["value"]),$(d(R),{class:"property-size",value:d(i),"onUpdate:modelValue":l[1]||(l[1]=c=>_(c,"size"))},null,8,["value"]),$(d(R),{class:"property-color",value:d(r),"onUpdate:modelValue":l[2]||(l[2]=c=>_(c,"color"))},null,8,["value"]),$(d(oe),{label:"start",name:"align",value:"start",checked:d(v),onToggle:l[3]||(l[3]=c=>_(c,"align"))},null,8,["checked"]),$(d(oe),{label:"end",name:"align",value:"end",checked:!d(v),onToggle:l[4]||(l[4]=c=>_(c,"align"))},null,8,["checked"]),$(d(R),{class:"property-text",value:d(t),"onUpdate:modelValue":d(n)},null,8,["value","onUpdate:modelValue"])]))}});const Ze={class:"container"},Qe={class:"container-header"},et={class:"container-title"},tt={key:0,class:"container-wall"},at={class:"container-wraper"},nt={class:"container-footer"},lt=w({props:{story:null},emits:["change"],setup(a,{emit:e}){const t=z(a).story,n=F(null),o=F(null),i=F(null),r=F(!0),m=F(!0),v=F("\u91D1\u9986\u957F"),_=u=>{v.value=u,U()};ae("text",v),ae("updateText",_);const D=F(0),l=F(0),c=(u,p)=>{t.value.x=u,t.value.y=p},S=u=>{const{max:p,size:g,color:f,align:b}=u;t.value.max=p,t.value.font=`${g}px sans-serif`,t.value.color=f,t.value.align=b},I=X(()=>{const u=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(u[1])*1}),L=X(()=>{var f;return((f=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:f[0])||"png"}),C=new Image,T=()=>{C.onload=async()=>{const u=n.value;u.width=C.naturalWidth,u.height=C.naturalHeight,D.value=u.width,l.value=u.height,j(),U(),H()},C.onerror=u=>{console.error(u)},C.src=t.value.image},j=()=>{const u=o.value;u.style.width=`${D.value}px`,u.style.height=`${l.value}px`},U=()=>{const u=n.value,p=u.getContext("2d");p.drawImage(C,0,0);const{x:g,y:f,font:b,color:B,align:k,max:A}=t.value;p.font=b,p.fillStyle=B,p.textAlign=k,p.fillText(v.value,g,f,A||u.width)},H=()=>{const{x:u,y:p,max:g,align:f}=t.value,b=i.value;b.style.width=`${g}px`,b.style.height=`${I.value}px`,b.style.top=`${p-I.value+2}px`,b.style.left=f==="start"?`${u}px`:`${u-g}px`};W(t,(u,p)=>{u.mid!==p.mid?T():(U(),H())},{deep:!0});let O=0,q=0;const E=20;let M=!1;const ue=u=>{M=!0;const{clientX:p,clientY:g}=u;O=p,q=g},re=u=>{if(!M)return;const{clientX:p,clientY:g}=u,f=i.value,{width:b,height:B}=f.getBoundingClientRect();let k=f.offsetLeft+p-O,A=f.offsetTop+g-q;k<-E||A<-E||k>D.value-b+E||A>l.value-B+E?M=!1:(O=p,q=g),k=Math.max(Math.min(k,D.value-b+E),-E),A=Math.max(Math.min(A,l.value-B+E),-E);const{align:me,max:ve}=t.value;k+=me==="end"?ve:0,A+=I.value-2,c(k,A)},ie=()=>{!M||(M=!1)},ce=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0\uFF1F\uFF1F\u4F60\u8FD9\u4E48\u62FD\uFF1F\uFF1F"),r.value?r.value=!1:(r.value=!0,T())},de=()=>{const u=n.value;let g=`image/${["jpeg","jpg"].includes(L.value)?"jpeg":"png"}`;const f=u.toDataURL(g),b=`imeme_${t.value.title}_${v.value}`,B=document.createElement("a");B.setAttribute("download",b),B.setAttribute("href",f),B.setAttribute("target","_blank"),B.click()},pe=()=>{r.value?e("change",t.value):console.log("\u4FDD\u5B58\u6DFB\u52A0\u5185\u5BB9\u3002")},ge=({name:u,base64:p})=>{console.log("change",u,p)};return $e(()=>{T()}),(u,p)=>(h(),x("div",Ze,[y("div",Qe,[y("div",et,V(`${d(t).title}.${d(L)}`),1),$(d(Y),{label:r.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:ce},null,8,["label"]),$(d(Y),{label:"\u4E0B\u8F7D",u:"primary",onClick:de})]),!r.value&&m.value?(h(),x("div",tt,[$(d(Ye),{onChange:ge})])):(h(),x(G,{key:1},[y("div",at,[y("canvas",{class:"container-canvas",ref:(g,f)=>{f.canvasRef=g,n.value=g}},null,512),y("div",{class:"container-area",ref:(g,f)=>{f.areaRef=g,o.value=g},onMousemove:re,onMouseup:ie},[y("div",{class:"container-drag",ref:(g,f)=>{f.dragRef=g,i.value=g},onMousedown:ue},null,544)],544)]),$(Je,{max:d(t).max,color:d(t).color,size:d(I),align:d(t).align,onChange:S},null,8,["max","color","size","align"])],64)),y("footer",nt,[$(d(Y),{label:r.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:pe},null,8,["label"])])]))}});const st={class:"image-wrap"},ot=w({setup(a){const e=F(""),s=F("");let t=F({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:r,mid:m})=>{e.value!==m&&(e.value=m,s.value=r)};W([e,s],()=>{o(e.value,s.value)});const o=(r,m)=>{N.openImage({mid:r,type:m}).then(v=>{t.value=v})},i=r=>{console.log("story change value: ",P({},r));const m=Q(P({},r),{image:""});N.saveImage(m)};return(r,m)=>(h(),x("div",st,[$(Le,{onChange:n}),d(t).image&&d(t).mid?(h(),ne(lt,{key:0,story:d(t),onChange:i},null,8,["story"])):Ce("",!0)]))}});const ut=w({setup(a){return(e,s)=>(h(),ne(ot))}});De(ut).mount("#app");
