var pe=Object.defineProperty,me=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var W=(t,e,l)=>e in t?pe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l,M=(t,e)=>{for(var l in e||(e={}))ge.call(e,l)&&W(t,l,e[l]);if(K)for(var l of K(e))fe.call(e,l)&&W(t,l,e[l]);return t},H=(t,e)=>me(t,ve(e));import{a as _e,d as C,r as h,o as y,c as b,F as X,b as Y,e as w,t as D,n as E,f as N,w as he,g as j,i as G,h as J,j as $,u as i,p as Q,k as ye,l as Z,m as xe,q as be}from"./vendor.b3ec0a9b.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}};$e();const ee={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},we=()=>"https://imeme.vercel.app";var Ce=t=>async(e={},l={})=>{const{url:a,method:n}=t,o=we();return _e.request({withCredentials:!1,url:o+a,method:n,[n==="get"?"params":"data"]:e}).then(r=>{const u=r.data;return(l==null?void 0:l.stream)?r:u.errNo===0?u.data:Promise.reject(u)}).catch(r=>Promise.reject(r))};const S={};for(const t in ee)S[t]=Ce(ee[t]);const ke={class:"side"},Be={class:"side-content-title"},Fe=["onClick"],Ie=C({emits:["change"],setup(t,{emit:e}){const l=h([]),a=h(""),n=()=>{S.getCatalog({}).then(r=>{l.value=r})},o=(r,u)=>{a.value=u.mid,e("change",M({type:r},u))};return n(),(r,u)=>(y(),b("div",ke,[(y(!0),b(X,null,Y(l.value,c=>(y(),b("div",{key:c.id,class:"side-content"},[w("p",Be,D(c.text),1),(y(!0),b(X,null,Y(c.children,m=>(y(),b("div",{key:m.mid,class:E({"side-content-cell":!0,"side-content-cell-active":a.value===m.mid}),onClick:_=>o(c.type,m)},D(m.title),11,Fe))),128))]))),128))]))}});var te=(t,e)=>{for(const[l,a]of e)t[l]=a;return t};const Te=C({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){const{label:e}=N(t);return{localLabel:e}}});function Ve(t,e,l,a,n,o){return y(),b("button",{class:E(["meme-button",{disabled:t.disabled}])},D(t.localLabel),3)}var U=te(Te,[["render",Ve]]);const De=C({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:e}){const l=h(null),a=o=>{e("update:modelValue",o.target.value)};return{input:l,blur:o=>{a(o),e("blur")}}}}),Le=["title","value"];function Me(t,e,l,a,n,o){return y(),b("input",{ref:"input",class:E(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:e[0]||(e[0]=(...r)=>t.blur&&t.blur(...r)),onKeyup:e[1]||(e[1]=he(r=>{var u;return(u=t.input)==null?void 0:u.blur()},["enter"]))},null,42,Le)}var q=te(De,[["render",Me]]);const Ne=500,Se=300;C({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Ne},interval:{type:Number,default:Se}},created(){this.showChange(this.show)},setup(t){const{show:e,interval:l,min:a}=N(t),n=h(e.value);let o,r=0;const u=()=>{const _=new Date().getTime()-r;_>a.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(a.value-_,0))},c=m=>{m?l.value===0?(n.value=!0,r=new Date().getTime()):o=window.setTimeout(()=>{n.value=!0,r=new Date().getTime()},l.value):(clearTimeout(o),u())};return j(e,()=>{c(e.value)}),{localShow:n,showChange:c}}});const qe={class:"meme-radio"},ze=["name","value","checked"],Re={class:"meme-radio-label"},ae=C({props:{label:{type:String,required:!0},name:{type:String,required:!0},value:{type:String,required:!0},checked:{type:Boolean,required:!0}},emits:["toggle"],setup(t,{emit:e}){const l=a=>{e("toggle",a)};return(a,n)=>(y(),b("label",qe,[w("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=o=>l(t.value))},null,40,ze),w("span",Re,D(t.label),1)]))}});const Ae={class:"property"},Ee=C({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0},align:{type:String,required:!0}},emits:["change"],setup(t,{emit:e}){const l=t,a=G("text"),n=G("updateText"),{max:o,size:r,color:u,align:c}=N(l),m=J(()=>c.value==="start"),_=(T,g)=>{const v={max:o.value,size:r.value,color:u.value,align:c.value};v[g]=["color","align"].includes(g)?T:parseInt(T),e("change",v)};return(T,g)=>(y(),b("div",Ae,[$(i(q),{class:"property-max",value:i(o),"onUpdate:modelValue":g[0]||(g[0]=v=>_(v,"max"))},null,8,["value"]),$(i(q),{class:"property-size",value:i(r),"onUpdate:modelValue":g[1]||(g[1]=v=>_(v,"size"))},null,8,["value"]),$(i(q),{class:"property-color",value:i(u),"onUpdate:modelValue":g[2]||(g[2]=v=>_(v,"color"))},null,8,["value"]),$(i(ae),{label:"start",name:"align",value:"start",checked:i(m),onToggle:g[3]||(g[3]=v=>_(v,"align"))},null,8,["checked"]),$(i(ae),{label:"end",name:"align",value:"end",checked:!i(m),onToggle:g[4]||(g[4]=v=>_(v,"align"))},null,8,["checked"]),$(i(q),{class:"property-text",value:i(a),"onUpdate:modelValue":i(n)},null,8,["value","onUpdate:modelValue"])]))}});const je={class:"container"},Ue={class:"container-header"},Pe={class:"container-title"},Oe={class:"container-wraper"},Ke={class:"container-footer"},We=C({props:{story:{type:null,required:!0}},emits:["change"],setup(t,{emit:e}){const a=N(t).story,n=h(null),o=h(null),r=h(null),u=h("\u91D1\u9986\u957F"),c=s=>{u.value=s,z()};Q("text",u),Q("updateText",c);const m=h(0),_=h(0),T=(s,p)=>{a.value.x=s,a.value.y=p},g=s=>{const{max:p,size:d,color:f,align:x}=s;a.value.max=p,a.value.font=`${d}px sans-serif`,a.value.color=f,a.value.align=x},v=J(()=>{const s=a.value.font.match(/(\d{1,3})px/)||["","32"];return Number(s[1])*1}),I=new Image,P=()=>{I.onload=async()=>{const s=n.value;s.width=I.naturalWidth,s.height=I.naturalHeight,m.value=s.width,_.value=s.height,ne(),z(),O()},I.onerror=s=>{console.error(s)},I.src=a.value.image},ne=()=>{const s=o.value;s.style.width=`${m.value}px`,s.style.height=`${_.value}px`},z=()=>{const s=n.value,p=s.getContext("2d");p.drawImage(I,0,0);const{x:d,y:f,font:x,color:L,align:B,max:F}=a.value;p.font=x,p.fillStyle=L,p.textAlign=B,p.fillText(u.value,d,f,F||s.width)},O=()=>{const{x:s,y:p,max:d,align:f}=a.value,x=r.value;x.style.width=`${d}px`,x.style.height=`${v.value}px`,x.style.top=`${p-v.value+2}px`,x.style.left=f==="start"?`${s}px`:`${s-d}px`};j(a,(s,p)=>{s.mid!==p.mid?P():(z(),O())},{deep:!0});let R=0,A=0;const k=20;let V=!1;const le=s=>{V=!0;const{clientX:p,clientY:d}=s;R=p,A=d},oe=s=>{if(!V)return;const{clientX:p,clientY:d}=s,f=r.value,{width:x,height:L}=f.getBoundingClientRect();let B=f.offsetLeft+p-R,F=f.offsetTop+d-A;B<-k||F<-k||B>m.value-x+k||F>_.value-L+k?V=!1:(R=p,A=d),B=Math.max(Math.min(B,m.value-x+k),-k),F=Math.max(Math.min(F,_.value-L+k),-k);const{align:ce,max:de}=a.value;B+=ce==="end"?de:0,F+=v.value-2,T(B,F)},se=()=>{!V||(V=!1)},re=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0")},ue=()=>{console.log("\u4F60\u60F3\u8981\u4E0B\u8F7D\u5C31\u4E0B\u8F7D");const s=n.value;console.log(s.toDataURL())},ie=()=>{e("change",a.value)};return ye(()=>{P()}),(s,p)=>(y(),b("div",je,[w("div",Ue,[w("div",Pe,D(i(a).title),1),$(i(U),{label:"\u6DFB\u52A0",u:"primary",onClick:re}),$(i(U),{label:"\u4E0B\u8F7D",u:"primary",onClick:ue})]),w("div",Oe,[w("canvas",{class:"container-canvas",ref:(d,f)=>{f.canvasRef=d,n.value=d}},null,512),w("div",{class:"container-area",ref:(d,f)=>{f.areaRef=d,o.value=d},onMousemove:oe,onMouseup:se},[w("div",{class:"container-drag",ref:(d,f)=>{f.dragRef=d,r.value=d},onMousedown:le},null,544)],544)]),$(Ee,{max:i(a).max,color:i(a).color,size:i(v),align:i(a).align,onChange:g},null,8,["max","color","size","align"]),w("footer",Ke,[$(i(U),{label:"\u66F4\u65B0",u:"primary",onClick:ie})])]))}});const He={class:"image-wrap"},Xe=C({setup(t){const e=h(""),l=h("");let a=h({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:u,mid:c})=>{e.value!==c&&(e.value=c,l.value=u)};j([e,l],()=>{o(e.value,l.value)});const o=(u,c)=>{S.openImage({mid:u,type:c}).then(m=>{a.value=m})},r=u=>{console.log("story change value: ",M({},u));const c=H(M({},u),{image:""});S.saveImage(c)};return(u,c)=>(y(),b("div",He,[$(Ie,{onChange:n}),i(a).image&&i(a).mid?(y(),Z(We,{key:0,story:i(a),onChange:r},null,8,["story"])):xe("",!0)]))}});const Ye=C({setup(t){return(e,l)=>(y(),Z(Xe))}});be(Ye).mount("#app");
