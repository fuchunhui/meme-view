var Ge=Object.defineProperty,He=Object.defineProperties;var Xe=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var Ye=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var _e=(a,n,o)=>n in a?Ge(a,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[n]=o,ue=(a,n)=>{for(var o in n||(n={}))Ye.call(n,o)&&_e(a,o,n[o]);if(he)for(var o of he(n))qe.call(n,o)&&_e(a,o,n[o]);return a},ye=(a,n)=>He(a,Xe(n));import{d as E,t as J,o as F,c as k,F as ce,r as Fe,u as p,a as _,b as W,n as Z,e as Ke,f as Je,g as b,w as Ze,h as ie,i as de,j as P,k as Q,l as xe,m as $,p as pe,q as we,s as be,v as Ce,x as Qe,y as et,z as tt,A as at}from"./vendor.cb49c80c.js";const nt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function o(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=o(e);fetch(e.href,r)}};nt();const lt={class:"side"},ot={class:"side-content-title"},st=["onClick"],rt=E({props:{catalogList:null,current:null},emits:["change"],setup(a,{emit:n}){const i=J(a).catalogList,e=(r,g)=>{n("change",ue({type:r},g))};return(r,g)=>(F(),k("div",lt,[(F(!0),k(ce,null,Fe(p(i),m=>(F(),k("div",{key:m.id,class:"side-content"},[_("p",ot,W(m.text),1),(F(!0),k(ce,null,Fe(m.children,f=>(F(),k("div",{key:f.mid,class:Z({"side-content-cell":!0,"side-content-cell-active":a.current===f.mid}),onClick:C=>e(m.type,f)},W(f.title),11,st))),128))]))),128))]))}});const G=E({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){return(n,o)=>(F(),k("button",{class:Z(["meme-button",{disabled:a.disabled}])},[Ke(n.$slots,"default",{},()=>[Je(W(a.label),1)])],2))}});var ut=(a,n)=>{const o=a.__vccOpts||a;for(const[i,e]of n)o[i]=e;return o};const ct=E({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:n}){const o=b(null),i=r=>{n("update:modelValue",r.target.value)};return{input:o,blur:r=>{i(r),n("blur")}}}}),it=["title","value"];function dt(a,n,o,i,e,r){return F(),k("input",{ref:"input",class:Z(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:n[0]||(n[0]=(...g)=>a.blur&&a.blur(...g)),onKeyup:n[1]||(n[1]=Ze(g=>{var m;return(m=a.input)==null?void 0:m.blur()},["enter"]))},null,42,it)}var ee=ut(ct,[["render",dt]]);const pt=500,vt=300;E({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:pt},interval:{type:Number,default:vt}},created(){this.showChange(this.show)},setup(a){const{show:n,interval:o,min:i}=J(a),e=b(n.value);let r,g=0;const m=()=>{const h=new Date().getTime()-g;h>i.value?e.value=!1:setTimeout(()=>{e.value=!1},Math.max(i.value-h,0))},f=C=>{C?o.value===0?(e.value=!0,g=new Date().getTime()):r=window.setTimeout(()=>{e.value=!0,g=new Date().getTime()},o.value):(clearTimeout(r),m())};return ie(n,()=>{f(n.value)}),{localShow:e,showChange:f}}});const gt={class:"meme-radio"},mt=["name","value","checked"],ft={class:"meme-radio-label"},H=E({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(a,{emit:n}){const o=i=>{n("toggle",i)};return(i,e)=>(F(),k("label",gt,[_("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:e[0]||(e[0]=r=>o(a.value))},null,40,mt),_("span",ft,W(a.label),1)]))}});const ht={class:"meme-file-upload"},_t={class:"file-button"},yt=_("i",{class:"file-glyphicon"},null,-1),Ft=_("span",null,"UPLOAD FILE",-1),xt=_("i",{class:"file-tips"},"Drop files here to upload",-1),wt=[xt],bt=E({emits:["change"],setup(a,{emit:n}){const o=de("commands"),i=u=>{const l=u.target.files;if(!l)return!1;h(l)},e=u=>{u.stopPropagation(),u.preventDefault()},r=u=>{u.stopPropagation(),u.preventDefault()},g=u=>{u.stopPropagation(),u.preventDefault();const l=u.dataTransfer.files;h(l)},m=u=>{u.stopPropagation(),u.preventDefault();const l=u.clipboardData.files;h(l)},f=1*1024*1024,C=/^image\//,h=u=>{if(u.length!==1)return x("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const l=u[0],{name:d,size:N,type:T}=l;if(!C.test(T))return x(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${T}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const V=d.replace(/\.\w*$/g,"");if(o.value.includes(V))return x(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${d}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${V}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(N>f)return x("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const S=new FileReader;S.onload=A=>{const te=A.target.result;M(d,te)},S.onerror=()=>{x(S.error.message)},S.readAsDataURL(l)},x=u=>{alert(u)},M=(u,l)=>{n("change",{name:u,base64:l})};return(u,l)=>(F(),k("div",ht,[_("div",_t,[yt,Ft,_("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:i},null,32)]),_("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:e,onDragover:r,onDrop:g,onPaste:m},wt,32)]))}});const Ct={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},$t=_("title",null,"dice",-1),kt=["fill"],Dt=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:n}){const o=a,i=P(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),e=()=>{n("click")};return(r,g)=>(F(),Q(p(G),{class:"dice-button",u:"icon",onClick:e},{default:xe(()=>[(F(),k("svg",Ct,[$t,_("path",{fill:p(i),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,kt)]))]),_:1}))}});const Et={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Mt=_("title",null,"picker",-1),Bt=["fill"],It=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:n}){const o=a,i=P(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),e=()=>{n("click")};return(r,g)=>(F(),Q(p(G),{class:"picker-button",u:"icon",onClick:e},{default:xe(()=>[(F(),k("svg",Et,[Mt,_("path",{fill:p(i),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Bt)]))]),_:1}))}});const Tt={class:"property"},St=E({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(a,{emit:n}){const o=a,i=de("text"),e=de("updateText"),{max:r,size:g,color:m,align:f,direction:C}=J(o),h=(u,l)=>{const d={max:r.value,size:g.value,color:m.value,align:f.value,direction:C.value};d[l]=["color","align","direction"].includes(l)?u:parseInt(u),n("change",d)},x=()=>{const u="#"+Math.floor(Math.random()*16777215).toString(16);h(u,"color")},M=()=>{n("pick")};return(u,l)=>(F(),k("div",Tt,[$(p(ee),{class:"property-max",value:p(r),"onUpdate:modelValue":l[0]||(l[0]=d=>h(d,"max"))},null,8,["value"]),$(p(ee),{class:"property-size",value:p(g),"onUpdate:modelValue":l[1]||(l[1]=d=>h(d,"size"))},null,8,["value"]),$(p(ee),{class:"property-color",value:p(m),"onUpdate:modelValue":l[2]||(l[2]=d=>h(d,"color"))},null,8,["value"]),$(Dt,{color:p(m),onClick:x},null,8,["color"]),$(It,{color:p(m),onClick:M},null,8,["color"]),$(p(H),{label:"start",name:"align",value:"start",checked:p(f)==="start",onToggle:l[3]||(l[3]=d=>h(d,"align"))},null,8,["checked"]),$(p(H),{label:"center",name:"align",value:"center",checked:p(f)==="center",onToggle:l[4]||(l[4]=d=>h(d,"align"))},null,8,["checked"]),$(p(H),{label:"end",name:"align",value:"end",checked:p(f)==="end",onToggle:l[5]||(l[5]=d=>h(d,"align"))},null,8,["checked"]),$(p(ee),{class:"property-text",value:p(i),"onUpdate:modelValue":p(e)},null,8,["value","onUpdate:modelValue"]),$(p(H),{label:"up",name:"direction",value:"up",checked:p(C)==="up",onToggle:l[6]||(l[6]=d=>h(d,"direction"))},null,8,["checked"]),$(p(H),{label:"down",name:"direction",value:"down",checked:p(C)==="down",onToggle:l[7]||(l[7]=d=>h(d,"direction"))},null,8,["checked"])]))}}),At=(a,n,o)=>{let i=0,e=a.length-1;for(;i<=e;){const r=Math.floor((i+e)/2),g=o.measureText(a.substring(0,r)).width,m=o.measureText(a.substring(0,r+1)).width;if(g<=n&&m>n)return r;g<n?i=r+1:e=r-1}return-1},Lt=(a,n,o)=>{const i=[];let e=0;for(;(e=At(a,n,o))!==-1;)i.push(a.substring(0,e)),a=a.substring(e);return a&&i.push(a),i};const zt={class:"container"},Pt={class:"container-header"},Rt={class:"container-title"},Nt={key:0,class:"container-wall"},Vt={class:"container-wraper"},Ut={class:"container-footer"},jt=E({props:{story:null},emits:["change","create","replace"],setup(a,{emit:n}){const o=a,i=1.2,e=J(o).story,r=b(null),g=b(null),m=b(null),f=b(!0),C=b(!0);let h=null;const x=b(!1),M=b(!1),u=b(null),l=11,d=14,N=d*l,T=d*l,V=d,S=(()=>{const t=[];for(let s=1;s<l;s++)t.push([s,0,s,l]),t.push([0,s,l,s]);return t.map(s=>s.map(c=>c*d))})(),A=b("\u91D1\u9986\u957F"),te=t=>{A.value=t,ne()};pe("text",A),pe("updateText",te);const L=b(0),U=b(0),ke=(t,s)=>{e.value.x=t,e.value.y=s},De=t=>{const{max:s,size:c,color:v,align:y,direction:w}=t;e.value.max=s,e.value.font=`${c}px sans-serif`,e.value.color=v,e.value.align=y,e.value.direction=w},j=P(()=>{const t=e.value.font.match(/(\d{1,3})px/)||["","32"];return Number(t[1])}),ve=P(()=>{var v;return((v=e.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:v[0])||"png"}),Ee=P(()=>`${e.value.title}.${ve.value} ${L.value} * ${U.value} (${e.value.x}, ${e.value.y})`),ge=P(()=>{const t=e.value.max||L.value;return{start:0,center:Math.floor(t/2),end:t}[e.value.align]}),z=new Image,ae=()=>{z.onload=async()=>{const t=r.value;t.width=z.naturalWidth,t.height=z.naturalHeight,L.value=t.width,U.value=t.height,Me(),ne(),me()},z.onerror=t=>{console.error(t)},z.src=e.value.image},Me=()=>{const t=g.value;t.style.width=`${L.value}px`,t.style.height=`${U.value}px`},ne=()=>{const t=r.value,s=t.getContext("2d");s.drawImage(z,0,0);const{x:c,y:v,font:y,color:w,align:D,max:B,direction:se}=e.value;s.font=y,s.fillStyle=w,s.textAlign=D;const X=B||t.width,Y=Lt(A.value,X,s);Y.forEach((re,q)=>{const K=se==="down"?q:q-(Y.length-1);s.fillText(re,c,v+K*j.value*i,X)})},me=()=>{const{x:t,y:s,max:c}=e.value,v=m.value;v.style.width=`${c}px`,v.style.height=`${j.value*i}px`,v.style.top=`${s-j.value+2}px`,v.style.left=`${t-ge.value}px`};ie(e,(t,s)=>{t.mid!==s.mid?ae():(ne(),me())},{deep:!0});let le=0,oe=0;const I=20;let O=!1;const Be=t=>{O=!0;const{clientX:s,clientY:c}=t;le=s,oe=c},Ie=t=>{if(!O)return;const{clientX:s,clientY:c}=t,v=m.value,{width:y,height:w}=v.getBoundingClientRect();let D=v.offsetLeft+s-le,B=v.offsetTop+c-oe;D<-I||B<-I||D>L.value-y+I||B>U.value-w+I?O=!1:(le=s,oe=c),D=Math.max(Math.min(D,L.value-y+I),-I),B=Math.max(Math.min(B,U.value-w+I),-I),D+=ge.value,B+=j.value-2,ke(D,B)},Te=()=>{!O||(O=!1)},Se=()=>{f.value?f.value=!1:(f.value=!0,C.value=!0,h?(fe(h),h=null):ae())},Ae=()=>{const t=r.value;let c=`image/${["jpeg","jpg"].includes(ve.value)?"jpeg":"png"}`;const v=t.toDataURL(c),y=`imeme_${e.value.title}_${A.value}`,w=document.createElement("a");w.setAttribute("download",y),w.setAttribute("href",v),w.setAttribute("target","_blank"),w.click()},Le=()=>{f.value?n("change",e.value):C.value||(n("create",e.value),f.value=!0,C.value=!0)},ze=({name:t,base64:s})=>{C.value=!1;const{mid:c,title:v,feature:y,image:w,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q}=e.value;h={mid:c,title:v,feature:y,image:w,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q};const K=t.slice(0,t.lastIndexOf("."));fe({mid:`meme_${new Date().getTime()}`,title:K,feature:K,image:s,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down"})},fe=t=>{n("replace",t)},Pe=()=>{x.value=!0},Re=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(l*d/2,l*d/2,l*d/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",S.forEach(s=>{const{0:c,1:v,2:y,3:w}=s;t.moveTo(c,v),t.lineTo(y,w)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((l-1)*d/2,(l-1)*d/2,1*d,1*d),t.stroke()},Ne=(t,s)=>{const c=r.value,v=u.value;v.style.left=`${t+V}px`,v.style.top=`${s+V}px`;const y=v.getContext("2d"),w=Math.min(Math.max(0,t-5),c.width-l),D=Math.min(Math.max(0,s-5),c.height-l);y.clearRect(0,0,N,T),y.drawImage(c,w,D,l,l,0,0,N,T),Re(y)},Ve=async t=>{if(!x.value)return!1;const{offsetX:s,offsetY:c}=t;s<0||c<0||(M.value=!0,Ne(s,c))},Ue=()=>{if(!x.value)return!1;M.value=!1},je=t=>{const s=D=>D.toString(16).padStart(2,"0"),{0:c,1:v,2:y,3:w}=t.data;return`#${s(c)}${s(v)}${s(y)}${s(w)}`.toUpperCase()},Oe=(t,s)=>{const y=r.value.getContext("2d").getImageData(t,s,1,1);return je(y)},We=t=>{if(!x.value)return!1;const{offsetX:s,offsetY:c}=t;if(s<0||c<0)return;const v=Oe(s,c);e.value.color=v,M.value=!1,x.value=!1};return we(()=>{ae()}),(t,s)=>(F(),k("div",zt,[_("div",Pt,[_("div",Rt,W(p(Ee)),1),$(p(G),{label:f.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Se},null,8,["label"]),$(p(G),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ae})]),!f.value&&C.value?(F(),k("div",Nt,[$(p(bt),{onChange:ze})])):(F(),k(ce,{key:1},[_("div",Vt,[_("canvas",{ref:(c,v)=>{v.canvasRef=c,r.value=c},class:Z({"container-canvas":!0,"container-pointer":x.value}),onMousemove:Ve,onMouseleave:Ue,onClick:We},null,34),be(_("div",{class:"container-area",ref:(c,v)=>{v.areaRef=c,g.value=c},onMousemove:Ie,onMouseup:Te},[_("div",{class:"container-drag",ref:(c,v)=>{v.dragRef=c,m.value=c},onMousedown:Be},null,544)],544),[[Ce,!x.value]]),be(_("canvas",{ref:(c,v)=>{v.layerRef=c,u.value=c},class:"container-layer",style:Qe({borderRadius:`${l*d}px`}),width:N,height:T},null,4),[[Ce,x.value&&M.value]])]),$(St,{max:p(e).max,color:p(e).color,size:p(j),align:p(e).align,direction:p(e).direction,onChange:De,onPick:Pe},null,8,["max","color","size","align","direction"])],64)),_("footer",Ut,[$(p(G),{label:f.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:Le},null,8,["label"])])]))}}),$e={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"}},Ot=()=>"https://imeme.vercel.app";var Wt=a=>async(n={},o={})=>{const{url:i,method:e}=a,r=Ot();return et.request({withCredentials:!1,url:r+i,method:e,[e==="get"?"params":"data"]:n}).then(g=>{const m=g.data;return(o==null?void 0:o.stream)?g:m.errNo===0?m.data:Promise.reject(m)}).catch(g=>Promise.reject(g))};const R={};for(const a in $e)R[a]=Wt($e[a]);const Gt={class:"image-wrap"},Ht=E({setup(a){const n=b([]),o=b(""),i=b("");let e=b({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down"});const r=async()=>{const u=await R.getCatalog({});n.value=u},g=({type:u,mid:l})=>{o.value!==l&&(o.value=l,i.value=u)};ie([o,i],()=>{m(o.value,i.value)});const m=(u,l)=>{R.openImage({mid:u,type:l}).then(d=>{e.value=d})},f=u=>{const l=ye(ue({},u),{image:""});R.saveImage(l)},C=u=>{e.value=u},h=async u=>{const l=await R.createImage(u).catch(d=>{alert(d.message)});await r(),o.value=l.mid},x=b([]);pe("commands",x);const M=async()=>{const u=await R.getCommands({});x.value=u};return we(()=>{r(),M()}),(u,l)=>(F(),k("div",Gt,[$(rt,{current:o.value,"catalog-list":n.value,onChange:g},null,8,["current","catalog-list"]),p(e).image&&p(e).mid?(F(),Q(jt,{key:0,story:p(e),onChange:f,onReplace:C,onCreate:h},null,8,["story"])):tt("",!0)]))}});const Xt=E({setup(a){return(n,o)=>(F(),Q(Ht))}});at(Xt).mount("#app");
