var ge=Object.defineProperty,_e=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var X=(t,e,l)=>e in t?ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l,S=(t,e)=>{for(var l in e||(e={}))he.call(e,l)&&X(t,l,e[l]);if(J)for(var l of J(e))ye.call(e,l)&&X(t,l,e[l]);return t},Y=(t,e)=>_e(t,fe(e));import{a as xe,d as F,r as f,o as _,c as y,F as U,b as Q,e as w,t as V,n as P,f as A,w as be,g as O,h as $e,i as Z,j as K,k as b,u as i,p as ee,l as Fe,m as te,q as we,s as Ce}from"./vendor.8920d98a.js";const ke=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const u of s.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function l(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(n){if(n.ep)return;n.ep=!0;const s=l(n);fetch(n.href,s)}};ke();const ae={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},Be=()=>"https://imeme.vercel.app";var De=t=>async(e={},l={})=>{const{url:a,method:n}=t,s=Be();return xe.request({withCredentials:!1,url:s+a,method:n,[n==="get"?"params":"data"]:e}).then(u=>{const r=u.data;return(l==null?void 0:l.stream)?u:r.errNo===0?r.data:Promise.reject(r)}).catch(u=>Promise.reject(u))};const M={};for(const t in ae)M[t]=De(ae[t]);const Ie={class:"side"},Le={class:"side-content-title"},Te=["onClick"],Ve=F({emits:["change"],setup(t,{emit:e}){const l=f([]),a=f(""),n=()=>{M.getCatalog({}).then(u=>{l.value=u})},s=(u,r)=>{a.value=r.mid,e("change",S({type:u},r))};return n(),(u,r)=>(_(),y("div",Ie,[(_(!0),y(U,null,Q(l.value,p=>(_(),y("div",{key:p.id,class:"side-content"},[w("p",Le,V(p.text),1),(_(!0),y(U,null,Q(p.children,g=>(_(),y("div",{key:g.mid,class:P({"side-content-cell":!0,"side-content-cell-active":a.value===g.mid}),onClick:$=>s(p.type,g)},V(g.title),11,Te))),128))]))),128))]))}});var ne=(t,e)=>{for(const[l,a]of e)t[l]=a;return t};const Ne=F({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){const{label:e}=A(t);return{localLabel:e}}});function Se(t,e,l,a,n,s){return _(),y("button",{class:P(["meme-button",{disabled:t.disabled}])},V(t.localLabel),3)}var W=ne(Ne,[["render",Se]]);const Ae=F({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:e}){const l=f(null),a=s=>{e("update:modelValue",s.target.value)};return{input:l,blur:s=>{a(s),e("blur")}}}}),Me=["title","value"];function ze(t,e,l,a,n,s){return _(),y("input",{ref:"input",class:P(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:e[0]||(e[0]=(...u)=>t.blur&&t.blur(...u)),onKeyup:e[1]||(e[1]=be(u=>{var r;return(r=t.input)==null?void 0:r.blur()},["enter"]))},null,42,Me)}var z=ne(Ae,[["render",ze]]);const qe=500,Ee=300;F({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:qe},interval:{type:Number,default:Ee}},created(){this.showChange(this.show)},setup(t){const{show:e,interval:l,min:a}=A(t),n=f(e.value);let s,u=0;const r=()=>{const $=new Date().getTime()-u;$>a.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(a.value-$,0))},p=g=>{g?l.value===0?(n.value=!0,u=new Date().getTime()):s=window.setTimeout(()=>{n.value=!0,u=new Date().getTime()},l.value):(clearTimeout(s),r())};return O(e,()=>{p(e.value)}),{localShow:n,showChange:p}}});const Re={class:"meme-radio"},je=["name","value","checked"],Ue={class:"meme-radio-label"},le=F({props:{label:{type:String,required:!0},name:{type:String,required:!0},value:{type:String,required:!0},checked:{type:Boolean,required:!0}},emits:["toggle"],setup(t,{emit:e}){const l=a=>{e("toggle",a)};return(a,n)=>(_(),y("label",Re,[w("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=s=>l(t.value))},null,40,je),w("span",Ue,V(t.label),1)]))}});const Pe={class:"meme-file-upload"},Oe=$e('<div class="file-button"><i class="file-glyphicon"></i><span>UPLOAD FILE</span><input class="file-input" type="file" name="file"></div><div class="file-area"><i class="file-tips">Drop files here to upload</i></div>',2),Ke=[Oe],We=F({setup(t){return(e,l)=>(_(),y("div",Pe,Ke))}});const Ge={class:"property"},He=F({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0},align:{type:String,required:!0}},emits:["change"],setup(t,{emit:e}){const l=t,a=Z("text"),n=Z("updateText"),{max:s,size:u,color:r,align:p}=A(l),g=K(()=>p.value==="start"),$=(k,m)=>{const h={max:s.value,size:u.value,color:r.value,align:p.value};h[m]=["color","align"].includes(m)?k:parseInt(k),e("change",h)};return(k,m)=>(_(),y("div",Ge,[b(i(z),{class:"property-max",value:i(s),"onUpdate:modelValue":m[0]||(m[0]=h=>$(h,"max"))},null,8,["value"]),b(i(z),{class:"property-size",value:i(u),"onUpdate:modelValue":m[1]||(m[1]=h=>$(h,"size"))},null,8,["value"]),b(i(z),{class:"property-color",value:i(r),"onUpdate:modelValue":m[2]||(m[2]=h=>$(h,"color"))},null,8,["value"]),b(i(le),{label:"start",name:"align",value:"start",checked:i(g),onToggle:m[3]||(m[3]=h=>$(h,"align"))},null,8,["checked"]),b(i(le),{label:"end",name:"align",value:"end",checked:!i(g),onToggle:m[4]||(m[4]=h=>$(h,"align"))},null,8,["checked"]),b(i(z),{class:"property-text",value:i(a),"onUpdate:modelValue":i(n)},null,8,["value","onUpdate:modelValue"])]))}});const Je={class:"container"},Xe={class:"container-header"},Ye={class:"container-title"},Qe={key:0,class:"container-wall"},Ze={class:"container-wraper"},et={class:"container-footer"},tt=F({props:{story:{type:null,required:!0}},emits:["change"],setup(t,{emit:e}){const a=A(t).story,n=f(null),s=f(null),u=f(null),r=f(!0),p=f(!0),g=f("\u91D1\u9986\u957F"),$=o=>{g.value=o,E()};ee("text",g),ee("updateText",$);const k=f(0),m=f(0),h=(o,d)=>{a.value.x=o,a.value.y=d},se=o=>{const{max:d,size:c,color:v,align:x}=o;a.value.max=d,a.value.font=`${c}px sans-serif`,a.value.color=v,a.value.align=x},N=K(()=>{const o=a.value.font.match(/(\d{1,3})px/)||["","32"];return Number(o[1])*1}),G=K(()=>{var v;return((v=a.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:v[0])||"png"}),L=new Image,q=()=>{L.onload=async()=>{const o=n.value;o.width=L.naturalWidth,o.height=L.naturalHeight,k.value=o.width,m.value=o.height,oe(),E(),H()},L.onerror=o=>{console.error(o)},L.src=a.value.image},oe=()=>{const o=s.value;o.style.width=`${k.value}px`,o.style.height=`${m.value}px`},E=()=>{const o=n.value,d=o.getContext("2d");d.drawImage(L,0,0);const{x:c,y:v,font:x,color:C,align:D,max:I}=a.value;d.font=x,d.fillStyle=C,d.textAlign=D,d.fillText(g.value,c,v,I||o.width)},H=()=>{const{x:o,y:d,max:c,align:v}=a.value,x=u.value;x.style.width=`${c}px`,x.style.height=`${N.value}px`,x.style.top=`${d-N.value+2}px`,x.style.left=v==="start"?`${o}px`:`${o-c}px`};O(a,(o,d)=>{o.mid!==d.mid?q():(E(),H())},{deep:!0});let R=0,j=0;const B=20;let T=!1;const re=o=>{T=!0;const{clientX:d,clientY:c}=o;R=d,j=c},ue=o=>{if(!T)return;const{clientX:d,clientY:c}=o,v=u.value,{width:x,height:C}=v.getBoundingClientRect();let D=v.offsetLeft+d-R,I=v.offsetTop+c-j;D<-B||I<-B||D>k.value-x+B||I>m.value-C+B?T=!1:(R=d,j=c),D=Math.max(Math.min(D,k.value-x+B),-B),I=Math.max(Math.min(I,m.value-C+B),-B);const{align:ve,max:me}=a.value;D+=ve==="end"?me:0,I+=N.value-2,h(D,I)},ie=()=>{!T||(T=!1)},ce=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0\uFF1F\uFF1F\u4F60\u8FD9\u4E48\u62FD\uFF1F\uFF1F"),r.value?r.value=!1:(r.value=!0,q())},de=()=>{const o=n.value;let c=`image/${["jpeg","jpg"].includes(G.value)?"jpeg":"png"}`;const v=o.toDataURL(c),x=`imeme_${a.value.title}_${g.value}`,C=document.createElement("a");C.setAttribute("download",x),C.setAttribute("href",v),C.setAttribute("target","_blank"),C.click()},pe=()=>{r.value?e("change",a.value):console.log("\u4FDD\u5B58\u6DFB\u52A0\u5185\u5BB9\u3002")};return Fe(()=>{q()}),(o,d)=>(_(),y("div",Je,[w("div",Xe,[w("div",Ye,V(`${i(a).title}.${i(G)}`),1),b(i(W),{label:r.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:ce},null,8,["label"]),b(i(W),{label:"\u4E0B\u8F7D",u:"primary",onClick:de})]),!r.value&&p.value?(_(),y("div",Qe,[b(i(We))])):(_(),y(U,{key:1},[w("div",Ze,[w("canvas",{class:"container-canvas",ref:(c,v)=>{v.canvasRef=c,n.value=c}},null,512),w("div",{class:"container-area",ref:(c,v)=>{v.areaRef=c,s.value=c},onMousemove:ue,onMouseup:ie},[w("div",{class:"container-drag",ref:(c,v)=>{v.dragRef=c,u.value=c},onMousedown:re},null,544)],544)]),b(He,{max:i(a).max,color:i(a).color,size:i(N),align:i(a).align,onChange:se},null,8,["max","color","size","align"])],64)),w("footer",et,[b(i(W),{label:r.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:pe},null,8,["label"])])]))}});const at={class:"image-wrap"},nt=F({setup(t){const e=f(""),l=f("");let a=f({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:r,mid:p})=>{e.value!==p&&(e.value=p,l.value=r)};O([e,l],()=>{s(e.value,l.value)});const s=(r,p)=>{M.openImage({mid:r,type:p}).then(g=>{a.value=g})},u=r=>{console.log("story change value: ",S({},r));const p=Y(S({},r),{image:""});M.saveImage(p)};return(r,p)=>(_(),y("div",at,[b(Ve,{onChange:n}),i(a).image&&i(a).mid?(_(),te(tt,{key:0,story:i(a),onChange:u},null,8,["story"])):we("",!0)]))}});const lt=F({setup(t){return(e,l)=>(_(),te(nt))}});Ce(lt).mount("#app");
