var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l;"undefined"!=typeof require&&require;import{a as n,d as r,r as s,o as u,c as i,F as c,b as d,e as m,t as p,f as v,n as g,w as h,g as f,h as y,v as b,i as w,u as x,j as C,k as V,l as k,m as I,p as M,q}from"./vendor.e7f1b77f.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const z={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"}};var F=e=>async(t={},a={})=>{const{url:l,method:o}=e;return n.request({withCredentials:!1,url:"http://localhost:8080"+l,method:o,["get"===o?"params":"data"]:t}).then((e=>{const t=e.data;return(null==a?void 0:a.stream)?e:0===t.errNo?t.data:Promise.reject(t)})).catch((e=>Promise.reject(e)))};const N={};for(const Q in z)N[Q]=F(z[Q]);const S={class:"side"},j={class:"side-content-title"},B=["onClick"];var L=r({emits:["change"],setup(e,{emit:n}){const r=s([]),v=(e,r)=>{n("change",((e,n)=>{for(var r in n||(n={}))a.call(n,r)&&o(e,r,n[r]);if(t)for(var r of t(n))l.call(n,r)&&o(e,r,n[r]);return e})({type:e},r))};return N.getCatalog({}).then((e=>{r.value=e})),(e,t)=>(u(),i("div",S,[(u(!0),i(c,null,d(r.value,(e=>(u(),i("div",{key:e.id,class:"side-content"},[m("p",j,p(e.text),1),(u(!0),i(c,null,d(e.children,(t=>(u(),i("div",{key:t.mid,class:"side-content-cell",onClick:a=>v(e.type,t)},p(t.title),9,B)))),128))])))),128))]))}}),T=r({name:"Button",props:{label:{type:String,default:"提交"},disabled:{type:Boolean,default:!1}},setup(e){const{label:t}=v(e);return{localLabel:t}}});T.render=function(e,t,a,l,o,n){return u(),i("button",{class:g(["meme-button",{disabled:e.disabled}])},p(e.localLabel),3)};var A=r({name:"Input",props:{modelValue:{type:String,default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:t}){const a=s(null);return{input:a,blur:e=>{(e=>{t("update:modelValue",e.target.value)})(e),t("blur")}}}});const O=["title","value"];A.render=function(e,t,a,l,o,n){return u(),i("input",{ref:"input",class:g(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:t[0]||(t[0]=(...t)=>e.blur&&e.blur(...t)),onKeyup:t[1]||(t[1]=h((t=>{var a;return null==(a=e.input)?void 0:a.blur()}),["enter"]))},null,42,O)};var $=r({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:500},interval:{type:Number,default:300}},created(){this.showChange(this.show)},setup(e){const{show:t,interval:a,min:l}=v(e),o=s(t.value);let n,r=0;const u=e=>{e?0===a.value?(o.value=!0,r=(new Date).getTime()):n=window.setTimeout((()=>{o.value=!0,r=(new Date).getTime()}),a.value):(clearTimeout(n),(()=>{const e=(new Date).getTime()-r;e>l.value?o.value=!1:setTimeout((()=>{o.value=!1}),Math.max(l.value-e,0))})())};return f(t,(()=>{u(t.value)})),{localShow:o,showChange:u}}});const P={class:"meme-loading"},R=[m("div",{class:"meme-loading-wrap"},[m("svg",{xmlns:"http://www.w3.org/2000/svg",width:"41",height:"41",viewBox:"0 0 32 32",class:"meme-loading-spinner"},[m("path",{d:"M32 16a15.832 15.832 0 0 0-4.864-11.137 15.717 15.717 0 0 0-5.156-3.302A15.512 15.512 0 0 0 15.999.5 15.335 15.335 0 0 0 5.216 5.216a15.23 15.23 0 0 0-3.193 4.994A15.027 15.027 0 0 0 1 16a14.92 14.92 0 0 0 1.254 5.694A14.84 14.84 0 0 0 5.57 26.43a14.708 14.708 0 0 0 4.832 3.085A14.534 14.534 0 0 0 16 30.5c1.897-.04 3.78-.455 5.502-1.216a14.346 14.346 0 0 0 4.574-3.208 14.213 14.213 0 0 0 2.977-4.67c.407-1.046.684-2.137.829-3.244a2 2 0 0 0 2.111-2.163H32zm-3.178 5.311c-.733 1.663-1.796 3.169-3.099 4.412s-2.844 2.225-4.508 2.868A13.536 13.536 0 0 1 16 29.5a13.328 13.328 0 0 1-9.369-4.131 13.246 13.246 0 0 1-2.76-4.346 13.048 13.048 0 0 1 .231-9.952c.683-1.541 1.672-2.937 2.883-4.088s2.642-2.058 4.184-2.652a12.539 12.539 0 0 1 9.568.231c1.48.658 2.82 1.609 3.926 2.774s1.975 2.54 2.543 4.021c.57 1.481.837 3.064.794 4.641h.007a2 2 0 0 0 1.777 2.155 13.829 13.829 0 0 1-.962 3.156z"})])],-1)];$.render=function(e,t,a,l,o,n){return y((u(),i("div",P,R,512)),[[b,e.localShow]])};const D={class:"property"};var U=r({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0}},emits:["change"],setup(e,{emit:t}){const a=e,{max:l,size:o,color:n}=v(a),r=s(l.value+""),c=s(o.value+""),d=s(n.value);return f([r,c,d],(()=>{t("change",{max:parseInt(r.value),size:parseInt(c.value),color:d.value})})),(e,t)=>(u(),i("div",D,[w(x(A),{class:"property-max",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e)},null,8,["modelValue"]),w(x(A),{class:"property-size",modelValue:c.value,"onUpdate:modelValue":t[1]||(t[1]=e=>c.value=e)},null,8,["modelValue"]),w(x(A),{class:"property-color",modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=e=>d.value=e)},null,8,["modelValue"])]))}});const E={class:"container"},H={class:"container-header"},K={class:"container-title"},X={class:"container-wraper"},Y={class:"container-footer"};var W=r({props:{story:{type:null,required:!0}},emits:["change"],setup(e,{emit:t}){const a=v(e).story,l=s(null),o=s(null),n=s(null),r=s("测试文本"),c=s(0),d=s(0),g=()=>{console.log("你说更新就更新")},h=()=>{t("change",a.value)},y=e=>{const{max:t,size:l,color:o}=e;a.value.max=t,a.value.font=`${l}px sans-serif`,a.value.color=o},b=C((()=>{const e=a.value.font.match(/(\d{1,3})px/)||["","32"];return 1*Number(e[1])})),k=new Image,I=()=>{const e=o.value;e.style.width=`${c.value}px`,e.style.height=`${d.value}px`},M=()=>{const e=l.value,t=e.getContext("2d");t.drawImage(k,0,0);const{x:o,y:n,font:s,color:u,align:i,max:c}=a.value;t.font=s,t.fillStyle=u,t.textAlign=i,t.textBaseline="top",t.fillText(r.value,o,n,c||e.width)},q=()=>{const{x:e,y:t,color:l,max:o}=a.value,r=n.value;r.style.width=`${o||100}px`,r.style.height=`${b.value}px`,r.style.top=`${t}px`,r.style.left=`${e}px`,r.style.borderColor=l||"#FF0000"};f(a,(()=>{M(),q()}),{deep:!0});let z=0,F=0;const N=10;let S=!1;const j=e=>{S=!0;const{clientX:t,clientY:a}=e;z=t,F=a},B=e=>{if(!S)return;const{clientX:t,clientY:l}=e,o=n.value;let r=o.offsetLeft+t-z,s=o.offsetTop+l-F;const{width:u,height:i}=o.getBoundingClientRect();r<-10||s<-10||r>c.value-u+N||s>d.value-i+N?S=!1:(z=t,F=l),r=Math.max(Math.min(r,c.value-u+N),-10),s=Math.max(Math.min(s,d.value-i+N),-10),((e,t)=>{a.value.x=e,a.value.y=t})(r,s)},L=()=>{S&&(S=!1)};return V((()=>{k.onload=async()=>{const e=l.value;e.width=k.naturalWidth,e.height=k.naturalHeight,console.log("width: ",e.width,e.height),c.value=e.width,d.value=e.height,I(),M(),q()},k.onerror=e=>{console.error(e)},k.src=a.value.image})),(e,t)=>(u(),i("div",E,[m("div",H,[m("div",K,p(x(a).title),1),w(x(T),{label:"添加",u:"primary",onClick:g})]),m("div",X,[m("canvas",{class:"container-canvas",ref:(e,t)=>{t.canvasRef=e,l.value=e}},null,512),m("div",{class:"container-area",ref:(e,t)=>{t.areaRef=e,o.value=e},onMousemove:B,onMouseup:L},[m("div",{class:"container-drag",ref:(e,t)=>{t.dragRef=e,n.value=e},onMousedown:j},null,544)],544)]),w(U,{max:x(a).max,color:x(a).color,size:x(b),onChange:y},null,8,["max","color","size"]),m("footer",Y,[w(x(T),{label:"更新",u:"primary",onClick:h})])]))}});const G={class:"image-wrap"};var J=r({setup(e){const t=s(""),a=s("");let l=k({mid:"",title:"测试说明",feature:"测试字段",image:"",x:20,y:40,max:125,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const o=({type:e,mid:l})=>{t.value!==l&&(t.value=l,a.value=e)};f([t,a],(()=>{var e,o;e=t.value,o=a.value,N.openImage({mid:e,type:o}).then((e=>{l=k(e)}))}));const n=e=>{console.log("story change value: ",e)};return(e,t)=>(u(),i("div",G,[w(L,{onChange:o}),x(l).image&&x(l).mid?(u(),I(W,{key:0,story:x(l),onChange:n},null,8,["story"])):M("",!0)]))}});q(r({setup:e=>(e,t)=>(u(),I(J))})).mount("#app");
