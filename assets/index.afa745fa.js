var Ze=Object.defineProperty,Qe=Object.defineProperties;var et=Object.getOwnPropertyDescriptors;var Be=Object.getOwnPropertySymbols;var tt=Object.prototype.hasOwnProperty,at=Object.prototype.propertyIsEnumerable;var Se=(e,n,s)=>n in e?Ze(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,Fe=(e,n)=>{for(var s in n||(n={}))tt.call(n,s)&&Se(e,s,n[s]);if(Be)for(var s of Be(n))at.call(n,s)&&Se(e,s,n[s]);return e},ze=(e,n)=>Qe(e,et(n));import{r as nt,c as J,o as C,d as P,t as te,a as I,F as be,b as Ae,u,e as $,f as Z,n as ae,g as ot,h as st,i as w,w as lt,j as re,k as ke,l as A,m as Le,p as M,q as ne,s as De,v as ue,x as ce,y as Re,z as Ee,A as rt,B as ut,C as ct,D as it}from"./vendor.7337bdb3.js";const dt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function t(o){if(o.ep)return;o.ep=!0;const c=s(o);fetch(o.href,c)}};dt();var Pe=(e,n)=>{const s=e.__vccOpts||e;for(const[t,o]of n)s[t]=o;return s};const vt={};function pt(e,n){const s=nt("router-view");return C(),J(s)}var gt=Pe(vt,[["render",pt]]);const mt={class:"side"},ft={class:"side-content-title"},ht=["onClick"],_t=P({props:{catalogList:null,current:null},emits:["change"],setup(e,{emit:n}){const t=te(e).catalogList,o=(c,i)=>{n("change",{type:c,child:i})};return(c,i)=>(C(),I("div",mt,[(C(!0),I(be,null,Ae(u(t),m=>(C(),I("div",{key:m.id,class:"side-content"},[$("p",ft,Z(m.text),1),(C(!0),I(be,null,Ae(m.children,x=>(C(),I("div",{key:x.mid,class:ae({"side-content-cell":!0,"side-content-cell-active":e.current===x.mid}),onClick:D=>o(m.type,x)},Z(x.title),11,ht))),128))]))),128))]))}});const G=P({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(e){return(n,s)=>(C(),I("button",{class:ae(["meme-button",{disabled:e.disabled}])},[ot(n.$slots,"default",{},()=>[st(Z(e.label),1)])],2))}});const yt=P({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:n}){const s=w(null),t=c=>{n("update:modelValue",c.target.value)};return{input:s,blur:c=>{t(c),n("blur")}}}}),xt=["title","value"];function $t(e,n,s,t,o,c){return C(),I("input",{ref:"input",class:ae(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:n[0]||(n[0]=(...i)=>e.blur&&e.blur(...i)),onKeyup:n[1]||(n[1]=lt(i=>{var m;return(m=e.input)==null?void 0:m.blur()},["enter"]))},null,42,xt)}var ie=Pe(yt,[["render",$t]]);const wt=500,Ct=300;P({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:wt},interval:{type:Number,default:Ct}},created(){this.showChange(this.show)},setup(e){const{show:n,interval:s,min:t}=te(e),o=w(n.value);let c,i=0;const m=()=>{const y=new Date().getTime()-i;y>t.value?o.value=!1:setTimeout(()=>{o.value=!1},Math.max(t.value-y,0))},x=D=>{D?s.value===0?(o.value=!0,i=new Date().getTime()):c=window.setTimeout(()=>{o.value=!0,i=new Date().getTime()},s.value):(clearTimeout(c),m())};return re(n,()=>{x(n.value)}),{localShow:o,showChange:x}}});const Ft={class:"meme-radio"},bt=["name","value","checked"],kt={class:"meme-radio-label"},oe=P({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(e,{emit:n}){const s=t=>{n("toggle",t)};return(t,o)=>(C(),I("label",Ft,[$("input",{class:"meme-radio-input",type:"radio",name:e.name,value:e.value,checked:e.checked,onChange:o[0]||(o[0]=c=>s(e.value))},null,40,bt),$("span",kt,Z(e.label),1)]))}});const Dt={class:"meme-file-upload"},Et={class:"file-button"},Mt=$("i",{class:"file-glyphicon"},null,-1),Tt=$("span",null,"UPLOAD FILE",-1),It=$("i",{class:"file-tips"},"Drop files here to upload",-1),Bt=[It],St=P({emits:["change"],setup(e,{emit:n}){const s=ke("commands"),t=g=>{const p=g.target.files;if(!p)return!1;y(p)},o=g=>{g.stopPropagation(),g.preventDefault()},c=g=>{g.stopPropagation(),g.preventDefault()},i=g=>{g.stopPropagation(),g.preventDefault();const p=g.dataTransfer.files;y(p)},m=g=>{g.stopPropagation(),g.preventDefault();const p=g.clipboardData.files;y(p)},x=1*1024*1024,D=/^image\//,y=g=>{if(g.length!==1)return F("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const p=g[0],{name:f,size:_,type:b}=p;if(!D.test(b))return F(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${b}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const S=f.replace(/\.\w*$/g,"");if(s.value.includes(S))return F(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${f}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${S}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(_>x)return F("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const E=new FileReader;E.onload=W=>{const K=W.target.result;L(f,K)},E.onerror=()=>{F(E.error.message)},E.readAsDataURL(p)},F=g=>{alert(g)},L=(g,p)=>{n("change",{name:g,base64:p})};return(g,p)=>(C(),I("div",Dt,[$("div",Et,[Mt,Tt,$("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:t},null,32)]),$("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:o,onDragover:c,onDrop:i,onPaste:m},Bt,32)]))}});const zt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},At=$("title",null,"dice",-1),Lt=["fill"],Rt=P({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:n}){const s=e,t=A(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),o=()=>{n("click")};return(c,i)=>(C(),J(u(G),{class:"dice-button",u:"icon",onClick:o},{default:Le(()=>[(C(),I("svg",zt,[At,$("path",{fill:u(t),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Lt)]))]),_:1}))}});const Pt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Nt=$("title",null,"picker",-1),Vt=["fill"],Ut=P({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:n}){const s=e,t=A(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),o=()=>{n("click")};return(c,i)=>(C(),J(u(G),{class:"picker-button",u:"icon",onClick:o},{default:Le(()=>[(C(),I("svg",Pt,[Nt,$("path",{fill:u(t),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Vt)]))]),_:1}))}});const Wt={class:"property"},Ne=P({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(e,{emit:n}){const s=e,t=ke("text"),o=ke("updateText"),{max:c,size:i,color:m,align:x,direction:D}=te(s),y=(g,p)=>{const f={max:c.value,size:i.value,color:m.value,align:x.value,direction:D.value};f[p]=["color","align","direction"].includes(p)?g:parseInt(g),n("change",f)},F=()=>{const g="#"+Math.floor(Math.random()*16777215).toString(16);y(g,"color")},L=()=>{n("pick")};return(g,p)=>(C(),I("div",Wt,[M(u(ie),{class:"property-max",value:u(c),"onUpdate:modelValue":p[0]||(p[0]=f=>y(f,"max"))},null,8,["value"]),M(u(ie),{class:"property-size",value:u(i),"onUpdate:modelValue":p[1]||(p[1]=f=>y(f,"size"))},null,8,["value"]),M(u(ie),{class:"property-color",value:u(m),"onUpdate:modelValue":p[2]||(p[2]=f=>y(f,"color"))},null,8,["value"]),M(Rt,{color:u(m),onClick:F},null,8,["color"]),M(Ut,{color:u(m),onClick:L},null,8,["color"]),M(u(oe),{label:"start",name:"align",value:"start",checked:u(x)==="start",onToggle:p[3]||(p[3]=f=>y(f,"align"))},null,8,["checked"]),M(u(oe),{label:"center",name:"align",value:"center",checked:u(x)==="center",onToggle:p[4]||(p[4]=f=>y(f,"align"))},null,8,["checked"]),M(u(oe),{class:"property-end",label:"end",name:"align",value:"end",checked:u(x)==="end",onToggle:p[5]||(p[5]=f=>y(f,"align"))},null,8,["checked"]),M(u(ie),{class:"property-text",value:u(t),"onUpdate:modelValue":u(o)},null,8,["value","onUpdate:modelValue"]),M(u(oe),{label:"up",name:"direction",value:"up",checked:u(D)==="up",onToggle:p[6]||(p[6]=f=>y(f,"direction"))},null,8,["checked"]),M(u(oe),{label:"down",name:"direction",value:"down",checked:u(D)==="down",onToggle:p[7]||(p[7]=f=>y(f,"direction"))},null,8,["checked"])]))}}),Me=1.2,z=11,V=14,Ve=V*z,Ue=V*z,Q=V*z,We=V,Xt=(()=>{const e=[];for(let n=1;n<z;n++)e.push([n,0,n,z]),e.push([0,n,z,n]);return e.map(n=>n.map(s=>s*V))})(),Yt=(e,n,s)=>{let t=0,o=e.length-1;for(;t<=o;){const c=Math.floor((t+o)/2),i=s.measureText(e.substring(0,c)).width,m=s.measureText(e.substring(0,c+1)).width;if(i<=n&&m>n)return c;i<n?t=c+1:o=c-1}return-1},jt=(e,n,s)=>{const t=[];let o=0;for(;(o=Yt(e,n,s))!==-1;)t.push(e.substring(0,o)),e=e.substring(o);return e&&t.push(e),t},Te=(e,n,s,t)=>{const{x:o,y:c,font:i,color:m,align:x,max:D,direction:y}=t;e.font=i||"32px sans-serif",e.fillStyle=m||"#000000",e.textAlign=x||"center";const F=D||n,L=i.match(/(\d{1,3})px/)||["","32"],g=Number(L[1]),p=jt(s,F,e);p.forEach((f,_)=>{const b=y==="down"?_:_-(p.length-1);e.fillText(f,o,c+b*g*Me,F)})},Ot=e=>{e.imageSmoothingEnabled=!1,e.lineCap="round",e.beginPath(),e.strokeStyle="#000000",e.arc(z*V/2,z*V/2,z*V/2-1,0,Math.PI*2),e.stroke(),e.clip(),e.strokeStyle="#D6D6D6",Xt.forEach(n=>{const{0:s,1:t,2:o,3:c}=n;e.moveTo(s,t),e.lineTo(o,c)}),e.stroke(),e.beginPath(),e.strokeStyle="#FF0000",e.rect((z-1)*V/2,(z-1)*V/2,1*V,1*V),e.stroke()},Xe=(e,n,s,t)=>{n.style.left=`${s+We}px`,n.style.top=`${t+We}px`;const o=n.getContext("2d"),c=Math.min(Math.max(0,s-5),e.width-z),i=Math.min(Math.max(0,t-5),e.height-z);o.clearRect(0,0,Ve,Ue),o.drawImage(e,c,i,z,z,0,0,Ve,Ue),Ot(o)},Ye=(e,n,s)=>{const o=`image/${["jpeg","jpg"].includes(n)?"jpeg":"png"}`,c=e.toDataURL(o),i=document.createElement("a");i.setAttribute("download",s),i.setAttribute("href",c),i.setAttribute("target","_blank"),i.click()};const Ht={class:"container"},Gt={class:"container-header"},Kt={class:"container-title"},qt={key:0,class:"container-wall"},Jt={class:"container-wraper"},Zt=["width","height"],Qt={class:"container-footer"},ea=P({props:{story:null},emits:["change","create","replace"],setup(e,{emit:n}){const t=te(e).story,o=w(null),c=w(null),i=w(null),m=w(!0),x=w(!0);let D=null;const y=w(!1),F=w(!1),L=w(null),g=w("\u91D1\u9986\u957F"),p=a=>{g.value=a,j()};ne("text",g),ne("updateText",p);const f=w(0),_=w(0),b=(a,l)=>{t.value.x=a,t.value.y=l},S=a=>{const{max:l,size:d,color:h,align:k,direction:T}=a;t.value.max=l,t.value.font=`${d}px sans-serif`,t.value.color=h,t.value.align=k,t.value.direction=T},E=A(()=>{const a=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(a[1])}),W=A(()=>{var h;return((h=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:h[0])||"png"}),K=A(()=>`${t.value.title}.${W.value} ${f.value} * ${_.value} (${t.value.x}, ${t.value.y})`),se=A(()=>{const a=t.value.max||f.value;return{start:0,center:Math.floor(a/2),end:a}[t.value.align]}),R=new Image,q=()=>{R.onload=async()=>{const a=o.value;a.width=R.naturalWidth,a.height=R.naturalHeight,f.value=a.width,_.value=a.height,de(),j(),ee()},R.onerror=a=>{console.error(a)},R.src=t.value.image},de=()=>{const a=c.value;a.style.width=`${f.value}px`,a.style.height=`${_.value}px`},j=()=>{const a=o.value,l=a.getContext("2d");l.drawImage(R,0,0),Te(l,a.width,g.value,t.value)},ee=()=>{const{x:a,y:l,max:d}=t.value,h=i.value;h.style.width=`${d}px`,h.style.height=`${E.value*Me}px`,h.style.top=`${l-E.value+2}px`,h.style.left=`${a-se.value}px`};re(t,(a,l)=>{a.mid!==l.mid?q():(j(),ee())},{deep:!0});let O=0,H=0;const B=20;let U=!1;const ve=a=>{U=!0;const{clientX:l,clientY:d}=a;O=l,H=d},pe=a=>{if(!U)return;const{clientX:l,clientY:d}=a,h=i.value,{width:k,height:T}=h.getBoundingClientRect();let N=h.offsetLeft+l-O,Y=h.offsetTop+d-H;N<-B||Y<-B||N>f.value-k+B||Y>_.value-T+B?U=!1:(O=l,H=d),N=Math.max(Math.min(N,f.value-k+B),-B),Y=Math.max(Math.min(Y,_.value-T+B),-B),N+=se.value,Y+=E.value-2,b(N,Y)},ge=()=>{!U||(U=!1)},me=()=>{m.value?m.value=!1:(m.value=!0,x.value=!0,D?(le(D),D=null):q())},fe=()=>{const a=o.value,l=`imeme_${t.value.title}_${g.value}`;Ye(a,W.value,l)},he=()=>{m.value?n("change",t.value):x.value||(n("create",t.value),m.value=!0,x.value=!0)},_e=({name:a,base64:l})=>{x.value=!1;const{mid:d,title:h,feature:k,image:T,x:N,y:Y,max:Oe,font:He,color:Ge,align:Ke,direction:qe,senior:Je}=t.value;D={mid:d,title:h,feature:k,image:T,x:N,y:Y,max:Oe,font:He,color:Ge,align:Ke,direction:qe,senior:Je};const Ie=a.slice(0,a.lastIndexOf("."));le({mid:`meme_${new Date().getTime()}`,title:Ie,feature:Ie,image:l,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",senior:0})},le=a=>{n("replace",a)},ye=()=>{y.value=!0},xe=(a,l)=>{const d=o.value,h=L.value;Xe(d,h,a,l)},$e=async a=>{if(!y.value)return!1;const{offsetX:l,offsetY:d}=a;l<0||d<0||(F.value=!0,xe(l,d))},we=()=>{if(!y.value)return!1;F.value=!1},Ce=a=>{const l=N=>N.toString(16).padStart(2,"0"),{0:d,1:h,2:k,3:T}=a.data;return`#${l(d)}${l(h)}${l(k)}${l(T)}`.toUpperCase()},r=(a,l)=>{const k=o.value.getContext("2d").getImageData(a,l,1,1);return Ce(k)},v=a=>{if(!y.value)return!1;const{offsetX:l,offsetY:d}=a;if(l<0||d<0)return;const h=r(l,d);t.value.color=h,F.value=!1,y.value=!1};return De(()=>{q()}),(a,l)=>(C(),I("div",Ht,[$("div",Gt,[$("div",Kt,Z(u(K)),1),M(u(G),{label:m.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:me},null,8,["label"]),M(u(G),{label:"\u4E0B\u8F7D",u:"primary",onClick:fe})]),!m.value&&x.value?(C(),I("div",qt,[M(u(St),{onChange:_e})])):(C(),I(be,{key:1},[$("div",Jt,[$("canvas",{ref:(d,h)=>{h.canvasRef=d,o.value=d},class:ae({"container-canvas":!0,"container-pointer":y.value}),onMousemove:$e,onMouseleave:we,onClick:v},null,34),ue($("div",{class:"container-area",ref:(d,h)=>{h.areaRef=d,c.value=d},onMousemove:pe,onMouseup:ge},[$("div",{class:"container-drag",ref:(d,h)=>{h.dragRef=d,i.value=d},onMousedown:ve},null,544)],544),[[ce,!y.value]]),ue($("canvas",{ref:(d,h)=>{h.layerRef=d,L.value=d},class:"container-layer",style:Re({borderRadius:`${u(Q)}px`}),width:u(Q),height:u(Q)},null,12,Zt),[[ce,y.value&&F.value]])]),M(Ne,{max:u(t).max,color:u(t).color,size:u(E),align:u(t).align,direction:u(t).direction,onChange:S,onPick:ye},null,8,["max","color","size","align","direction"])],64)),$("footer",Qt,[M(u(G),{label:m.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:he},null,8,["label"])])]))}});const ta={class:"container"},aa={class:"container-header"},na={class:"container-title"},oa={class:"container-wraper"},sa=["width","height"],la={class:"container-footer"},ra=P({props:{feature:null},emits:["change"],setup(e,{emit:n}){const t=te(e).feature,o=w(null),c=w(null),i=w(null),m=w(!1),x=w(!1),D=w(null),y="\u91D1\u9986\u957F",F=w("\u91D1\u9986\u957F"),L=r=>{F.value=r,j()};ne("text",F),ne("updateText",L);const g=w(0),p=w(0),f=A(()=>t.value.type==="TEXT"),_=A(()=>{var r;if(f.value){const v=((r=t.value.et)==null?void 0:r.font.match(/(\d{1,3})px/))||["","32"];return Number(v[1])}return 0}),b=A(()=>{var l;return((l=t.value.story.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:l[0])||"png"}),S=A(()=>{const r=f.value?E.value:W.value;return`${t.value.story.title}.${b.value} ${g.value} * ${p.value} (${r.x}, ${r.y})`}),E=A(()=>t.value.et),W=A(()=>t.value.ei),K=A(()=>{if(f.value){const r=E.value.max||g.value;return{start:0,center:Math.floor(r/2),end:r}[E.value.align]}return 0}),se=r=>{const{max:v,size:a,color:l,align:d,direction:h}=r;t.value.et.max=v,t.value.et.font=`${a}px sans-serif`,t.value.et.color=l,t.value.et.align=d,t.value.et.direction=h},R=new Image,q=()=>{R.onload=async()=>{const r=o.value;r.width=R.naturalWidth,r.height=R.naturalHeight,g.value=r.width,p.value=r.height,de(),j(),ee()},R.onerror=r=>{console.error(r)},R.src=t.value.story.image},de=()=>{const r=c.value;r.style.width=`${g.value}px`,r.style.height=`${p.value}px`},j=()=>{const r=o.value,v=r.getContext("2d");v.drawImage(R,0,0),v.save(),Te(v,r.width,y,t.value.story),f.value&&(v.restore(),Te(v,r.width,F.value,E.value))},ee=()=>{let r=0,v=0,a=0,l=0;if(f.value){const{x:h,y:k,max:T}=E.value;r=T,v=_.value*Me,a=k-_.value+2,l=h-K.value}else{const{x:h,y:k,width:T,height:N}=W.value;r=T,v=N,a=k,l=h}const d=i.value;d.style.width=`${r}px`,d.style.height=`${v}px`,d.style.top=`${a}px`,d.style.left=`${l}px`};re(t,(r,v)=>{r.mid!==v.mid?q():(j(),ee())},{deep:!0});let O=0,H=0;const B=20;let U=!1;const ve=r=>{U=!0;const{clientX:v,clientY:a}=r;O=v,H=a},pe=r=>{if(!U)return;const{clientX:v,clientY:a}=r,l=i.value,{width:d,height:h}=l.getBoundingClientRect();let k=l.offsetLeft+v-O,T=l.offsetTop+a-H;k<-B||T<-B||k>g.value-d+B||T>p.value-h+B?U=!1:(O=v,H=a),k=Math.max(Math.min(k,g.value-d+B),-B),T=Math.max(Math.min(T,p.value-h+B),-B),ge(k,T)},ge=(r,v)=>{f.value?(E.value.x=r+K.value,E.value.y=v+_.value-2):(W.value.x=r,W.value.y=v)},me=()=>{!U||(U=!1)},fe=()=>{const r=o.value,v=`imeme_${t.value.story.title}_${F.value}`;Ye(r,b.value,v)},he=()=>{const{mid:r,type:v,et:a,ei:l}=t.value;n("change",{mid:r,type:v,options:f.value?a:l})},_e=()=>{m.value=!0},le=(r,v)=>{const a=o.value,l=D.value;Xe(a,l,r,v)},ye=async r=>{if(!m.value)return!1;const{offsetX:v,offsetY:a}=r;v<0||a<0||(x.value=!0,le(v,a))},xe=()=>{if(!m.value)return!1;x.value=!1},$e=r=>{const v=k=>k.toString(16).padStart(2,"0"),{0:a,1:l,2:d,3:h}=r.data;return`#${v(a)}${v(l)}${v(d)}${v(h)}`.toUpperCase()},we=(r,v)=>{const d=o.value.getContext("2d").getImageData(r,v,1,1);return $e(d)},Ce=r=>{if(!m.value)return!1;const{offsetX:v,offsetY:a}=r;if(v<0||a<0)return;const l=we(v,a);t.value.et.color=l,x.value=!1,m.value=!1};return De(()=>{q()}),(r,v)=>(C(),I("div",ta,[$("div",aa,[$("div",na,Z(u(S)),1),M(u(G),{label:"\u4E0B\u8F7D",u:"primary",onClick:fe})]),$("div",oa,[$("canvas",{ref:(a,l)=>{l.canvasRef=a,o.value=a},class:ae({"container-canvas":!0,"container-pointer":m.value}),onMousemove:ye,onMouseleave:xe,onClick:Ce},null,34),ue($("div",{class:"container-area",ref:(a,l)=>{l.areaRef=a,c.value=a},onMousemove:pe,onMouseup:me},[$("div",{class:"container-drag",ref:(a,l)=>{l.dragRef=a,i.value=a},onMousedown:ve},null,544)],544),[[ce,!m.value]]),ue($("canvas",{ref:(a,l)=>{l.layerRef=a,D.value=a},class:"container-layer",style:Re({borderRadius:`${u(Q)}px`}),width:u(Q),height:u(Q)},null,12,sa),[[ce,m.value&&x.value]])]),u(f)?(C(),J(Ne,{key:0,max:u(E).max,color:u(E).color,size:u(_),align:u(E).align,direction:u(E).direction,onChange:se,onPick:_e},null,8,["max","color","size","align","direction"])):Ee("",!0),$("footer",la,[M(u(G),{label:"\u66F4\u65B0",u:"primary",onClick:he})])]))}}),je={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"},saveFeatureImage:{url:"/image/feature/save",method:"post"}},ua=()=>"https://imeme.vercel.app";var ca=e=>async(n={},s={})=>{const{url:t,method:o}=e,c=ua();return rt.request({withCredentials:!1,url:c+t,method:o,[o==="get"?"params":"data"]:n}).then(i=>{const m=i.data;return(s==null?void 0:s.stream)?i:m.errNo===0?m.data:Promise.reject(m)}).catch(i=>Promise.reject(i))};const X={};for(const e in je)X[e]=ca(je[e]);const ia={class:"image-wrap"},da=P({setup(e){const n=w([]),s=w(""),t=w("");let o=w({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",senior:0}),c=w({mid:"",feature:"",type:"",story:o});const i=async()=>{const _=await X.getCatalog({});n.value=_},m=({type:_,child:b})=>{s.value!==b.mid&&(s.value=b.mid,t.value=_)};re([s,t],()=>{x(s.value,t.value)});const x=(_,b)=>{p.value?X.openImage({mid:_,type:b}).then(S=>{o.value=S}):X.getFeatureImage({mid:_}).then(S=>{c.value=S})},D=_=>{const b=ze(Fe({},_),{image:""});X.saveImage(b)},y=_=>{o.value=_},F=async _=>{const b=await X.createImage(_).catch(S=>{alert(S.message)});await i(),s.value=b.mid},L=w([]);ne("commands",L);const g=async()=>{const _=await X.getCommands({});L.value=_},p=A(()=>["STORY","SERIES","SPECIAL"].includes(t.value)),f=({mid:_,type:b,options:S})=>{b==="TEXT"?X.saveImage(S):X.saveFeatureImage(Fe({mid:_,type:b},S))};return De(()=>{i(),g()}),(_,b)=>(C(),I("div",ia,[M(_t,{current:s.value,"catalog-list":n.value,onChange:m},null,8,["current","catalog-list"]),u(p)&&u(o).image&&u(o).mid?(C(),J(ea,{key:0,story:u(o),onChange:D,onReplace:y,onCreate:F},null,8,["story"])):Ee("",!0),t.value==="FEATURE"&&u(c).mid?(C(),J(ra,{key:1,feature:u(c),onChange:f},null,8,["feature"])):Ee("",!0)]))}});const va={class:"material-center"},pa=P({setup(e){return(n,s)=>(C(),I("div",va," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),ga=[{path:"/",component:da},{path:"/center",component:pa}],ma=ut({history:ct(),routes:ga});it(gt).use(ma).mount("#app");
