var ve=Object.defineProperty,fe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var J=(a,e,l)=>e in a?ve(a,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[e]=l,P=(a,e)=>{for(var l in e||(e={}))he.call(e,l)&&J(a,l,e[l]);if(H)for(var l of H(e))ye.call(e,l)&&J(a,l,e[l]);return a},Z=(a,e)=>fe(a,_e(e));import{a as Fe,d as D,r as F,o as h,c as x,F as q,b as Q,e as y,t as V,n as G,f as z,w as xe,g as K,i as ee,h as W,j as C,u as d,p as te,k as be,l as ae,m as $e,q as Ce}from"./vendor.47fcb162.js";const De=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function l(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(n){if(n.ep)return;n.ep=!0;const s=l(n);fetch(n.href,s)}};De();const ne={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},we=()=>"https://imeme.vercel.app";var Be=a=>async(e={},l={})=>{const{url:t,method:n}=a,s=we();return Fe.request({withCredentials:!1,url:s+t,method:n,[n==="get"?"params":"data"]:e}).then(i=>{const o=i.data;return(l==null?void 0:l.stream)?i:o.errNo===0?o.data:Promise.reject(o)}).catch(i=>Promise.reject(i))};const N={};for(const a in ne)N[a]=Be(ne[a]);const Ee={class:"side"},ke={class:"side-content-title"},Ae=["onClick"],Ie=D({emits:["change"],setup(a,{emit:e}){const l=F([]),t=F(""),n=()=>{N.getCatalog({}).then(i=>{l.value=i})},s=(i,o)=>{t.value=o.mid,e("change",P({type:i},o))};return n(),(i,o)=>(h(),x("div",Ee,[(h(!0),x(q,null,Q(l.value,p=>(h(),x("div",{key:p.id,class:"side-content"},[y("p",ke,V(p.text),1),(h(!0),x(q,null,Q(p.children,m=>(h(),x("div",{key:m.mid,class:G({"side-content-cell":!0,"side-content-cell-active":t.value===m.mid}),onClick:b=>s(p.type,m)},V(m.title),11,Ae))),128))]))),128))]))}});var le=(a,e)=>{for(const[l,t]of e)a[l]=t;return a};const Le=D({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){const{label:e}=z(a);return{localLabel:e}}});function Te(a,e,l,t,n,s){return h(),x("button",{class:G(["meme-button",{disabled:a.disabled}])},V(a.localLabel),3)}var X=le(Le,[["render",Te]]);const Me=D({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:e}){const l=F(null),t=s=>{e("update:modelValue",s.target.value)};return{input:l,blur:s=>{t(s),e("blur")}}}}),Ve=["title","value"];function Pe(a,e,l,t,n,s){return h(),x("input",{ref:"input",class:G(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:e[0]||(e[0]=(...i)=>a.blur&&a.blur(...i)),onKeyup:e[1]||(e[1]=xe(i=>{var o;return(o=a.input)==null?void 0:o.blur()},["enter"]))},null,42,Ve)}var R=le(Me,[["render",Pe]]);const ze=500,Ne=300;D({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:ze},interval:{type:Number,default:Ne}},created(){this.showChange(this.show)},setup(a){const{show:e,interval:l,min:t}=z(a),n=F(e.value);let s,i=0;const o=()=>{const b=new Date().getTime()-i;b>t.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(t.value-b,0))},p=m=>{m?l.value===0?(n.value=!0,i=new Date().getTime()):s=window.setTimeout(()=>{n.value=!0,i=new Date().getTime()},l.value):(clearTimeout(s),o())};return K(e,()=>{p(e.value)}),{localShow:n,showChange:p}}});const Re={class:"meme-radio"},Se=["name","value","checked"],je={class:"meme-radio-label"},se=D({props:{label:null,name:null,value:null,checked:null},emits:["toggle"],setup(a,{emit:e}){const l=t=>{e("toggle",t)};return(t,n)=>(h(),x("label",Re,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:n[0]||(n[0]=s=>l(a.value))},null,40,Se),y("span",je,V(a.label),1)]))}});const Ue={class:"meme-file-upload"},Oe={class:"file-button"},qe=y("i",{class:"file-glyphicon"},null,-1),Ge=y("span",null,"UPLOAD FILE",-1),Ke=y("i",{class:"file-tips"},"Drop files here to upload",-1),We=[Ke],Xe=D({setup(a){const e=r=>{const c=r.target.files;if(!c)return!1;p(c)},l=r=>{r.stopPropagation(),r.preventDefault()},t=r=>{r.stopPropagation(),r.preventDefault()},n=r=>{r.stopPropagation(),r.preventDefault();const c=r.dataTransfer.files;p(c)},s=r=>{r.stopPropagation(),r.preventDefault();const c=r.clipboardData.files;p(c)},i=2*1024*1024,o=/^image\//,p=r=>{if(r.length!==1)return m("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const c=r[0],{name:_,size:S,type:I}=c;if(!o.test(I))return m(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${I}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;if(S>i)return m("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52362M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const L=new FileReader;L.onload=B=>{const T=B.target.result;b(_,T)},L.onerror=()=>{m(L.error.message)},L.readAsDataURL(c)},m=r=>{alert(r)},b=(r,c)=>{console.log(r,c)};return(r,c)=>(h(),x("div",Ue,[y("div",Oe,[qe,Ge,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",onChange:e},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:l,onDragover:t,onDrop:n,onPaste:s},We,32)]))}});const Ye={class:"property"},He=D({props:{max:null,size:null,color:null,align:null},emits:["change"],setup(a,{emit:e}){const l=a,t=ee("text"),n=ee("updateText"),{max:s,size:i,color:o,align:p}=z(l),m=W(()=>p.value==="start"),b=(r,c)=>{const _={max:s.value,size:i.value,color:o.value,align:p.value};_[c]=["color","align"].includes(c)?r:parseInt(r),e("change",_)};return(r,c)=>(h(),x("div",Ye,[C(d(R),{class:"property-max",value:d(s),"onUpdate:modelValue":c[0]||(c[0]=_=>b(_,"max"))},null,8,["value"]),C(d(R),{class:"property-size",value:d(i),"onUpdate:modelValue":c[1]||(c[1]=_=>b(_,"size"))},null,8,["value"]),C(d(R),{class:"property-color",value:d(o),"onUpdate:modelValue":c[2]||(c[2]=_=>b(_,"color"))},null,8,["value"]),C(d(se),{label:"start",name:"align",value:"start",checked:d(m),onToggle:c[3]||(c[3]=_=>b(_,"align"))},null,8,["checked"]),C(d(se),{label:"end",name:"align",value:"end",checked:!d(m),onToggle:c[4]||(c[4]=_=>b(_,"align"))},null,8,["checked"]),C(d(R),{class:"property-text",value:d(t),"onUpdate:modelValue":d(n)},null,8,["value","onUpdate:modelValue"])]))}});const Je={class:"container"},Ze={class:"container-header"},Qe={class:"container-title"},et={key:0,class:"container-wall"},tt={class:"container-wraper"},at={class:"container-footer"},nt=D({props:{story:null},emits:["change"],setup(a,{emit:e}){const t=z(a).story,n=F(null),s=F(null),i=F(null),o=F(!0),p=F(!0),m=F("\u91D1\u9986\u957F"),b=u=>{m.value=u,j()};te("text",m),te("updateText",b);const r=F(0),c=F(0),_=(u,v)=>{t.value.x=u,t.value.y=v},S=u=>{const{max:v,size:g,color:f,align:$}=u;t.value.max=v,t.value.font=`${g}px sans-serif`,t.value.color=f,t.value.align=$},I=W(()=>{const u=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(u[1])*1}),L=W(()=>{var f;return((f=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:f[0])||"png"}),B=new Image,T=()=>{B.onload=async()=>{const u=n.value;u.width=B.naturalWidth,u.height=B.naturalHeight,r.value=u.width,c.value=u.height,oe(),j(),Y()},B.onerror=u=>{console.error(u)},B.src=t.value.image},oe=()=>{const u=s.value;u.style.width=`${r.value}px`,u.style.height=`${c.value}px`},j=()=>{const u=n.value,v=u.getContext("2d");v.drawImage(B,0,0);const{x:g,y:f,font:$,color:w,align:k,max:A}=t.value;v.font=$,v.fillStyle=w,v.textAlign=k,v.fillText(m.value,g,f,A||u.width)},Y=()=>{const{x:u,y:v,max:g,align:f}=t.value,$=i.value;$.style.width=`${g}px`,$.style.height=`${I.value}px`,$.style.top=`${v-I.value+2}px`,$.style.left=f==="start"?`${u}px`:`${u-g}px`};K(t,(u,v)=>{u.mid!==v.mid?T():(j(),Y())},{deep:!0});let U=0,O=0;const E=20;let M=!1;const ue=u=>{M=!0;const{clientX:v,clientY:g}=u;U=v,O=g},re=u=>{if(!M)return;const{clientX:v,clientY:g}=u,f=i.value,{width:$,height:w}=f.getBoundingClientRect();let k=f.offsetLeft+v-U,A=f.offsetTop+g-O;k<-E||A<-E||k>r.value-$+E||A>c.value-w+E?M=!1:(U=v,O=g),k=Math.max(Math.min(k,r.value-$+E),-E),A=Math.max(Math.min(A,c.value-w+E),-E);const{align:ge,max:me}=t.value;k+=ge==="end"?me:0,A+=I.value-2,_(k,A)},ie=()=>{!M||(M=!1)},ce=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0\uFF1F\uFF1F\u4F60\u8FD9\u4E48\u62FD\uFF1F\uFF1F"),o.value?o.value=!1:(o.value=!0,T())},de=()=>{const u=n.value;let g=`image/${["jpeg","jpg"].includes(L.value)?"jpeg":"png"}`;const f=u.toDataURL(g),$=`imeme_${t.value.title}_${m.value}`,w=document.createElement("a");w.setAttribute("download",$),w.setAttribute("href",f),w.setAttribute("target","_blank"),w.click()},pe=()=>{o.value?e("change",t.value):console.log("\u4FDD\u5B58\u6DFB\u52A0\u5185\u5BB9\u3002")};return be(()=>{T()}),(u,v)=>(h(),x("div",Je,[y("div",Ze,[y("div",Qe,V(`${d(t).title}.${d(L)}`),1),C(d(X),{label:o.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:ce},null,8,["label"]),C(d(X),{label:"\u4E0B\u8F7D",u:"primary",onClick:de})]),!o.value&&p.value?(h(),x("div",et,[C(d(Xe))])):(h(),x(q,{key:1},[y("div",tt,[y("canvas",{class:"container-canvas",ref:(g,f)=>{f.canvasRef=g,n.value=g}},null,512),y("div",{class:"container-area",ref:(g,f)=>{f.areaRef=g,s.value=g},onMousemove:re,onMouseup:ie},[y("div",{class:"container-drag",ref:(g,f)=>{f.dragRef=g,i.value=g},onMousedown:ue},null,544)],544)]),C(He,{max:d(t).max,color:d(t).color,size:d(I),align:d(t).align,onChange:S},null,8,["max","color","size","align"])],64)),y("footer",at,[C(d(X),{label:o.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:pe},null,8,["label"])])]))}});const lt={class:"image-wrap"},st=D({setup(a){const e=F(""),l=F("");let t=F({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:o,mid:p})=>{e.value!==p&&(e.value=p,l.value=o)};K([e,l],()=>{s(e.value,l.value)});const s=(o,p)=>{N.openImage({mid:o,type:p}).then(m=>{t.value=m})},i=o=>{console.log("story change value: ",P({},o));const p=Z(P({},o),{image:""});N.saveImage(p)};return(o,p)=>(h(),x("div",lt,[C(Ie,{onChange:n}),d(t).image&&d(t).mid?(h(),ae(nt,{key:0,story:d(t),onChange:i},null,8,["story"])):$e("",!0)]))}});const ot=D({setup(a){return(e,l)=>(h(),ae(st))}});Ce(ot).mount("#app");
