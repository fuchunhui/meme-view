var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,s=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&r(e,t,a[t]);return e};"undefined"!=typeof require&&require;import{a as i,d as u,r as c,o as d,c as m,F as p,b as v,e as g,t as h,f as y,n as f,w as b,g as x,h as w,v as k,i as C,j as q,k as S,u as T,p as I,l as j,m as z,q as M,s as N}from"./vendor.38b45301.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&a(e)})).observe(document,{childList:!0,subtree:!0})}function a(e){if(e.ep)return;e.ep=!0;const a=function(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerpolicy&&(a.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?a.credentials="include":"anonymous"===e.crossorigin?a.credentials="omit":a.credentials="same-origin",a}(e);fetch(e.href,a)}}();const O={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}};var V=e=>async(a={},t={})=>{const{url:l,method:n}=e;return i.request({withCredentials:!1,url:"http://localhost:8080"+l,method:n,["get"===n?"params":"data"]:a}).then((e=>{const a=e.data;return(null==t?void 0:t.stream)?e:0===a.errNo?a.data:Promise.reject(a)})).catch((e=>Promise.reject(e)))};const B={};for(const oe in O)B[oe]=V(O[oe]);const L={class:"side"},P={class:"side-content-title"},A=["onClick"];var F=u({emits:["change"],setup(e,{emit:a}){const t=c([]);return B.getCatalog({}).then((e=>{t.value=e})),(e,l)=>(d(),m("div",L,[(d(!0),m(p,null,v(t.value,(e=>(d(),m("div",{key:e.id,class:"side-content"},[g("p",P,h(e.text),1),(d(!0),m(p,null,v(e.children,(t=>(d(),m("div",{key:t.mid,class:"side-content-cell",onClick:l=>((e,t)=>{a("change",s({type:e},t))})(e.type,t)},h(t.title),9,A)))),128))])))),128))]))}}),$=u({name:"Button",props:{label:{type:String,default:"提交"},disabled:{type:Boolean,default:!1}},setup(e){const{label:a}=y(e);return{localLabel:a}}});$.render=function(e,a,t,l,n,o){return d(),m("button",{class:f(["meme-button",{disabled:e.disabled}])},h(e.localLabel),3)};var U=u({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:a}){const t=c(null);return{input:t,blur:e=>{(e=>{a("update:modelValue",e.target.value)})(e),a("blur")}}}});const D=["title","value"];U.render=function(e,a,t,l,n,o){return d(),m("input",{ref:"input",class:f(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:a[0]||(a[0]=(...a)=>e.blur&&e.blur(...a)),onKeyup:a[1]||(a[1]=b((a=>{var t;return null==(t=e.input)?void 0:t.blur()}),["enter"]))},null,42,D)};var R=u({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:500},interval:{type:Number,default:300}},created(){this.showChange(this.show)},setup(e){const{show:a,interval:t,min:l}=y(e),n=c(a.value);let o,r=0;const s=e=>{e?0===t.value?(n.value=!0,r=(new Date).getTime()):o=window.setTimeout((()=>{n.value=!0,r=(new Date).getTime()}),t.value):(clearTimeout(o),(()=>{const e=(new Date).getTime()-r;e>l.value?n.value=!1:setTimeout((()=>{n.value=!1}),Math.max(l.value-e,0))})())};return x(a,(()=>{s(a.value)})),{localShow:n,showChange:s}}});const E={class:"meme-loading"},H=[g("div",{class:"meme-loading-wrap"},[g("svg",{xmlns:"http://www.w3.org/2000/svg",width:"41",height:"41",viewBox:"0 0 32 32",class:"meme-loading-spinner"},[g("path",{d:"M32 16a15.832 15.832 0 0 0-4.864-11.137 15.717 15.717 0 0 0-5.156-3.302A15.512 15.512 0 0 0 15.999.5 15.335 15.335 0 0 0 5.216 5.216a15.23 15.23 0 0 0-3.193 4.994A15.027 15.027 0 0 0 1 16a14.92 14.92 0 0 0 1.254 5.694A14.84 14.84 0 0 0 5.57 26.43a14.708 14.708 0 0 0 4.832 3.085A14.534 14.534 0 0 0 16 30.5c1.897-.04 3.78-.455 5.502-1.216a14.346 14.346 0 0 0 4.574-3.208 14.213 14.213 0 0 0 2.977-4.67c.407-1.046.684-2.137.829-3.244a2 2 0 0 0 2.111-2.163H32zm-3.178 5.311c-.733 1.663-1.796 3.169-3.099 4.412s-2.844 2.225-4.508 2.868A13.536 13.536 0 0 1 16 29.5a13.328 13.328 0 0 1-9.369-4.131 13.246 13.246 0 0 1-2.76-4.346 13.048 13.048 0 0 1 .231-9.952c.683-1.541 1.672-2.937 2.883-4.088s2.642-2.058 4.184-2.652a12.539 12.539 0 0 1 9.568.231c1.48.658 2.82 1.609 3.926 2.774s1.975 2.54 2.543 4.021c.57 1.481.837 3.064.794 4.641h.007a2 2 0 0 0 1.777 2.155 13.829 13.829 0 0 1-.962 3.156z"})])],-1)];R.render=function(e,a,t,l,n,o){return w((d(),m("div",E,H,512)),[[k,e.localShow]])};const K={class:"meme-radio"},X=["name","value","checked"],Y={class:"meme-radio-label"};var W=u({props:{label:{type:String,required:!0},name:{type:String,required:!0},value:{type:String,required:!0},checked:{type:Boolean,required:!0}},emits:["toggle"],setup:(e,{emit:a})=>(t,l)=>(d(),m("label",K,[g("input",{class:"meme-radio-input",type:"radio",name:e.name,value:e.value,checked:e.checked,onChange:l[0]||(l[0]=t=>{return l=e.value,void a("toggle",l);var l})},null,40,X),g("span",Y,h(e.label),1)]))});const G={class:"property"};var J=u({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0},align:{type:String,required:!0}},emits:["change"],setup(e,{emit:a}){const t=e,l=C("text"),n=C("updateText"),{max:o,size:r,color:s,align:i}=y(t),u=q((()=>"start"===i.value)),c=(e,t)=>{const l={max:o.value,size:r.value,color:s.value,align:i.value};l[t]=["color","align"].includes(t)?e:parseInt(e),a("change",l)};return(e,a)=>(d(),m("div",G,[S(T(U),{class:"property-max",value:T(o),"onUpdate:modelValue":a[0]||(a[0]=e=>c(e,"max"))},null,8,["value"]),S(T(U),{class:"property-size",value:T(r),"onUpdate:modelValue":a[1]||(a[1]=e=>c(e,"size"))},null,8,["value"]),S(T(U),{class:"property-color",value:T(s),"onUpdate:modelValue":a[2]||(a[2]=e=>c(e,"color"))},null,8,["value"]),S(T(W),{label:"start",name:"align",value:"start",checked:T(u),onToggle:a[3]||(a[3]=e=>c(e,"align"))},null,8,["checked"]),S(T(W),{label:"end",name:"align",value:"end",checked:!T(u),onToggle:a[4]||(a[4]=e=>c(e,"align"))},null,8,["checked"]),S(T(U),{class:"property-text",value:T(l),"onUpdate:modelValue":T(n)},null,8,["value","onUpdate:modelValue"])]))}});const Q={class:"container"},Z={class:"container-header"},_={class:"container-title"},ee={class:"container-wraper"},ae={class:"container-footer"};var te=u({props:{story:{type:null,required:!0}},emits:["change"],setup(e,{emit:a}){const t=y(e).story,l=c(null),n=c(null),o=c(null),r=c("金馆长");I("text",r),I("updateText",(e=>{r.value=e,C()}));const s=c(0),i=c(0),u=()=>{console.log("你说更新就更新")},p=()=>{a("change",t.value)},v=e=>{const{max:a,size:l,color:n,align:o}=e;t.value.max=a,t.value.font=`${l}px sans-serif`,t.value.color=n,t.value.align=o},f=q((()=>{const e=t.value.font.match(/(\d{1,3})px/)||["","32"];return 1*Number(e[1])})),b=new Image,w=()=>{b.onload=async()=>{const e=l.value;e.width=b.naturalWidth,e.height=b.naturalHeight,s.value=e.width,i.value=e.height,k(),C(),z()},b.onerror=e=>{console.error(e)},b.src=t.value.image},k=()=>{const e=n.value;e.style.width=`${s.value}px`,e.style.height=`${i.value}px`},C=()=>{const e=l.value,a=e.getContext("2d");a.drawImage(b,0,0);const{x:n,y:o,font:s,color:i,align:u,max:c}=t.value;a.font=s,a.fillStyle=i,a.textAlign=u,a.fillText(r.value,n,o,c||e.width)},z=()=>{const{x:e,y:a,max:l,align:n}=t.value,r=o.value;r.style.width=`${l}px`,r.style.height=`${f.value}px`,r.style.top=a-f.value+2+"px",r.style.left="start"===n?`${e}px`:e-l+"px"};x(t,((e,a)=>{e.mid!==a.mid?w():(C(),z())}),{deep:!0});let M=0,N=0;const O=20;let V=!1;const B=e=>{V=!0;const{clientX:a,clientY:t}=e;M=a,N=t},L=e=>{if(!V)return;const{clientX:a,clientY:l}=e,n=o.value,{width:r,height:u}=n.getBoundingClientRect();let c=n.offsetLeft+a-M,d=n.offsetTop+l-N;c<-20||d<-20||c>s.value-r+O||d>i.value-u+O?V=!1:(M=a,N=l),c=Math.max(Math.min(c,s.value-r+O),-20),d=Math.max(Math.min(d,i.value-u+O),-20);const{align:m,max:p}=t.value;c+="end"===m?p:0,d+=f.value-2,((e,a)=>{t.value.x=e,t.value.y=a})(c,d)},P=()=>{V&&(V=!1)};return j((()=>{w()})),(e,a)=>(d(),m("div",Q,[g("div",Z,[g("div",_,h(T(t).title),1),S(T($),{label:"添加",u:"primary",onClick:u})]),g("div",ee,[g("canvas",{class:"container-canvas",ref:(e,a)=>{a.canvasRef=e,l.value=e}},null,512),g("div",{class:"container-area",ref:(e,a)=>{a.areaRef=e,n.value=e},onMousemove:L,onMouseup:P},[g("div",{class:"container-drag",ref:(e,a)=>{a.dragRef=e,o.value=e},onMousedown:B},null,544)],544)]),S(J,{max:T(t).max,color:T(t).color,size:T(f),align:T(t).align,onChange:v},null,8,["max","color","size","align"]),g("footer",ae,[S(T($),{label:"更新",u:"primary",onClick:p})])]))}});const le={class:"image-wrap"};var ne=u({setup(e){const l=c(""),n=c("");let o=c({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const r=({type:e,mid:a})=>{l.value!==a&&(l.value=a,n.value=e)};x([l,n],(()=>{i(l.value,n.value)}));const i=(e,a)=>{B.openImage({mid:e,type:a}).then((e=>{o.value=e}))},u=e=>{console.log("story change value: ",s({},e));const l=(n=s({},e),a(n,t({image:""})));var n;B.saveImage(l).then((e=>{console.log("save: ",e)}))};return(e,a)=>(d(),m("div",le,[S(F,{onChange:r}),T(o).image&&T(o).mid?(d(),z(te,{key:0,story:T(o),onChange:u},null,8,["story"])):M("",!0)]))}});N(u({setup:e=>(e,a)=>(d(),z(ne))})).mount("#app");
