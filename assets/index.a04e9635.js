var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,s=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&r(e,a,t[a]);if(l)for(var a of l(t))o.call(t,a)&&r(e,a,t[a]);return e};import{a as i,d as u,r as c,o as d,c as m,F as p,b as v,e as g,t as h,n as y,f,w as b,g as x,i as w,h as k,j as C,u as q,p as S,k as T,l as I,m as j,q as N}from"./vendor.64609b09.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const O={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}};var M=e=>async(t={},a={})=>{const{url:l,method:n}=e;return i.request({withCredentials:!1,url:"http://localhost:8080"+l,method:n,["get"===n?"params":"data"]:t}).then((e=>{const t=e.data;return(null==a?void 0:a.stream)?e:0===t.errNo?t.data:Promise.reject(t)})).catch((e=>Promise.reject(e)))};const V={};for(const ae in O)V[ae]=M(O[ae]);const z={class:"side"},L={class:"side-content-title"},P=["onClick"],B=u({emits:["change"],setup(e,{emit:t}){const a=c([]),l=c("");return V.getCatalog({}).then((e=>{a.value=e})),(e,n)=>(d(),m("div",z,[(d(!0),m(p,null,v(a.value,(e=>(d(),m("div",{key:e.id,class:"side-content"},[g("p",L,h(e.text),1),(d(!0),m(p,null,v(e.children,(a=>(d(),m("div",{key:a.mid,class:y({"side-content-cell":!0,"side-content-cell-active":l.value===a.mid}),onClick:n=>((e,a)=>{l.value=a.mid,t("change",s({type:e},a))})(e.type,a)},h(a.title),11,P)))),128))])))),128))]))}});var F=(e,t)=>{for(const[a,l]of t)e[a]=l;return e};var $=F(u({name:"Button",props:{label:{type:String,default:"提交"},disabled:{type:Boolean,default:!1}},setup(e){const{label:t}=f(e);return{localLabel:t}}}),[["render",function(e,t,a,l,n,o){return d(),m("button",{class:y(["meme-button",{disabled:e.disabled}])},h(e.localLabel),3)}]]);const U=u({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:t}){const a=c(null);return{input:a,blur:e=>{(e=>{t("update:modelValue",e.target.value)})(e),t("blur")}}}}),D=["title","value"];var R=F(U,[["render",function(e,t,a,l,n,o){return d(),m("input",{ref:"input",class:y(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:t[0]||(t[0]=(...t)=>e.blur&&e.blur(...t)),onKeyup:t[1]||(t[1]=b((t=>{var a;return null==(a=e.input)?void 0:a.blur()}),["enter"]))},null,42,D)}]]);u({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:500},interval:{type:Number,default:300}},created(){this.showChange(this.show)},setup(e){const{show:t,interval:a,min:l}=f(e),n=c(t.value);let o,r=0;const s=e=>{e?0===a.value?(n.value=!0,r=(new Date).getTime()):o=window.setTimeout((()=>{n.value=!0,r=(new Date).getTime()}),a.value):(clearTimeout(o),(()=>{const e=(new Date).getTime()-r;e>l.value?n.value=!1:setTimeout((()=>{n.value=!1}),Math.max(l.value-e,0))})())};return x(t,(()=>{s(t.value)})),{localShow:n,showChange:s}}});const A={class:"meme-radio"},E=["name","value","checked"],K={class:"meme-radio-label"},X=u({props:{label:{type:String,required:!0},name:{type:String,required:!0},value:{type:String,required:!0},checked:{type:Boolean,required:!0}},emits:["toggle"],setup:(e,{emit:t})=>(a,l)=>(d(),m("label",A,[g("input",{class:"meme-radio-input",type:"radio",name:e.name,value:e.value,checked:e.checked,onChange:l[0]||(l[0]=a=>{return l=e.value,void t("toggle",l);var l})},null,40,E),g("span",K,h(e.label),1)]))});const Y={class:"property"},H=u({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0},align:{type:String,required:!0}},emits:["change"],setup(e,{emit:t}){const a=e,l=w("text"),n=w("updateText"),{max:o,size:r,color:s,align:i}=f(a),u=k((()=>"start"===i.value)),c=(e,a)=>{const l={max:o.value,size:r.value,color:s.value,align:i.value};l[a]=["color","align"].includes(a)?e:parseInt(e),t("change",l)};return(e,t)=>(d(),m("div",Y,[C(q(R),{class:"property-max",value:q(o),"onUpdate:modelValue":t[0]||(t[0]=e=>c(e,"max"))},null,8,["value"]),C(q(R),{class:"property-size",value:q(r),"onUpdate:modelValue":t[1]||(t[1]=e=>c(e,"size"))},null,8,["value"]),C(q(R),{class:"property-color",value:q(s),"onUpdate:modelValue":t[2]||(t[2]=e=>c(e,"color"))},null,8,["value"]),C(q(X),{label:"start",name:"align",value:"start",checked:q(u),onToggle:t[3]||(t[3]=e=>c(e,"align"))},null,8,["checked"]),C(q(X),{label:"end",name:"align",value:"end",checked:!q(u),onToggle:t[4]||(t[4]=e=>c(e,"align"))},null,8,["checked"]),C(q(R),{class:"property-text",value:q(l),"onUpdate:modelValue":q(n)},null,8,["value","onUpdate:modelValue"])]))}});const W={class:"container"},G={class:"container-header"},J={class:"container-title"},Q={class:"container-wraper"},Z={class:"container-footer"},_=u({props:{story:{type:null,required:!0}},emits:["change"],setup(e,{emit:t}){const a=f(e).story,l=c(null),n=c(null),o=c(null),r=c("金馆长");S("text",r),S("updateText",(e=>{r.value=e,j()}));const s=c(0),i=c(0),u=()=>{console.log("你说更新就更新")},p=()=>{t("change",a.value)},v=e=>{const{max:t,size:l,color:n,align:o}=e;a.value.max=t,a.value.font=`${l}px sans-serif`,a.value.color=n,a.value.align=o},y=k((()=>{const e=a.value.font.match(/(\d{1,3})px/)||["","32"];return 1*Number(e[1])})),b=new Image,w=()=>{b.onload=async()=>{const e=l.value;e.width=b.naturalWidth,e.height=b.naturalHeight,s.value=e.width,i.value=e.height,I(),j(),N()},b.onerror=e=>{console.error(e)},b.src=a.value.image},I=()=>{const e=n.value;e.style.width=`${s.value}px`,e.style.height=`${i.value}px`},j=()=>{const e=l.value,t=e.getContext("2d");t.drawImage(b,0,0);const{x:n,y:o,font:s,color:i,align:u,max:c}=a.value;t.font=s,t.fillStyle=i,t.textAlign=u,t.fillText(r.value,n,o,c||e.width)},N=()=>{const{x:e,y:t,max:l,align:n}=a.value,r=o.value;r.style.width=`${l}px`,r.style.height=`${y.value}px`,r.style.top=t-y.value+2+"px",r.style.left="start"===n?`${e}px`:e-l+"px"};x(a,((e,t)=>{e.mid!==t.mid?w():(j(),N())}),{deep:!0});let O=0,M=0;const V=20;let z=!1;const L=e=>{z=!0;const{clientX:t,clientY:a}=e;O=t,M=a},P=e=>{if(!z)return;const{clientX:t,clientY:l}=e,n=o.value,{width:r,height:u}=n.getBoundingClientRect();let c=n.offsetLeft+t-O,d=n.offsetTop+l-M;c<-20||d<-20||c>s.value-r+V||d>i.value-u+V?z=!1:(O=t,M=l),c=Math.max(Math.min(c,s.value-r+V),-20),d=Math.max(Math.min(d,i.value-u+V),-20);const{align:m,max:p}=a.value;c+="end"===m?p:0,d+=y.value-2,((e,t)=>{a.value.x=e,a.value.y=t})(c,d)},B=()=>{z&&(z=!1)};return T((()=>{w()})),(e,t)=>(d(),m("div",W,[g("div",G,[g("div",J,h(q(a).title),1),C(q($),{label:"添加",u:"primary",onClick:u})]),g("div",Q,[g("canvas",{class:"container-canvas",ref:(e,t)=>{t.canvasRef=e,l.value=e}},null,512),g("div",{class:"container-area",ref:(e,t)=>{t.areaRef=e,n.value=e},onMousemove:P,onMouseup:B},[g("div",{class:"container-drag",ref:(e,t)=>{t.dragRef=e,o.value=e},onMousedown:L},null,544)],544)]),C(H,{max:q(a).max,color:q(a).color,size:q(y),align:q(a).align,onChange:v},null,8,["max","color","size","align"]),g("footer",Z,[C(q($),{label:"更新",u:"primary",onClick:p})])]))}});const ee={class:"image-wrap"},te=u({setup(e){const l=c(""),n=c("");let o=c({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const r=({type:e,mid:t})=>{l.value!==t&&(l.value=t,n.value=e)};x([l,n],(()=>{i(l.value,n.value)}));const i=(e,t)=>{V.openImage({mid:e,type:t}).then((e=>{o.value=e}))},u=e=>{console.log("story change value: ",s({},e));const l=(n=s({},e),t(n,a({image:""})));var n;V.saveImage(l)};return(e,t)=>(d(),m("div",ee,[C(B,{onChange:r}),q(o).image&&q(o).mid?(d(),I(_,{key:0,story:q(o),onChange:u},null,8,["story"])):j("",!0)]))}});N(u({setup:e=>(e,t)=>(d(),I(te))})).mount("#app");
