var ge=Object.defineProperty,fe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,he=Object.prototype.propertyIsEnumerable;var X=(t,e,l)=>e in t?ge(t,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[e]=l,N=(t,e)=>{for(var l in e||(e={}))ye.call(e,l)&&X(t,l,e[l]);if(J)for(var l of J(e))he.call(e,l)&&X(t,l,e[l]);return t},Y=(t,e)=>fe(t,_e(e));import{a as xe,d as C,r as f,o as _,c as x,F as j,b as Q,e as F,t as V,n as P,f as S,w as be,g as U,i as Z,h as O,j as $,u as i,p as ee,k as $e,l as te,m as Fe,q as we}from"./vendor.b3ec0a9b.js";const Ce=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function l(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=l(n);fetch(n.href,o)}};Ce();const ae={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},ke=()=>"https://imeme.vercel.app";var Be=t=>async(e={},l={})=>{const{url:a,method:n}=t,o=ke();return xe.request({withCredentials:!1,url:o+a,method:n,[n==="get"?"params":"data"]:e}).then(u=>{const r=u.data;return(l==null?void 0:l.stream)?u:r.errNo===0?r.data:Promise.reject(r)}).catch(u=>Promise.reject(u))};const M={};for(const t in ae)M[t]=Be(ae[t]);const De={class:"side"},Ie={class:"side-content-title"},Te=["onClick"],Ae=C({emits:["change"],setup(t,{emit:e}){const l=f([]),a=f(""),n=()=>{M.getCatalog({}).then(u=>{l.value=u})},o=(u,r)=>{a.value=r.mid,e("change",N({type:u},r))};return n(),(u,r)=>(_(),x("div",De,[(_(!0),x(j,null,Q(l.value,p=>(_(),x("div",{key:p.id,class:"side-content"},[F("p",Ie,V(p.text),1),(_(!0),x(j,null,Q(p.children,g=>(_(),x("div",{key:g.mid,class:P({"side-content-cell":!0,"side-content-cell-active":a.value===g.mid}),onClick:b=>o(p.type,g)},V(g.title),11,Te))),128))]))),128))]))}});var ne=(t,e)=>{for(const[l,a]of e)t[l]=a;return t};const Ve=C({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){const{label:e}=S(t);return{localLabel:e}}});function Le(t,e,l,a,n,o){return _(),x("button",{class:P(["meme-button",{disabled:t.disabled}])},V(t.localLabel),3)}var K=ne(Ve,[["render",Le]]);const Ne=C({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:e}){const l=f(null),a=o=>{e("update:modelValue",o.target.value)};return{input:l,blur:o=>{a(o),e("blur")}}}}),Se=["title","value"];function Me(t,e,l,a,n,o){return _(),x("input",{ref:"input",class:P(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:e[0]||(e[0]=(...u)=>t.blur&&t.blur(...u)),onKeyup:e[1]||(e[1]=be(u=>{var r;return(r=t.input)==null?void 0:r.blur()},["enter"]))},null,42,Se)}var E=ne(Ne,[["render",Me]]);const Ee=500,ze=300;C({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Ee},interval:{type:Number,default:ze}},created(){this.showChange(this.show)},setup(t){const{show:e,interval:l,min:a}=S(t),n=f(e.value);let o,u=0;const r=()=>{const b=new Date().getTime()-u;b>a.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(a.value-b,0))},p=g=>{g?l.value===0?(n.value=!0,u=new Date().getTime()):o=window.setTimeout(()=>{n.value=!0,u=new Date().getTime()},l.value):(clearTimeout(o),r())};return U(e,()=>{p(e.value)}),{localShow:n,showChange:p}}});const qe={class:"meme-radio"},Re=["name","value","checked"],je={class:"meme-radio-label"},le=C({props:{label:{type:String,required:!0},name:{type:String,required:!0},value:{type:String,required:!0},checked:{type:Boolean,required:!0}},emits:["toggle"],setup(t,{emit:e}){const l=a=>{e("toggle",a)};return(a,n)=>(_(),x("label",qe,[F("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=o=>l(t.value))},null,40,Re),F("span",je,V(t.label),1)]))}});const Pe={class:"property"},Ue=C({props:{max:{type:Number,required:!0},size:{type:Number,required:!0},color:{type:String,required:!0},align:{type:String,required:!0}},emits:["change"],setup(t,{emit:e}){const l=t,a=Z("text"),n=Z("updateText"),{max:o,size:u,color:r,align:p}=S(l),g=O(()=>p.value==="start"),b=(k,v)=>{const y={max:o.value,size:u.value,color:r.value,align:p.value};y[v]=["color","align"].includes(v)?k:parseInt(k),e("change",y)};return(k,v)=>(_(),x("div",Pe,[$(i(E),{class:"property-max",value:i(o),"onUpdate:modelValue":v[0]||(v[0]=y=>b(y,"max"))},null,8,["value"]),$(i(E),{class:"property-size",value:i(u),"onUpdate:modelValue":v[1]||(v[1]=y=>b(y,"size"))},null,8,["value"]),$(i(E),{class:"property-color",value:i(r),"onUpdate:modelValue":v[2]||(v[2]=y=>b(y,"color"))},null,8,["value"]),$(i(le),{label:"start",name:"align",value:"start",checked:i(g),onToggle:v[3]||(v[3]=y=>b(y,"align"))},null,8,["checked"]),$(i(le),{label:"end",name:"align",value:"end",checked:!i(g),onToggle:v[4]||(v[4]=y=>b(y,"align"))},null,8,["checked"]),$(i(E),{class:"property-text",value:i(a),"onUpdate:modelValue":i(n)},null,8,["value","onUpdate:modelValue"])]))}});const Oe={class:"container"},Ke={class:"container-header"},We={class:"container-title"},Ge={key:0,class:"container-wall"},He={class:"container-wraper"},Je={class:"container-footer"},Xe=C({props:{story:{type:null,required:!0}},emits:["change"],setup(t,{emit:e}){const a=S(t).story,n=f(null),o=f(null),u=f(null),r=f(!0),p=f(!0),g=f("\u91D1\u9986\u957F"),b=s=>{g.value=s,z()};ee("text",g),ee("updateText",b);const k=f(0),v=f(0),y=(s,d)=>{a.value.x=s,a.value.y=d},oe=s=>{const{max:d,size:c,color:m,align:h}=s;a.value.max=d,a.value.font=`${c}px sans-serif`,a.value.color=m,a.value.align=h},L=O(()=>{const s=a.value.font.match(/(\d{1,3})px/)||["","32"];return Number(s[1])*1}),W=O(()=>{var m;return((m=a.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:m[0])||"png"}),T=new Image,G=()=>{T.onload=async()=>{const s=n.value;s.width=T.naturalWidth,s.height=T.naturalHeight,k.value=s.width,v.value=s.height,se(),z(),H()},T.onerror=s=>{console.error(s)},T.src=a.value.image},se=()=>{const s=o.value;s.style.width=`${k.value}px`,s.style.height=`${v.value}px`},z=()=>{const s=n.value,d=s.getContext("2d");d.drawImage(T,0,0);const{x:c,y:m,font:h,color:w,align:D,max:I}=a.value;d.font=h,d.fillStyle=w,d.textAlign=D,d.fillText(g.value,c,m,I||s.width)},H=()=>{const{x:s,y:d,max:c,align:m}=a.value,h=u.value;h.style.width=`${c}px`,h.style.height=`${L.value}px`,h.style.top=`${d-L.value+2}px`,h.style.left=m==="start"?`${s}px`:`${s-c}px`};U(a,(s,d)=>{s.mid!==d.mid?G():(z(),H())},{deep:!0});let q=0,R=0;const B=20;let A=!1;const re=s=>{A=!0;const{clientX:d,clientY:c}=s;q=d,R=c},ue=s=>{if(!A)return;const{clientX:d,clientY:c}=s,m=u.value,{width:h,height:w}=m.getBoundingClientRect();let D=m.offsetLeft+d-q,I=m.offsetTop+c-R;D<-B||I<-B||D>k.value-h+B||I>v.value-w+B?A=!1:(q=d,R=c),D=Math.max(Math.min(D,k.value-h+B),-B),I=Math.max(Math.min(I,v.value-w+B),-B);const{align:me,max:ve}=a.value;D+=me==="end"?ve:0,I+=L.value-2,y(D,I)},ie=()=>{!A||(A=!1)},ce=()=>{console.log("\u4F60\u8BF4\u66F4\u65B0\u5C31\u66F4\u65B0\uFF1F\uFF1F\u4F60\u8FD9\u4E48\u62FD\uFF1F\uFF1F"),r.value?r.value=!1:r.value=!0},de=()=>{const s=n.value;let c=`image/${["jpeg","jpg"].includes(W.value)?"jpeg":"png"}`;const m=s.toDataURL(c),h=`imeme_${a.value.title}_${g.value}`,w=document.createElement("a");w.setAttribute("download",h),w.setAttribute("href",m),w.setAttribute("target","_blank"),w.click()},pe=()=>{r.value?e("change",a.value):console.log("\u4FDD\u5B58\u6DFB\u52A0\u5185\u5BB9\u3002")};return $e(()=>{G()}),(s,d)=>(_(),x("div",Oe,[F("div",Ke,[F("div",We,V(`${i(a).title}.${i(W)}`),1),$(i(K),{label:r.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:ce},null,8,["label"]),$(i(K),{label:"\u4E0B\u8F7D",u:"primary",onClick:de})]),!r.value&&p.value?(_(),x("div",Ge," \u65B0\u589E\u672A\u9009\u62E9\u56FE\u7247\u7684\u65F6\u5019\u663E\u793A ")):(_(),x(j,{key:1},[F("div",He,[F("canvas",{class:"container-canvas",ref:(c,m)=>{m.canvasRef=c,n.value=c}},null,512),F("div",{class:"container-area",ref:(c,m)=>{m.areaRef=c,o.value=c},onMousemove:ue,onMouseup:ie},[F("div",{class:"container-drag",ref:(c,m)=>{m.dragRef=c,u.value=c},onMousedown:re},null,544)],544)]),$(Ue,{max:i(a).max,color:i(a).color,size:i(L),align:i(a).align,onChange:oe},null,8,["max","color","size","align"])],64)),F("footer",Je,[$(i(K),{label:r.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:pe},null,8,["label"])])]))}});const Ye={class:"image-wrap"},Qe=C({setup(t){const e=f(""),l=f("");let a=f({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const n=({type:r,mid:p})=>{e.value!==p&&(e.value=p,l.value=r)};U([e,l],()=>{o(e.value,l.value)});const o=(r,p)=>{M.openImage({mid:r,type:p}).then(g=>{a.value=g})},u=r=>{console.log("story change value: ",N({},r));const p=Y(N({},r),{image:""});M.saveImage(p)};return(r,p)=>(_(),x("div",Ye,[$(Ae,{onChange:n}),i(a).image&&i(a).mid?(_(),te(Xe,{key:0,story:i(a),onChange:u},null,8,["story"])):Fe("",!0)]))}});const Ze=C({setup(t){return(e,l)=>(_(),te(Qe))}});we(Ze).mount("#app");
