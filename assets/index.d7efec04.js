var Ge=Object.defineProperty,Xe=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var he=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var _e=(a,n,l)=>n in a?Ge(a,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[n]=l,ue=(a,n)=>{for(var l in n||(n={}))qe.call(n,l)&&_e(a,l,n[l]);if(he)for(var l of he(n))Ke.call(n,l)&&_e(a,l,n[l]);return a},ye=(a,n)=>Xe(a,Ye(n));import{r as Je,c as J,o as _,d as E,t as Z,a as $,F as ce,b as Fe,u as p,e as y,f as O,n as Q,g as Ze,h as Qe,i as w,w as et,j as ie,k as de,l as P,m as xe,p as k,q as pe,s as Ce,v as we,x as be,y as tt,z as at,A as nt,B as ot,C as lt,D as st}from"./vendor.f629b121.js";const rt=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const g of r.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&i(g)}).observe(document,{childList:!0,subtree:!0});function l(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=l(e);fetch(e.href,r)}};rt();var $e=(a,n)=>{const l=a.__vccOpts||a;for(const[i,e]of n)l[i]=e;return l};const ut={};function ct(a,n){const l=Je("router-view");return _(),J(l)}var it=$e(ut,[["render",ct]]);const dt={class:"side"},pt={class:"side-content-title"},vt=["onClick"],gt=E({props:{catalogList:null,current:null},emits:["change"],setup(a,{emit:n}){const i=Z(a).catalogList,e=(r,g)=>{n("change",ue({type:r},g))};return(r,g)=>(_(),$("div",dt,[(_(!0),$(ce,null,Fe(p(i),m=>(_(),$("div",{key:m.id,class:"side-content"},[y("p",pt,O(m.text),1),(_(!0),$(ce,null,Fe(m.children,f=>(_(),$("div",{key:f.mid,class:Q({"side-content-cell":!0,"side-content-cell-active":a.current===f.mid}),onClick:b=>e(m.type,f)},O(f.title),11,vt))),128))]))),128))]))}});const H=E({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){return(n,l)=>(_(),$("button",{class:Q(["meme-button",{disabled:a.disabled}])},[Ze(n.$slots,"default",{},()=>[Qe(O(a.label),1)])],2))}});const mt=E({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:n}){const l=w(null),i=r=>{n("update:modelValue",r.target.value)};return{input:l,blur:r=>{i(r),n("blur")}}}}),ft=["title","value"];function ht(a,n,l,i,e,r){return _(),$("input",{ref:"input",class:Q(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:n[0]||(n[0]=(...g)=>a.blur&&a.blur(...g)),onKeyup:n[1]||(n[1]=et(g=>{var m;return(m=a.input)==null?void 0:m.blur()},["enter"]))},null,42,ft)}var ee=$e(mt,[["render",ht]]);const _t=500,yt=300;E({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:_t},interval:{type:Number,default:yt}},created(){this.showChange(this.show)},setup(a){const{show:n,interval:l,min:i}=Z(a),e=w(n.value);let r,g=0;const m=()=>{const h=new Date().getTime()-g;h>i.value?e.value=!1:setTimeout(()=>{e.value=!1},Math.max(i.value-h,0))},f=b=>{b?l.value===0?(e.value=!0,g=new Date().getTime()):r=window.setTimeout(()=>{e.value=!0,g=new Date().getTime()},l.value):(clearTimeout(r),m())};return ie(n,()=>{f(n.value)}),{localShow:e,showChange:f}}});const Ft={class:"meme-radio"},xt=["name","value","checked"],Ct={class:"meme-radio-label"},G=E({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(a,{emit:n}){const l=i=>{n("toggle",i)};return(i,e)=>(_(),$("label",Ft,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:e[0]||(e[0]=r=>l(a.value))},null,40,xt),y("span",Ct,O(a.label),1)]))}});const wt={class:"meme-file-upload"},bt={class:"file-button"},$t=y("i",{class:"file-glyphicon"},null,-1),kt=y("span",null,"UPLOAD FILE",-1),Dt=y("i",{class:"file-tips"},"Drop files here to upload",-1),Et=[Dt],Mt=E({emits:["change"],setup(a,{emit:n}){const l=de("commands"),i=u=>{const o=u.target.files;if(!o)return!1;h(o)},e=u=>{u.stopPropagation(),u.preventDefault()},r=u=>{u.stopPropagation(),u.preventDefault()},g=u=>{u.stopPropagation(),u.preventDefault();const o=u.dataTransfer.files;h(o)},m=u=>{u.stopPropagation(),u.preventDefault();const o=u.clipboardData.files;h(o)},f=1*1024*1024,b=/^image\//,h=u=>{if(u.length!==1)return x("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const o=u[0],{name:d,size:N,type:T}=o;if(!b.test(T))return x(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${T}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const V=d.replace(/\.\w*$/g,"");if(l.value.includes(V))return x(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${d}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${V}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(N>f)return x("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const A=new FileReader;A.onload=S=>{const te=S.target.result;M(d,te)},A.onerror=()=>{x(A.error.message)},A.readAsDataURL(o)},x=u=>{alert(u)},M=(u,o)=>{n("change",{name:u,base64:o})};return(u,o)=>(_(),$("div",wt,[y("div",bt,[$t,kt,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:i},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:e,onDragover:r,onDrop:g,onPaste:m},Et,32)]))}});const Bt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},It=y("title",null,"dice",-1),Tt=["fill"],At=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:n}){const l=a,i=P(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),e=()=>{n("click")};return(r,g)=>(_(),J(p(H),{class:"dice-button",u:"icon",onClick:e},{default:xe(()=>[(_(),$("svg",Bt,[It,y("path",{fill:p(i),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Tt)]))]),_:1}))}});const St={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Lt=y("title",null,"picker",-1),zt=["fill"],Pt=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:n}){const l=a,i=P(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),e=()=>{n("click")};return(r,g)=>(_(),J(p(H),{class:"picker-button",u:"icon",onClick:e},{default:xe(()=>[(_(),$("svg",St,[Lt,y("path",{fill:p(i),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,zt)]))]),_:1}))}});const Rt={class:"property"},Nt=E({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(a,{emit:n}){const l=a,i=de("text"),e=de("updateText"),{max:r,size:g,color:m,align:f,direction:b}=Z(l),h=(u,o)=>{const d={max:r.value,size:g.value,color:m.value,align:f.value,direction:b.value};d[o]=["color","align","direction"].includes(o)?u:parseInt(u),n("change",d)},x=()=>{const u="#"+Math.floor(Math.random()*16777215).toString(16);h(u,"color")},M=()=>{n("pick")};return(u,o)=>(_(),$("div",Rt,[k(p(ee),{class:"property-max",value:p(r),"onUpdate:modelValue":o[0]||(o[0]=d=>h(d,"max"))},null,8,["value"]),k(p(ee),{class:"property-size",value:p(g),"onUpdate:modelValue":o[1]||(o[1]=d=>h(d,"size"))},null,8,["value"]),k(p(ee),{class:"property-color",value:p(m),"onUpdate:modelValue":o[2]||(o[2]=d=>h(d,"color"))},null,8,["value"]),k(At,{color:p(m),onClick:x},null,8,["color"]),k(Pt,{color:p(m),onClick:M},null,8,["color"]),k(p(G),{label:"start",name:"align",value:"start",checked:p(f)==="start",onToggle:o[3]||(o[3]=d=>h(d,"align"))},null,8,["checked"]),k(p(G),{label:"center",name:"align",value:"center",checked:p(f)==="center",onToggle:o[4]||(o[4]=d=>h(d,"align"))},null,8,["checked"]),k(p(G),{label:"end",name:"align",value:"end",checked:p(f)==="end",onToggle:o[5]||(o[5]=d=>h(d,"align"))},null,8,["checked"]),k(p(ee),{class:"property-text",value:p(i),"onUpdate:modelValue":p(e)},null,8,["value","onUpdate:modelValue"]),k(p(G),{label:"up",name:"direction",value:"up",checked:p(b)==="up",onToggle:o[6]||(o[6]=d=>h(d,"direction"))},null,8,["checked"]),k(p(G),{label:"down",name:"direction",value:"down",checked:p(b)==="down",onToggle:o[7]||(o[7]=d=>h(d,"direction"))},null,8,["checked"])]))}}),Vt=(a,n,l)=>{let i=0,e=a.length-1;for(;i<=e;){const r=Math.floor((i+e)/2),g=l.measureText(a.substring(0,r)).width,m=l.measureText(a.substring(0,r+1)).width;if(g<=n&&m>n)return r;g<n?i=r+1:e=r-1}return-1},Ut=(a,n,l)=>{const i=[];let e=0;for(;(e=Vt(a,n,l))!==-1;)i.push(a.substring(0,e)),a=a.substring(e);return a&&i.push(a),i};const jt={class:"container"},Wt={class:"container-header"},Ot={class:"container-title"},Ht={key:0,class:"container-wall"},Gt={class:"container-wraper"},Xt={class:"container-footer"},Yt=E({props:{story:null},emits:["change","create","replace"],setup(a,{emit:n}){const l=a,i=1.2,e=Z(l).story,r=w(null),g=w(null),m=w(null),f=w(!0),b=w(!0);let h=null;const x=w(!1),M=w(!1),u=w(null),o=11,d=14,N=d*o,T=d*o,V=d,A=(()=>{const t=[];for(let s=1;s<o;s++)t.push([s,0,s,o]),t.push([0,s,o,s]);return t.map(s=>s.map(c=>c*d))})(),S=w("\u91D1\u9986\u957F"),te=t=>{S.value=t,ne()};pe("text",S),pe("updateText",te);const L=w(0),U=w(0),De=(t,s)=>{e.value.x=t,e.value.y=s},Ee=t=>{const{max:s,size:c,color:v,align:F,direction:C}=t;e.value.max=s,e.value.font=`${c}px sans-serif`,e.value.color=v,e.value.align=F,e.value.direction=C},j=P(()=>{const t=e.value.font.match(/(\d{1,3})px/)||["","32"];return Number(t[1])}),ve=P(()=>{var v;return((v=e.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:v[0])||"png"}),Me=P(()=>`${e.value.title}.${ve.value} ${L.value} * ${U.value} (${e.value.x}, ${e.value.y})`),ge=P(()=>{const t=e.value.max||L.value;return{start:0,center:Math.floor(t/2),end:t}[e.value.align]}),z=new Image,ae=()=>{z.onload=async()=>{const t=r.value;t.width=z.naturalWidth,t.height=z.naturalHeight,L.value=t.width,U.value=t.height,Be(),ne(),me()},z.onerror=t=>{console.error(t)},z.src=e.value.image},Be=()=>{const t=g.value;t.style.width=`${L.value}px`,t.style.height=`${U.value}px`},ne=()=>{const t=r.value,s=t.getContext("2d");s.drawImage(z,0,0);const{x:c,y:v,font:F,color:C,align:D,max:B,direction:se}=e.value;s.font=F,s.fillStyle=C,s.textAlign=D;const X=B||t.width,Y=Ut(S.value,X,s);Y.forEach((re,q)=>{const K=se==="down"?q:q-(Y.length-1);s.fillText(re,c,v+K*j.value*i,X)})},me=()=>{const{x:t,y:s,max:c}=e.value,v=m.value;v.style.width=`${c}px`,v.style.height=`${j.value*i}px`,v.style.top=`${s-j.value+2}px`,v.style.left=`${t-ge.value}px`};ie(e,(t,s)=>{t.mid!==s.mid?ae():(ne(),me())},{deep:!0});let oe=0,le=0;const I=20;let W=!1;const Ie=t=>{W=!0;const{clientX:s,clientY:c}=t;oe=s,le=c},Te=t=>{if(!W)return;const{clientX:s,clientY:c}=t,v=m.value,{width:F,height:C}=v.getBoundingClientRect();let D=v.offsetLeft+s-oe,B=v.offsetTop+c-le;D<-I||B<-I||D>L.value-F+I||B>U.value-C+I?W=!1:(oe=s,le=c),D=Math.max(Math.min(D,L.value-F+I),-I),B=Math.max(Math.min(B,U.value-C+I),-I),D+=ge.value,B+=j.value-2,De(D,B)},Ae=()=>{!W||(W=!1)},Se=()=>{f.value?f.value=!1:(f.value=!0,b.value=!0,h?(fe(h),h=null):ae())},Le=()=>{const t=r.value;let c=`image/${["jpeg","jpg"].includes(ve.value)?"jpeg":"png"}`;const v=t.toDataURL(c),F=`imeme_${e.value.title}_${S.value}`,C=document.createElement("a");C.setAttribute("download",F),C.setAttribute("href",v),C.setAttribute("target","_blank"),C.click()},ze=()=>{f.value?n("change",e.value):b.value||(n("create",e.value),f.value=!0,b.value=!0)},Pe=({name:t,base64:s})=>{b.value=!1;const{mid:c,title:v,feature:F,image:C,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q}=e.value;h={mid:c,title:v,feature:F,image:C,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q};const K=t.slice(0,t.lastIndexOf("."));fe({mid:`meme_${new Date().getTime()}`,title:K,feature:K,image:s,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down"})},fe=t=>{n("replace",t)},Re=()=>{x.value=!0},Ne=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(o*d/2,o*d/2,o*d/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",A.forEach(s=>{const{0:c,1:v,2:F,3:C}=s;t.moveTo(c,v),t.lineTo(F,C)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((o-1)*d/2,(o-1)*d/2,1*d,1*d),t.stroke()},Ve=(t,s)=>{const c=r.value,v=u.value;v.style.left=`${t+V}px`,v.style.top=`${s+V}px`;const F=v.getContext("2d"),C=Math.min(Math.max(0,t-5),c.width-o),D=Math.min(Math.max(0,s-5),c.height-o);F.clearRect(0,0,N,T),F.drawImage(c,C,D,o,o,0,0,N,T),Ne(F)},Ue=async t=>{if(!x.value)return!1;const{offsetX:s,offsetY:c}=t;s<0||c<0||(M.value=!0,Ve(s,c))},je=()=>{if(!x.value)return!1;M.value=!1},We=t=>{const s=D=>D.toString(16).padStart(2,"0"),{0:c,1:v,2:F,3:C}=t.data;return`#${s(c)}${s(v)}${s(F)}${s(C)}`.toUpperCase()},Oe=(t,s)=>{const F=r.value.getContext("2d").getImageData(t,s,1,1);return We(F)},He=t=>{if(!x.value)return!1;const{offsetX:s,offsetY:c}=t;if(s<0||c<0)return;const v=Oe(s,c);e.value.color=v,M.value=!1,x.value=!1};return Ce(()=>{ae()}),(t,s)=>(_(),$("div",jt,[y("div",Wt,[y("div",Ot,O(p(Me)),1),k(p(H),{label:f.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Se},null,8,["label"]),k(p(H),{label:"\u4E0B\u8F7D",u:"primary",onClick:Le})]),!f.value&&b.value?(_(),$("div",Ht,[k(p(Mt),{onChange:Pe})])):(_(),$(ce,{key:1},[y("div",Gt,[y("canvas",{ref:(c,v)=>{v.canvasRef=c,r.value=c},class:Q({"container-canvas":!0,"container-pointer":x.value}),onMousemove:Ue,onMouseleave:je,onClick:He},null,34),we(y("div",{class:"container-area",ref:(c,v)=>{v.areaRef=c,g.value=c},onMousemove:Te,onMouseup:Ae},[y("div",{class:"container-drag",ref:(c,v)=>{v.dragRef=c,m.value=c},onMousedown:Ie},null,544)],544),[[be,!x.value]]),we(y("canvas",{ref:(c,v)=>{v.layerRef=c,u.value=c},class:"container-layer",style:tt({borderRadius:`${o*d}px`}),width:N,height:T},null,4),[[be,x.value&&M.value]])]),k(Nt,{max:p(e).max,color:p(e).color,size:p(j),align:p(e).align,direction:p(e).direction,onChange:Ee,onPick:Re},null,8,["max","color","size","align","direction"])],64)),y("footer",Xt,[k(p(H),{label:f.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:ze},null,8,["label"])])]))}}),ke={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"}},qt=()=>"https://imeme.vercel.app";var Kt=a=>async(n={},l={})=>{const{url:i,method:e}=a,r=qt();return at.request({withCredentials:!1,url:r+i,method:e,[e==="get"?"params":"data"]:n}).then(g=>{const m=g.data;return(l==null?void 0:l.stream)?g:m.errNo===0?m.data:Promise.reject(m)}).catch(g=>Promise.reject(g))};const R={};for(const a in ke)R[a]=Kt(ke[a]);const Jt={class:"image-wrap"},Zt=E({setup(a){const n=w([]),l=w(""),i=w("");let e=w({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down"});const r=async()=>{const u=await R.getCatalog({});n.value=u},g=({type:u,mid:o})=>{l.value!==o&&(l.value=o,i.value=u)};ie([l,i],()=>{m(l.value,i.value)});const m=(u,o)=>{R.openImage({mid:u,type:o}).then(d=>{e.value=d})},f=u=>{const o=ye(ue({},u),{image:""});R.saveImage(o)},b=u=>{e.value=u},h=async u=>{const o=await R.createImage(u).catch(d=>{alert(d.message)});await r(),l.value=o.mid},x=w([]);pe("commands",x);const M=async()=>{const u=await R.getCommands({});x.value=u};return Ce(()=>{r(),M()}),(u,o)=>(_(),$("div",Jt,[k(gt,{current:l.value,"catalog-list":n.value,onChange:g},null,8,["current","catalog-list"]),p(e).image&&p(e).mid?(_(),J(Yt,{key:0,story:p(e),onChange:f,onReplace:b,onCreate:h},null,8,["story"])):nt("",!0)]))}});const Qt={class:"material-center"},ea=E({setup(a){return(n,l)=>(_(),$("div",Qt," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),ta=[{path:"/",component:Zt},{path:"/center",component:ea}],aa=ot({history:lt(),routes:ta});st(it).use(aa).mount("#app");
