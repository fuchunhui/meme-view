var Ge=Object.defineProperty,Xe=Object.defineProperties;var Ye=Object.getOwnPropertyDescriptors;var fe=Object.getOwnPropertySymbols;var qe=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var he=(a,o,l)=>o in a?Ge(a,o,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[o]=l,_e=(a,o)=>{for(var l in o||(o={}))qe.call(o,l)&&he(a,l,o[l]);if(fe)for(var l of fe(o))Ke.call(o,l)&&he(a,l,o[l]);return a},ye=(a,o)=>Xe(a,Ye(o));import{r as Je,c as J,o as _,d as E,t as Z,a as $,F as ue,b as Fe,u as d,e as y,f as O,n as Q,g as Ze,h as Qe,i as C,w as et,j as ce,k as ie,l as R,m as xe,p as k,q as de,s as Ce,v as we,x as be,y as tt,z as at,A as nt,B as ot,C as lt,D as st}from"./vendor.f629b121.js";const rt=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const v of r.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&i(v)}).observe(document,{childList:!0,subtree:!0});function l(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?r.credentials="include":e.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=l(e);fetch(e.href,r)}};rt();var $e=(a,o)=>{const l=a.__vccOpts||a;for(const[i,e]of o)l[i]=e;return l};const ut={};function ct(a,o){const l=Je("router-view");return _(),J(l)}var it=$e(ut,[["render",ct]]);const dt={class:"side"},pt={class:"side-content-title"},vt=["onClick"],gt=E({props:{catalogList:null,current:null},emits:["change"],setup(a,{emit:o}){const i=Z(a).catalogList,e=(r,v)=>{o("change",{type:r,child:v})};return(r,v)=>(_(),$("div",dt,[(_(!0),$(ue,null,Fe(d(i),m=>(_(),$("div",{key:m.id,class:"side-content"},[y("p",pt,O(m.text),1),(_(!0),$(ue,null,Fe(m.children,f=>(_(),$("div",{key:f.mid,class:Q({"side-content-cell":!0,"side-content-cell-active":a.current===f.mid}),onClick:b=>e(m.type,f)},O(f.title),11,vt))),128))]))),128))]))}});const H=E({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){return(o,l)=>(_(),$("button",{class:Q(["meme-button",{disabled:a.disabled}])},[Ze(o.$slots,"default",{},()=>[Qe(O(a.label),1)])],2))}});const mt=E({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:o}){const l=C(null),i=r=>{o("update:modelValue",r.target.value)};return{input:l,blur:r=>{i(r),o("blur")}}}}),ft=["title","value"];function ht(a,o,l,i,e,r){return _(),$("input",{ref:"input",class:Q(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:o[0]||(o[0]=(...v)=>a.blur&&a.blur(...v)),onKeyup:o[1]||(o[1]=et(v=>{var m;return(m=a.input)==null?void 0:m.blur()},["enter"]))},null,42,ft)}var ee=$e(mt,[["render",ht]]);const _t=500,yt=300;E({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:_t},interval:{type:Number,default:yt}},created(){this.showChange(this.show)},setup(a){const{show:o,interval:l,min:i}=Z(a),e=C(o.value);let r,v=0;const m=()=>{const h=new Date().getTime()-v;h>i.value?e.value=!1:setTimeout(()=>{e.value=!1},Math.max(i.value-h,0))},f=b=>{b?l.value===0?(e.value=!0,v=new Date().getTime()):r=window.setTimeout(()=>{e.value=!0,v=new Date().getTime()},l.value):(clearTimeout(r),m())};return ce(o,()=>{f(o.value)}),{localShow:e,showChange:f}}});const Ft={class:"meme-radio"},xt=["name","value","checked"],Ct={class:"meme-radio-label"},G=E({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(a,{emit:o}){const l=i=>{o("toggle",i)};return(i,e)=>(_(),$("label",Ft,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:e[0]||(e[0]=r=>l(a.value))},null,40,xt),y("span",Ct,O(a.label),1)]))}});const wt={class:"meme-file-upload"},bt={class:"file-button"},$t=y("i",{class:"file-glyphicon"},null,-1),kt=y("span",null,"UPLOAD FILE",-1),Dt=y("i",{class:"file-tips"},"Drop files here to upload",-1),Et=[Dt],Mt=E({emits:["change"],setup(a,{emit:o}){const l=ie("commands"),i=g=>{const n=g.target.files;if(!n)return!1;h(n)},e=g=>{g.stopPropagation(),g.preventDefault()},r=g=>{g.stopPropagation(),g.preventDefault()},v=g=>{g.stopPropagation(),g.preventDefault();const n=g.dataTransfer.files;h(n)},m=g=>{g.stopPropagation(),g.preventDefault();const n=g.clipboardData.files;h(n)},f=1*1024*1024,b=/^image\//,h=g=>{if(g.length!==1)return w("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const n=g[0],{name:u,size:I,type:A}=n;if(!b.test(A))return w(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${A}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const V=u.replace(/\.\w*$/g,"");if(l.value.includes(V))return w(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${u}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${V}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(I>f)return w("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const S=new FileReader;S.onload=L=>{const te=L.target.result;M(u,te)},S.onerror=()=>{w(S.error.message)},S.readAsDataURL(n)},w=g=>{alert(g)},M=(g,n)=>{o("change",{name:g,base64:n})};return(g,n)=>(_(),$("div",wt,[y("div",bt,[$t,kt,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:i},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:e,onDragover:r,onDrop:v,onPaste:m},Et,32)]))}});const Bt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},It=y("title",null,"dice",-1),Tt=["fill"],At=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:o}){const l=a,i=R(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),e=()=>{o("click")};return(r,v)=>(_(),J(d(H),{class:"dice-button",u:"icon",onClick:e},{default:xe(()=>[(_(),$("svg",Bt,[It,y("path",{fill:d(i),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Tt)]))]),_:1}))}});const St={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Lt=y("title",null,"picker",-1),zt=["fill"],Pt=E({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(a,{emit:o}){const l=a,i=R(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),e=()=>{o("click")};return(r,v)=>(_(),J(d(H),{class:"picker-button",u:"icon",onClick:e},{default:xe(()=>[(_(),$("svg",St,[Lt,y("path",{fill:d(i),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,zt)]))]),_:1}))}});const Rt={class:"property"},Nt=E({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(a,{emit:o}){const l=a,i=ie("text"),e=ie("updateText"),{max:r,size:v,color:m,align:f,direction:b}=Z(l),h=(g,n)=>{const u={max:r.value,size:v.value,color:m.value,align:f.value,direction:b.value};u[n]=["color","align","direction"].includes(n)?g:parseInt(g),o("change",u)},w=()=>{const g="#"+Math.floor(Math.random()*16777215).toString(16);h(g,"color")},M=()=>{o("pick")};return(g,n)=>(_(),$("div",Rt,[k(d(ee),{class:"property-max",value:d(r),"onUpdate:modelValue":n[0]||(n[0]=u=>h(u,"max"))},null,8,["value"]),k(d(ee),{class:"property-size",value:d(v),"onUpdate:modelValue":n[1]||(n[1]=u=>h(u,"size"))},null,8,["value"]),k(d(ee),{class:"property-color",value:d(m),"onUpdate:modelValue":n[2]||(n[2]=u=>h(u,"color"))},null,8,["value"]),k(At,{color:d(m),onClick:w},null,8,["color"]),k(Pt,{color:d(m),onClick:M},null,8,["color"]),k(d(G),{label:"start",name:"align",value:"start",checked:d(f)==="start",onToggle:n[3]||(n[3]=u=>h(u,"align"))},null,8,["checked"]),k(d(G),{label:"center",name:"align",value:"center",checked:d(f)==="center",onToggle:n[4]||(n[4]=u=>h(u,"align"))},null,8,["checked"]),k(d(G),{label:"end",name:"align",value:"end",checked:d(f)==="end",onToggle:n[5]||(n[5]=u=>h(u,"align"))},null,8,["checked"]),k(d(ee),{class:"property-text",value:d(i),"onUpdate:modelValue":d(e)},null,8,["value","onUpdate:modelValue"]),k(d(G),{label:"up",name:"direction",value:"up",checked:d(b)==="up",onToggle:n[6]||(n[6]=u=>h(u,"direction"))},null,8,["checked"]),k(d(G),{label:"down",name:"direction",value:"down",checked:d(b)==="down",onToggle:n[7]||(n[7]=u=>h(u,"direction"))},null,8,["checked"])]))}}),Vt=(a,o,l)=>{let i=0,e=a.length-1;for(;i<=e;){const r=Math.floor((i+e)/2),v=l.measureText(a.substring(0,r)).width,m=l.measureText(a.substring(0,r+1)).width;if(v<=o&&m>o)return r;v<o?i=r+1:e=r-1}return-1},Ut=(a,o,l)=>{const i=[];let e=0;for(;(e=Vt(a,o,l))!==-1;)i.push(a.substring(0,e)),a=a.substring(e);return a&&i.push(a),i};const jt={class:"container"},Wt={class:"container-header"},Ot={class:"container-title"},Ht={key:0,class:"container-wall"},Gt={class:"container-wraper"},Xt={class:"container-footer"},Yt=E({props:{story:null},emits:["change","create","replace"],setup(a,{emit:o}){const l=a,i=1.2,e=Z(l).story,r=C(null),v=C(null),m=C(null),f=C(!0),b=C(!0);let h=null;const w=C(!1),M=C(!1),g=C(null),n=11,u=14,I=u*n,A=u*n,V=u,S=(()=>{const t=[];for(let s=1;s<n;s++)t.push([s,0,s,n]),t.push([0,s,n,s]);return t.map(s=>s.map(c=>c*u))})(),L=C("\u91D1\u9986\u957F"),te=t=>{L.value=t,ne()};de("text",L),de("updateText",te);const z=C(0),U=C(0),De=(t,s)=>{e.value.x=t,e.value.y=s},Ee=t=>{const{max:s,size:c,color:p,align:F,direction:x}=t;e.value.max=s,e.value.font=`${c}px sans-serif`,e.value.color=p,e.value.align=F,e.value.direction=x},j=R(()=>{const t=e.value.font.match(/(\d{1,3})px/)||["","32"];return Number(t[1])}),pe=R(()=>{var p;return((p=e.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:p[0])||"png"}),Me=R(()=>`${e.value.title}.${pe.value} ${z.value} * ${U.value} (${e.value.x}, ${e.value.y})`),ve=R(()=>{const t=e.value.max||z.value;return{start:0,center:Math.floor(t/2),end:t}[e.value.align]}),P=new Image,ae=()=>{P.onload=async()=>{const t=r.value;t.width=P.naturalWidth,t.height=P.naturalHeight,z.value=t.width,U.value=t.height,Be(),ne(),ge()},P.onerror=t=>{console.error(t)},P.src=e.value.image},Be=()=>{const t=v.value;t.style.width=`${z.value}px`,t.style.height=`${U.value}px`},ne=()=>{const t=r.value,s=t.getContext("2d");s.drawImage(P,0,0);const{x:c,y:p,font:F,color:x,align:D,max:B,direction:se}=e.value;s.font=F,s.fillStyle=x,s.textAlign=D;const X=B||t.width,Y=Ut(L.value,X,s);Y.forEach((re,q)=>{const K=se==="down"?q:q-(Y.length-1);s.fillText(re,c,p+K*j.value*i,X)})},ge=()=>{const{x:t,y:s,max:c}=e.value,p=m.value;p.style.width=`${c}px`,p.style.height=`${j.value*i}px`,p.style.top=`${s-j.value+2}px`,p.style.left=`${t-ve.value}px`};ce(e,(t,s)=>{t.mid!==s.mid?ae():(ne(),ge())},{deep:!0});let oe=0,le=0;const T=20;let W=!1;const Ie=t=>{W=!0;const{clientX:s,clientY:c}=t;oe=s,le=c},Te=t=>{if(!W)return;const{clientX:s,clientY:c}=t,p=m.value,{width:F,height:x}=p.getBoundingClientRect();let D=p.offsetLeft+s-oe,B=p.offsetTop+c-le;D<-T||B<-T||D>z.value-F+T||B>U.value-x+T?W=!1:(oe=s,le=c),D=Math.max(Math.min(D,z.value-F+T),-T),B=Math.max(Math.min(B,U.value-x+T),-T),D+=ve.value,B+=j.value-2,De(D,B)},Ae=()=>{!W||(W=!1)},Se=()=>{f.value?f.value=!1:(f.value=!0,b.value=!0,h?(me(h),h=null):ae())},Le=()=>{const t=r.value;let c=`image/${["jpeg","jpg"].includes(pe.value)?"jpeg":"png"}`;const p=t.toDataURL(c),F=`imeme_${e.value.title}_${L.value}`,x=document.createElement("a");x.setAttribute("download",F),x.setAttribute("href",p),x.setAttribute("target","_blank"),x.click()},ze=()=>{f.value?o("change",e.value):b.value||(o("create",e.value),f.value=!0,b.value=!0)},Pe=({name:t,base64:s})=>{b.value=!1;const{mid:c,title:p,feature:F,image:x,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q}=e.value;h={mid:c,title:p,feature:F,image:x,x:D,y:B,max:se,font:X,color:Y,align:re,direction:q};const K=t.slice(0,t.lastIndexOf("."));me({mid:`meme_${new Date().getTime()}`,title:K,feature:K,image:s,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down"})},me=t=>{o("replace",t)},Re=()=>{w.value=!0},Ne=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(n*u/2,n*u/2,n*u/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",S.forEach(s=>{const{0:c,1:p,2:F,3:x}=s;t.moveTo(c,p),t.lineTo(F,x)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((n-1)*u/2,(n-1)*u/2,1*u,1*u),t.stroke()},Ve=(t,s)=>{const c=r.value,p=g.value;p.style.left=`${t+V}px`,p.style.top=`${s+V}px`;const F=p.getContext("2d"),x=Math.min(Math.max(0,t-5),c.width-n),D=Math.min(Math.max(0,s-5),c.height-n);F.clearRect(0,0,I,A),F.drawImage(c,x,D,n,n,0,0,I,A),Ne(F)},Ue=async t=>{if(!w.value)return!1;const{offsetX:s,offsetY:c}=t;s<0||c<0||(M.value=!0,Ve(s,c))},je=()=>{if(!w.value)return!1;M.value=!1},We=t=>{const s=D=>D.toString(16).padStart(2,"0"),{0:c,1:p,2:F,3:x}=t.data;return`#${s(c)}${s(p)}${s(F)}${s(x)}`.toUpperCase()},Oe=(t,s)=>{const F=r.value.getContext("2d").getImageData(t,s,1,1);return We(F)},He=t=>{if(!w.value)return!1;const{offsetX:s,offsetY:c}=t;if(s<0||c<0)return;const p=Oe(s,c);e.value.color=p,M.value=!1,w.value=!1};return Ce(()=>{ae()}),(t,s)=>(_(),$("div",jt,[y("div",Wt,[y("div",Ot,O(d(Me)),1),k(d(H),{label:f.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Se},null,8,["label"]),k(d(H),{label:"\u4E0B\u8F7D",u:"primary",onClick:Le})]),!f.value&&b.value?(_(),$("div",Ht,[k(d(Mt),{onChange:Pe})])):(_(),$(ue,{key:1},[y("div",Gt,[y("canvas",{ref:(c,p)=>{p.canvasRef=c,r.value=c},class:Q({"container-canvas":!0,"container-pointer":w.value}),onMousemove:Ue,onMouseleave:je,onClick:He},null,34),we(y("div",{class:"container-area",ref:(c,p)=>{p.areaRef=c,v.value=c},onMousemove:Te,onMouseup:Ae},[y("div",{class:"container-drag",ref:(c,p)=>{p.dragRef=c,m.value=c},onMousedown:Ie},null,544)],544),[[be,!w.value]]),we(y("canvas",{ref:(c,p)=>{p.layerRef=c,g.value=c},class:"container-layer",style:tt({borderRadius:`${n*u}px`}),width:I,height:A},null,4),[[be,w.value&&M.value]])]),k(Nt,{max:d(e).max,color:d(e).color,size:d(j),align:d(e).align,direction:d(e).direction,onChange:Ee,onPick:Re},null,8,["max","color","size","align","direction"])],64)),y("footer",Xt,[k(d(H),{label:f.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:ze},null,8,["label"])])]))}}),ke={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"}},qt=()=>"https://imeme.vercel.app";var Kt=a=>async(o={},l={})=>{const{url:i,method:e}=a,r=qt();return at.request({withCredentials:!1,url:r+i,method:e,[e==="get"?"params":"data"]:o}).then(v=>{const m=v.data;return(l==null?void 0:l.stream)?v:m.errNo===0?m.data:Promise.reject(m)}).catch(v=>Promise.reject(v))};const N={};for(const a in ke)N[a]=Kt(ke[a]);const Jt={class:"image-wrap"},Zt=E({setup(a){const o=C([]),l=C(""),i=C(""),e=C({});let r=C({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down"});const v=async()=>{const n=await N.getCatalog({});o.value=n},m=({type:n,child:u})=>{l.value!==u.mid&&(l.value=u.mid,i.value=n,e.value=u)};ce([l,i],()=>{f(l.value,i.value)});const f=(n,u)=>{N.openImage({mid:n,type:u}).then(I=>{r.value=I})},b=n=>{const u=ye(_e({},n),{image:""});N.saveImage(u)},h=n=>{r.value=n},w=async n=>{const u=await N.createImage(n).catch(I=>{alert(I.message)});await v(),l.value=u.mid},M=C([]);de("commands",M);const g=async()=>{const n=await N.getCommands({});M.value=n};return Ce(()=>{v(),g()}),(n,u)=>(_(),$("div",Jt,[k(gt,{current:l.value,"catalog-list":o.value,onChange:m},null,8,["current","catalog-list"]),d(r).image&&d(r).mid?(_(),J(Yt,{key:0,story:d(r),onChange:b,onReplace:h,onCreate:w},null,8,["story"])):nt("",!0)]))}});const Qt={class:"material-center"},ea=E({setup(a){return(o,l)=>(_(),$("div",Qt," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),ta=[{path:"/",component:Zt},{path:"/center",component:ea}],aa=ot({history:lt(),routes:ta});st(it).use(aa).mount("#app");
