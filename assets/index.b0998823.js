var rt=Object.defineProperty,ut=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var We=(t,a,o)=>a in t?rt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,Le=(t,a)=>{for(var o in a||(a={}))it.call(a,o)&&We(t,o,a[o]);if(je)for(var o of je(a))dt.call(a,o)&&We(t,o,a[o]);return t},Oe=(t,a)=>ut(t,ct(a));import{r as vt,c as ae,o as C,d as U,t as re,a as B,F as ye,b as Pe,u as l,e as k,f as ne,n as me,g as pt,h as gt,i as b,w as ht,j as xe,k as ue,l as N,m as He,p as S,q as ce,s as Ve,v as we,x as $e,y as Ge,z as ft,A as mt,B as Ue,C as _t,D as yt,E as xt}from"./vendor.bb2b12ed.js";const wt=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&e(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}};wt();var Ke=(t,a)=>{const o=t.__vccOpts||t;for(const[e,n]of a)o[e]=n;return o};const $t={};function bt(t,a){const o=vt("router-view");return C(),ae(o)}var Ct=Ke($t,[["render",bt]]);const Ft={class:"side"},kt={class:"side-content-title"},Dt=["onClick"],Mt=U({props:{catalogList:null,current:null},emits:["change"],setup(t,{emit:a}){const e=re(t).catalogList,n=(r,i)=>{a("change",{type:r,child:i})};return(r,i)=>(C(),B("div",Ft,[(C(!0),B(ye,null,Pe(l(e),v=>(C(),B("div",{key:v.id,class:"side-content"},[k("p",kt,ne(v.text),1),(C(!0),B(ye,null,Pe(v.children,w=>(C(),B("div",{key:w.mid,class:me({"side-content-cell":!0,"side-content-cell-active":t.current===w.mid}),onClick:D=>n(v.type,w)},ne(w.title),11,Dt))),128))]))),128))]))}});const le=U({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){return(a,o)=>(C(),B("button",{class:me(["meme-button",{disabled:t.disabled}])},[pt(a.$slots,"default",{},()=>[gt(ne(t.label),1)])],2))}});const Et=U({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:a}){const o=b(null),e=r=>{a("update:modelValue",r.target.value)};return{input:o,blur:r=>{e(r),a("blur")}}}}),Tt=["title","value"];function It(t,a,o,e,n,r){return C(),B("input",{ref:"input",class:me(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:a[0]||(a[0]=(...i)=>t.blur&&t.blur(...i)),onKeyup:a[1]||(a[1]=ht(i=>{var v;return(v=t.input)==null?void 0:v.blur()},["enter"]))},null,42,Tt)}var oe=Ke(Et,[["render",It]]);const Bt=500,St=300;U({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Bt},interval:{type:Number,default:St}},created(){this.showChange(this.show)},setup(t){const{show:a,interval:o,min:e}=re(t),n=b(a.value);let r,i=0;const v=()=>{const M=new Date().getTime()-i;M>e.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(e.value-M,0))},w=D=>{D?o.value===0?(n.value=!0,i=new Date().getTime()):r=window.setTimeout(()=>{n.value=!0,i=new Date().getTime()},o.value):(clearTimeout(r),v())};return xe(a,()=>{w(a.value)}),{localShow:n,showChange:w}}});const Rt={class:"meme-radio"},zt=["name","value","checked"],At={class:"meme-radio-label"},_e=U({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(t,{emit:a}){const o=e=>{a("toggle",e)};return(e,n)=>(C(),B("label",Rt,[k("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=r=>o(t.value))},null,40,zt),k("span",At,ne(t.label),1)]))}});const Lt={class:"meme-file-upload"},Pt={class:"file-button"},Vt=k("i",{class:"file-glyphicon"},null,-1),Ut=k("span",null,"UPLOAD FILE",-1),Nt=k("i",{class:"file-tips"},"Drop files here to upload",-1),Xt=[Nt],Yt=U({emits:["change"],setup(t,{emit:a}){const o=ue("commands"),e=_=>{const $=_.target.files;if(!$)return!1;M($)},n=_=>{_.stopPropagation(),_.preventDefault()},r=_=>{_.stopPropagation(),_.preventDefault()},i=_=>{_.stopPropagation(),_.preventDefault();const $=_.dataTransfer.files;M($)},v=_=>{_.stopPropagation(),_.preventDefault();const $=_.clipboardData.files;M($)},w=1*1024*1024,D=/^image\//,M=_=>{if(_.length!==1)return h("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const $=_[0],{name:g,size:p,type:F}=$;if(!D.test(F))return h(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${F}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const R=g.replace(/\.\w*$/g,"");if(o.value.includes(R))return h(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${g}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${R}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(p>w)return h("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const T=new FileReader;T.onload=L=>{const P=L.target.result;E(g,P)},T.onerror=()=>{h(T.error.message)},T.readAsDataURL($)},h=_=>{alert(_)},E=(_,$)=>{a("change",{name:_,base64:$})};return(_,$)=>(C(),B("div",Lt,[k("div",Pt,[Vt,Ut,k("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:e},null,32)]),k("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:r,onDrop:i,onPaste:v},Xt,32)]))}});const jt=["value","selected"],Wt=U({props:{options:null,selected:null},emits:["change","update:model-value"],setup(t,{emit:a}){const o=e=>{const n=e.target.value;e.target.blur(),a("update:model-value",n),a("change",n)};return(e,n)=>(C(),B("select",{class:"meme-select",onChange:o},[(C(!0),B(ye,null,Pe(t.options,r=>(C(),B("option",{key:r.value,class:"meme-option",value:r.value,selected:t.selected===r.value},ne(r.label),9,jt))),128))],32))}});const Ot={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Ht=k("title",null,"dice",-1),Gt=["fill"],Kt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const o=t,e=N(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),n=()=>{a("click")};return(r,i)=>(C(),ae(l(le),{class:"dice-button",u:"icon",onClick:n},{default:He(()=>[(C(),B("svg",Ot,[Ht,k("path",{fill:l(e),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Gt)]))]),_:1}))}});const qt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Jt=k("title",null,"picker",-1),Zt=["fill"],Qt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const o=t,e=N(()=>["transparent","#FFFFFF"].includes(o.color)?"gray":o.color),n=()=>{a("click")};return(r,i)=>(C(),ae(l(le),{class:"picker-button",u:"icon",onClick:n},{default:He(()=>[(C(),B("svg",qt,[Jt,k("path",{fill:l(e),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Zt)]))]),_:1}))}});const ea={class:"property"},qe=U({props:{max:null,size:null,color:null,align:null,direction:null,blur:null},emits:["change","pick"],setup(t,{emit:a}){const o=t,e=ue("text"),n=ue("updateText"),{max:r,size:i,color:v,align:w,direction:D,blur:M}=re(o),h=($,g)=>{const p={max:r.value,size:i.value,color:v.value,align:w.value,direction:D.value,blur:M.value};p[g]=["color","align","direction"].includes(g)?$:parseInt($),a("change",p)},E=()=>{const $="#"+Math.floor(Math.random()*16777215).toString(16);h($,"color")},_=()=>{a("pick")};return($,g)=>(C(),B("div",ea,[S(l(oe),{class:"property-max",value:l(r),"onUpdate:modelValue":g[0]||(g[0]=p=>h(p,"max"))},null,8,["value"]),S(l(oe),{class:"property-size",value:l(i),"onUpdate:modelValue":g[1]||(g[1]=p=>h(p,"size"))},null,8,["value"]),S(l(oe),{class:"property-color",value:l(v),"onUpdate:modelValue":g[2]||(g[2]=p=>h(p,"color"))},null,8,["value"]),S(Kt,{color:l(v),onClick:E},null,8,["color"]),S(Qt,{color:l(v),onClick:_},null,8,["color"]),S(l(_e),{label:"start",name:"align",value:"start",checked:l(w)==="start",onToggle:g[3]||(g[3]=p=>h(p,"align"))},null,8,["checked"]),S(l(_e),{label:"center",name:"align",value:"center",checked:l(w)==="center",onToggle:g[4]||(g[4]=p=>h(p,"align"))},null,8,["checked"]),S(l(_e),{class:"property-end",label:"end",name:"align",value:"end",checked:l(w)==="end",onToggle:g[5]||(g[5]=p=>h(p,"align"))},null,8,["checked"]),S(l(oe),{class:"property-text",value:l(e),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"]),S(l(_e),{label:"up",name:"direction",value:"up",checked:l(D)==="up",onToggle:g[6]||(g[6]=p=>h(p,"direction"))},null,8,["checked"]),S(l(_e),{label:"down",name:"direction",value:"down",checked:l(D)==="down",onToggle:g[7]||(g[7]=p=>h(p,"direction"))},null,8,["checked"])]))}}),Ne=1.2,X=11,W=14,Je=W*X,Ze=W*X,ie=W*X,Qe=W,ta=(()=>{const t=[];for(let a=1;a<X;a++)t.push([a,0,a,X]),t.push([0,a,X,a]);return t.map(a=>a.map(o=>o*W))})(),aa=(t,a,o)=>{let e=0,n=t.length-1;for(;e<=n;){const r=Math.floor((e+n)/2),i=o.measureText(t.substring(0,r)).width,v=o.measureText(t.substring(0,r+1)).width;if(i<=a&&v>a)return r;i<a?e=r+1:n=r-1}return-1},na=(t,a,o)=>{const e=[];let n=0;for(;(n=aa(t,a,o))!==-1;)e.push(t.substring(0,n)),t=t.substring(n);return t&&e.push(t),e},Xe=(t,a,o,e)=>{const{x:n,y:r,font:i,color:v,align:w,max:D,direction:M,blur:h}=e;t.font=i||"32px sans-serif",t.fillStyle=v||"#000000",h&&(t.filter=`blur(${h}px)`),t.textAlign=w||"center";const E=D||a,_=be(i),$=na(o,E,t);$.forEach((g,p)=>{const F=M==="down"?p:p-($.length-1);t.fillText(g,n,r+F*_*Ne,E)})},la=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(X*W/2,X*W/2,X*W/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",ta.forEach(a=>{const{0:o,1:e,2:n,3:r}=a;t.moveTo(o,e),t.lineTo(n,r)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((X-1)*W/2,(X-1)*W/2,1*W,1*W),t.stroke()},et=(t,a,o,e)=>{a.style.left=`${o+Qe}px`,a.style.top=`${e+Qe}px`;const n=a.getContext("2d"),r=Math.min(Math.max(0,o-5),t.width-X),i=Math.min(Math.max(0,e-5),t.height-X);n.clearRect(0,0,Je,Ze),n.drawImage(t,r,i,X,X,0,0,Je,Ze),la(n)},be=t=>{const a=t.match(/(\d{1,3})px/)||["","32"];return Number(a[1])},tt=t=>{var e;return((e=t.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:e[0])||"png"},at=(t,a,o)=>{const n=`image/${["jpeg","jpg"].includes(a)?"jpeg":"png"}`,r=t.toDataURL(n),i=document.createElement("a");i.setAttribute("download",o),i.setAttribute("href",r),i.setAttribute("target","_blank"),i.click()};const oa={class:"container"},sa={class:"container-header"},ra={class:"container-title"},ua={key:0,class:"container-wall"},ca={class:"container-wraper"},ia=["width","height"],da={class:"container-footer"},va=U({props:{story:null},emits:["change","create","replace"],setup(t,{emit:a}){const e=re(t).story,n=b(null),r=b(null),i=b(null),v=b(!0),w=b(!0);let D=null;const M=b(!1),h=b(!1),E=b(null),_=b("\u91D1\u9986\u957F"),$=d=>{_.value=d,H()};ce("text",_),ce("updateText",$);const g=b(0),p=b(0),F=(d,f)=>{e.value.x=d,e.value.y=f},R=d=>{const{max:f,size:y,color:x,align:j,direction:K,blur:Y}=d;e.value.max=f,e.value.font=`${y}px sans-serif`,e.value.color=x,e.value.align=j,e.value.direction=K,e.value.blur=Y},T=N(()=>be(e.value.font)),L=N(()=>tt(e.value.image)),P=N(()=>`${e.value.title}.${L.value} ${g.value} * ${p.value} (${e.value.x}, ${e.value.y})`),de=N(()=>{const d=e.value.max||g.value;return{start:0,center:Math.floor(d/2),end:d}[e.value.align]}),ee=new Image,ve=()=>{ee.onload=async()=>{const d=n.value;d.width=ee.naturalWidth,d.height=ee.naturalHeight,g.value=d.width,p.value=d.height,se(),H(),pe()},ee.onerror=d=>{console.error(d)},ee.src=e.value.image},se=()=>{const d=r.value;d.style.width=`${g.value}px`,d.style.height=`${p.value}px`},H=()=>{const d=n.value,f=d.getContext("2d");f.drawImage(ee,0,0),Xe(f,d.width,_.value,e.value)},pe=()=>{const{x:d,y:f,max:y}=e.value,x=i.value;x.style.width=`${y}px`,x.style.height=`${T.value*Ne}px`,x.style.top=`${f-T.value+2}px`,x.style.left=`${d-de.value}px`};xe(e,(d,f)=>{d.mid!==f.mid?ve():(H(),pe())},{deep:!0});let ge=0,Z=0;const O=20;let Q=!1;const he=d=>{Q=!0;const{clientX:f,clientY:y}=d;ge=f,Z=y},G=d=>{if(!Q)return;const{clientX:f,clientY:y}=d,x=i.value,{width:j,height:K}=x.getBoundingClientRect();let Y=x.offsetLeft+f-ge,q=x.offsetTop+y-Z;Y<-O||q<-O||Y>g.value-j+O||q>p.value-K+O?Q=!1:(ge=f,Z=y),Y=Math.max(Math.min(Y,g.value-j+O),-O),q=Math.max(Math.min(q,p.value-K+O),-O),Y+=de.value,q+=T.value-2,F(Y,q)},te=()=>{!Q||(Q=!1)},Ce=()=>{v.value?v.value=!1:(v.value=!0,w.value=!0,D?(fe(D),D=null):ve())},Fe=()=>{D&&(fe(D),D=null)},ke=()=>{const d=n.value,f=`imeme_${e.value.title}_${_.value}`;at(d,L.value,f)},De=()=>{v.value?a("change",e.value):w.value||(a("create",e.value,Fe),v.value=!0,w.value=!0)},Me=({name:d,base64:f})=>{w.value=!1;const{mid:y,title:x,feature:j,image:K,x:Y,y:q,max:s,font:u,color:c,align:m,direction:I,senior:A,blur:z}=e.value;D={mid:y,title:x,feature:j,image:K,x:Y,y:q,max:s,font:u,color:c,align:m,direction:I,senior:A,blur:z};const V=d.slice(0,d.lastIndexOf("."));fe({mid:`meme_${new Date().getTime()}`,title:V,feature:V,image:f,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",blur:0,senior:0})},fe=d=>{a("replace",d)},Ee=()=>{M.value=!0},Te=(d,f)=>{const y=n.value,x=E.value;et(y,x,d,f)},Ie=async d=>{if(!M.value)return!1;const{offsetX:f,offsetY:y}=d;f<0||y<0||(h.value=!0,Te(f,y))},Be=()=>{if(!M.value)return!1;h.value=!1},Se=d=>{const f=Y=>Y.toString(16).padStart(2,"0"),{0:y,1:x,2:j,3:K}=d.data;return`#${f(y)}${f(x)}${f(j)}${f(K)}`.toUpperCase()},Re=(d,f)=>{const j=n.value.getContext("2d").getImageData(d,f,1,1);return Se(j)},ze=d=>{if(!M.value)return!1;const{offsetX:f,offsetY:y}=d;if(f<0||y<0)return;const x=Re(f,y);e.value.color=x,h.value=!1,M.value=!1};return Ve(()=>{ve()}),(d,f)=>(C(),B("div",oa,[k("div",sa,[k("div",ra,ne(l(P)),1),S(l(le),{label:v.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Ce},null,8,["label"]),S(l(le),{label:"\u4E0B\u8F7D",u:"primary",onClick:ke})]),!v.value&&w.value?(C(),B("div",ua,[S(l(Yt),{onChange:Me})])):(C(),B(ye,{key:1},[k("div",ca,[k("canvas",{ref:(y,x)=>{x.canvasRef=y,n.value=y},class:me({"container-canvas":!0,"container-pointer":M.value}),onMousemove:Ie,onMouseleave:Be,onClick:ze},null,34),we(k("div",{class:"container-area",ref:(y,x)=>{x.areaRef=y,r.value=y},onMousemove:G,onMouseup:te},[k("div",{class:"container-drag",ref:(y,x)=>{x.dragRef=y,i.value=y},onMousedown:he},null,544)],544),[[$e,!M.value]]),we(k("canvas",{ref:(y,x)=>{x.layerRef=y,E.value=y},class:"container-layer",style:Ge({borderRadius:`${l(ie)}px`}),width:l(ie),height:l(ie)},null,12,ia),[[$e,M.value&&h.value]])]),S(qe,{max:l(e).max,color:l(e).color,size:l(T),align:l(e).align,direction:l(e).direction,blur:l(e).blur,onChange:R,onPick:Ee},null,8,["max","color","size","align","direction","blur"])],64)),k("footer",da,[S(l(le),{label:v.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:De},null,8,["label"])])]))}});const pa={class:"feature-property"},ga=U({props:{width:null,height:null,ipath:null},emits:["change"],setup(t,{emit:a}){const o=t,e=ue("text"),n=ue("updateText"),r=ue("paths"),{width:i,height:v,ipath:w}=re(o),D=(M,h)=>{const E={width:i.value,height:v.value,ipath:w.value};E[h]=["ipath"].includes(h)?M:parseInt(M),a("change",E)};return(M,h)=>(C(),B("div",pa,[S(l(oe),{class:"feature-property-size",value:l(i),"onUpdate:modelValue":h[0]||(h[0]=E=>D(E,"width"))},null,8,["value"]),S(l(oe),{class:"feature-property-size",value:l(v),"onUpdate:modelValue":h[1]||(h[1]=E=>D(E,"height"))},null,8,["value"]),S(l(Wt),{class:"feature-property-path",options:l(r),selected:l(w),"onUpdate:modelValue":h[2]||(h[2]=E=>D(E,"ipath"))},null,8,["options","selected"]),S(l(oe),{class:"feature-property-text",value:l(e),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"])]))}}),nt={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getConfig:{url:"/image/config",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"},saveFeatureImage:{url:"/image/feature/save",method:"post"},getMaterialBase64:{url:"/material/base64",method:"get"}},ha=()=>"https://imeme.vercel.app";var fa=t=>async(a={},o={})=>{const{url:e,method:n}=t,r=ha();return ft.request({withCredentials:!1,url:r+e,method:n,[n==="get"?"params":"data"]:a}).then(i=>{const v=i.data;return(o==null?void 0:o.stream)?i:v.errNo===0?v.data:Promise.reject(v)}).catch(i=>Promise.reject(i))};const J={};for(const t in nt)J[t]=fa(nt[t]);const ma={class:"container"},_a={class:"container-header"},ya={class:"container-title"},xa=["onMousedown"],wa=["width","height"],$a={class:"container-footer"},ba=U({props:{feature:null},emits:["change"],setup(t,{emit:a}){const e=re(t).feature,n=b(null),r=b(null),i=b(null),v=b(!1),w=b(!1),D=b(null),M="\u91D1\u9986\u957F",h=b("\u91D1\u9986\u957F"),E=b(""),_=s=>{h.value=s,p.value?Z():J.getMaterialBase64({ipath:P.value.ipath,value:s}).then(u=>{E.value=u,u?se.src=u:Z()})};ce("text",h),ce("updateText",_);const $=b(0),g=b(0),p=N(()=>e.value.type==="TEXT"),F=N(()=>{var s;return p.value?be((s=e.value.et)==null?void 0:s.font):0}),R=N(()=>tt(e.value.story.image)),T=N(()=>{const s=p.value?L.value:P.value;return`${e.value.story.title}.${R.value} ${$.value} * ${g.value} (${s.x}, ${s.y})`}),L=N(()=>e.value.et),P=N(()=>e.value.ei),de=N(()=>{if(p.value){const s=L.value.max||$.value;return{start:0,center:Math.floor(s/2),end:s}[L.value.align]}return 0}),ee=N(()=>{const{font:s,color:u,direction:c,blur:m}=e.value.story,{x:I,y:A,width:z}=P.value;return{x:I+z/2,y:A+be(s),max:z,font:s,color:u,align:"center",direction:c,blur:m}}),ve=s=>{const{max:u,size:c,color:m,align:I,direction:A,blur:z}=s;e.value.et.max=u,e.value.et.font=`${c}px sans-serif`,e.value.et.color=m,e.value.et.align=I,e.value.et.direction=A,e.value.et.blur=z},se=new Image;se.onerror=s=>{console.error(s)},se.onload=()=>{Z()};const H=new Image,pe=()=>{H.onload=async()=>{const s=n.value;s.width=H.naturalWidth,s.height=H.naturalHeight,$.value=s.width,g.value=s.height,ge(),Z(),O()},H.onerror=s=>{console.error(s)},H.src=e.value.story.image},ge=()=>{const s=r.value;s.style.width=`${$.value}px`,s.style.height=`${g.value}px`},Z=()=>{const s=n.value,u=s.getContext("2d");if(u.drawImage(H,0,0),u.save(),Xe(u,s.width,M,e.value.story),p.value||!p.value&&!E.value){const c=p.value?L.value:ee.value;u.restore(),Xe(u,s.width,h.value,c)}else{const{x:c,y:m,width:I,height:A}=P.value;u.drawImage(se,c,m,I,A)}},O=()=>{let s=0,u=0,c=0,m=0;if(p.value){const{x:A,y:z,max:V}=L.value;s=V,u=F.value*Ne,c=z-F.value+2,m=A-de.value}else{const{x:A,y:z,width:V,height:Ae}=P.value;s=V,u=Ae,c=z,m=A}const I=i.value;I.style.width=`${s}px`,I.style.height=`${u}px`,I.style.top=`${c}px`,I.style.left=`${m}px`};xe(e,(s,u)=>{s.mid!==u.mid?pe():(Z(),O())},{deep:!0});let Q=0,he=0;const G=20;let te=!1;const Ce=s=>{te=!0;const{clientX:u,clientY:c}=s;Q=u,he=c},Fe=s=>{if(!te)return;const{clientX:u,clientY:c}=s,m=i.value,{width:I,height:A}=m.getBoundingClientRect();let z=m.offsetLeft+u-Q,V=m.offsetTop+c-he;z<-G||V<-G||z>$.value-I+G||V>g.value-A+G?te=!1:(Q=u,he=c),z=Math.max(Math.min(z,$.value-I+G),-G),V=Math.max(Math.min(V,g.value-A+G),-G),ke(z,V)},ke=(s,u)=>{p.value?(L.value.x=s+de.value,L.value.y=u+F.value-2):(P.value.x=s,P.value.y=u)},De=()=>{!te||(te=!1)},Me=()=>{const s=n.value,u=`imeme_${e.value.story.title}_${h.value}`;at(s,R.value,u)},fe=()=>{const{mid:s,type:u,et:c,ei:m}=e.value;a("change",{mid:s,type:u,options:p.value?c:m})},Ee=()=>{v.value=!0},Te=(s,u)=>{const c=n.value,m=D.value;et(c,m,s,u)},Ie=async s=>{if(!v.value)return!1;const{offsetX:u,offsetY:c}=s;u<0||c<0||(w.value=!0,Te(u,c))},Be=()=>{if(!v.value)return!1;w.value=!1},Se=s=>{const u=z=>z.toString(16).padStart(2,"0"),{0:c,1:m,2:I,3:A}=s.data;return`#${u(c)}${u(m)}${u(I)}${u(A)}`.toUpperCase()},Re=(s,u)=>{const I=n.value.getContext("2d").getImageData(s,u,1,1);return Se(I)},ze=s=>{if(!v.value)return!1;const{offsetX:u,offsetY:c}=s;if(u<0||c<0)return;const m=Re(u,c);e.value.et.color=m,w.value=!1,v.value=!1},d=b(null);let f=0,y=0,x=!1;const j=s=>{x=!0;const{clientX:u,clientY:c}=s;f=u,y=c},K=s=>{if(!x)return;const{clientX:u,clientY:c}=s,m=r.value,{x:I,y:A,width:z,height:V}=m.getBoundingClientRect();if(u<I||c<A||u>I+z||c>A+V){x=!1;return}const Ae=u-f,lt=c-y,{width:ot,height:st}=P.value,Ye=i.value;Ye.style.width=`${ot+Ae}px`,Ye.style.height=`${st+lt}px`},Y=s=>{if(!x)return;x=!1;const{clientX:u,clientY:c}=s,m=u-f,I=c-y,{width:A,height:z}=P.value;P.value.width=A+m,P.value.height=z+I},q=s=>{const{width:u,height:c,ipath:m}=s;e.value.ei.width=u,e.value.ei.height=c,e.value.ei.ipath=m};return Ve(()=>{pe()}),(s,u)=>(C(),B("div",ma,[k("div",_a,[k("div",ya,ne(l(T)),1),S(l(le),{label:"\u4E0B\u8F7D",u:"primary",onClick:Me})]),k("div",{class:"container-wraper",onMousemove:K,onMouseup:Y},[k("canvas",{ref:(c,m)=>{m.canvasRef=c,n.value=c},class:me({"container-canvas":!0,"container-pointer":v.value}),onMousemove:Ie,onMouseleave:Be,onClick:ze},null,34),we(k("div",{class:"container-area",ref:(c,m)=>{m.areaRef=c,r.value=c},onMousemove:Fe,onMouseup:De},[k("div",{class:"container-drag",ref:(c,m)=>{m.dragRef=c,i.value=c},onMousedown:Ce},[l(p)?Ue("",!0):(C(),B("div",{key:0,ref:(c,m)=>{m.cornerRef=c,d.value=c},class:"container-drag-corner",onMousedown:mt(j,["stop","prevent"])},null,40,xa))],544)],544),[[$e,!v.value]]),we(k("canvas",{ref:(c,m)=>{m.layerRef=c,D.value=c},class:"container-layer",style:Ge({borderRadius:`${l(ie)}px`}),width:l(ie),height:l(ie)},null,12,wa),[[$e,v.value&&w.value]])],32),l(p)?(C(),ae(qe,{key:0,max:l(L).max,color:l(L).color,size:l(F),align:l(L).align,direction:l(L).direction,blur:l(L).blur,onChange:ve,onPick:Ee},null,8,["max","color","size","align","direction","blur"])):(C(),ae(ga,{key:1,width:l(P).width,height:l(P).height,ipath:l(P).ipath,onChange:q},null,8,["width","height","ipath"])),k("footer",$a,[S(l(le),{label:"\u66F4\u65B0",u:"primary",onClick:fe})])]))}});const Ca={class:"image-wrap"},Fa=U({setup(t){const a=b([]),o=b(""),e=b("");let n=b({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",blur:0,senior:0}),r=b({mid:"",feature:"",type:"",story:n});const i=async()=>{const F=await J.getCatalog({});a.value=F},v=({type:F,child:R})=>{o.value!==R.mid&&(o.value=R.mid,e.value=F)};xe([o,e],()=>{w(o.value,e.value)});const w=(F,R)=>{g.value?J.openImage({mid:F,type:R}).then(T=>{n.value=T}):J.getFeatureImage({mid:F}).then(T=>{r.value=T})},D=F=>{const R=Oe(Le({},F),{image:""});J.saveImage(R)},M=F=>{n.value=F},h=async(F,R)=>{const T=await J.createImage(F).catch(L=>{alert(L.message)});T?(await i(),o.value=T.mid):R()},E=b([]),_=b();ce("commands",E),ce("paths",_);const $=async()=>{const{commands:F,paths:R}=await J.getConfig({});E.value=F,_.value=R.map(T=>({label:T,value:T}))},g=N(()=>["STORY","SERIES","SPECIAL"].includes(e.value)),p=({mid:F,type:R,options:T})=>{R==="TEXT"?J.saveImage(T):J.saveFeatureImage(Le({mid:F,type:R},T))};return Ve(()=>{i(),$()}),(F,R)=>(C(),B("div",Ca,[S(Mt,{current:o.value,"catalog-list":a.value,onChange:v},null,8,["current","catalog-list"]),l(g)&&l(n).image&&l(n).mid?(C(),ae(va,{key:0,story:l(n),onChange:D,onReplace:M,onCreate:h},null,8,["story"])):Ue("",!0),e.value==="FEATURE"&&l(r).mid?(C(),ae(ba,{key:1,feature:l(r),onChange:p},null,8,["feature"])):Ue("",!0)]))}});const ka={class:"material-center"},Da=U({setup(t){return(a,o)=>(C(),B("div",ka," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),Ma=[{path:"/",component:Fa},{path:"/center",component:Da}],Ea=_t({history:yt(),routes:Ma});xt(Ct).use(Ea).mount("#app");
