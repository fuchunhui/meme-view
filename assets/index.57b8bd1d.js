var at=Object.defineProperty,nt=Object.defineProperties;var ot=Object.getOwnPropertyDescriptors;var Ve=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,lt=Object.prototype.propertyIsEnumerable;var Ne=(e,a,s)=>a in e?at(e,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[a]=s,Be=(e,a)=>{for(var s in a||(a={}))st.call(a,s)&&Ne(e,s,a[s]);if(Ve)for(var s of Ve(a))lt.call(a,s)&&Ne(e,s,a[s]);return e},Ue=(e,a)=>nt(e,ot(a));import{r as rt,c as Z,o as k,d as V,t as oe,a as B,F as Se,b as Xe,u as l,e as F,f as se,n as ce,g as ut,h as ct,i as b,w as it,j as he,k as ie,l as N,m as Ye,p as E,q as de,s as Re,v as fe,x as me,y as We,z as dt,A as ze,B as vt,C as pt,D as gt,E as ht}from"./vendor.8b6f53e9.js";const ft=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const i of u.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerpolicy&&(u.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?u.credentials="include":n.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function t(n){if(n.ep)return;n.ep=!0;const u=s(n);fetch(n.href,u)}};ft();var je=(e,a)=>{const s=e.__vccOpts||e;for(const[t,n]of a)s[t]=n;return s};const mt={};function _t(e,a){const s=rt("router-view");return k(),Z(s)}var yt=je(mt,[["render",_t]]);const xt={class:"side"},wt={class:"side-content-title"},$t=["onClick"],Ct=V({props:{catalogList:null,current:null},emits:["change"],setup(e,{emit:a}){const t=oe(e).catalogList,n=(u,i)=>{a("change",{type:u,child:i})};return(u,i)=>(k(),B("div",xt,[(k(!0),B(Se,null,Xe(l(t),v=>(k(),B("div",{key:v.id,class:"side-content"},[F("p",wt,se(v.text),1),(k(!0),B(Se,null,Xe(v.children,w=>(k(),B("div",{key:w.mid,class:ce({"side-content-cell":!0,"side-content-cell-active":e.current===w.mid}),onClick:D=>n(v.type,w)},se(w.title),11,$t))),128))]))),128))]))}});const Q=V({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(e){return(a,s)=>(k(),B("button",{class:ce(["meme-button",{disabled:e.disabled}])},[ut(a.$slots,"default",{},()=>[ct(se(e.label),1)])],2))}});const Ft=V({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(e,{emit:a}){const s=b(null),t=u=>{a("update:modelValue",u.target.value)};return{input:s,blur:u=>{t(u),a("blur")}}}}),bt=["title","value"];function kt(e,a,s,t,n,u){return k(),B("input",{ref:"input",class:ce(["meme-input",{disabled:e.disabled}]),title:e.title,value:e.modelValue,onBlur:a[0]||(a[0]=(...i)=>e.blur&&e.blur(...i)),onKeyup:a[1]||(a[1]=it(i=>{var v;return(v=e.input)==null?void 0:v.blur()},["enter"]))},null,42,bt)}var ee=je(Ft,[["render",kt]]);const Dt=500,Mt=300;V({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Dt},interval:{type:Number,default:Mt}},created(){this.showChange(this.show)},setup(e){const{show:a,interval:s,min:t}=oe(e),n=b(a.value);let u,i=0;const v=()=>{const m=new Date().getTime()-i;m>t.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(t.value-m,0))},w=D=>{D?s.value===0?(n.value=!0,i=new Date().getTime()):u=window.setTimeout(()=>{n.value=!0,i=new Date().getTime()},s.value):(clearTimeout(u),v())};return he(a,()=>{w(a.value)}),{localShow:n,showChange:w}}});const Et={class:"meme-radio"},Tt=["name","value","checked"],It={class:"meme-radio-label"},ve=V({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(e,{emit:a}){const s=t=>{a("toggle",t)};return(t,n)=>(k(),B("label",Et,[F("input",{class:"meme-radio-input",type:"radio",name:e.name,value:e.value,checked:e.checked,onChange:n[0]||(n[0]=u=>s(e.value))},null,40,Tt),F("span",It,se(e.label),1)]))}});const Bt={class:"meme-file-upload"},St={class:"file-button"},Rt=F("i",{class:"file-glyphicon"},null,-1),zt=F("span",null,"UPLOAD FILE",-1),At=F("i",{class:"file-tips"},"Drop files here to upload",-1),Lt=[At],Pt=V({emits:["change"],setup(e,{emit:a}){const s=ie("commands"),t=g=>{const p=g.target.files;if(!p)return!1;m(p)},n=g=>{g.stopPropagation(),g.preventDefault()},u=g=>{g.stopPropagation(),g.preventDefault()},i=g=>{g.stopPropagation(),g.preventDefault();const p=g.dataTransfer.files;m(p)},v=g=>{g.stopPropagation(),g.preventDefault();const p=g.clipboardData.files;m(p)},w=1*1024*1024,D=/^image\//,m=g=>{if(g.length!==1)return C("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const p=g[0],{name:h,size:x,type:M}=p;if(!D.test(M))return C(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${M}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const L=h.replace(/\.\w*$/g,"");if(s.value.includes(L))return C(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${h}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${L}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(x>w)return C("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const T=new FileReader;T.onload=A=>{const te=A.target.result;U(h,te)},T.onerror=()=>{C(T.error.message)},T.readAsDataURL(p)},C=g=>{alert(g)},U=(g,p)=>{a("change",{name:g,base64:p})};return(g,p)=>(k(),B("div",Bt,[F("div",St,[Rt,zt,F("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:t},null,32)]),F("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:u,onDrop:i,onPaste:v},Lt,32)]))}});const Vt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Nt=F("title",null,"dice",-1),Ut=["fill"],Xt=V({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:a}){const s=e,t=N(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),n=()=>{a("click")};return(u,i)=>(k(),Z(l(Q),{class:"dice-button",u:"icon",onClick:n},{default:Ye(()=>[(k(),B("svg",Vt,[Nt,F("path",{fill:l(t),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Ut)]))]),_:1}))}});const Yt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Wt=F("title",null,"picker",-1),jt=["fill"],Ot=V({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(e,{emit:a}){const s=e,t=N(()=>["transparent","#FFFFFF"].includes(s.color)?"gray":s.color),n=()=>{a("click")};return(u,i)=>(k(),Z(l(Q),{class:"picker-button",u:"icon",onClick:n},{default:Ye(()=>[(k(),B("svg",Yt,[Wt,F("path",{fill:l(t),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,jt)]))]),_:1}))}});const Ht={class:"property"},Oe=V({props:{max:null,size:null,color:null,align:null,direction:null},emits:["change","pick"],setup(e,{emit:a}){const s=e,t=ie("text"),n=ie("updateText"),{max:u,size:i,color:v,align:w,direction:D}=oe(s),m=(g,p)=>{const h={max:u.value,size:i.value,color:v.value,align:w.value,direction:D.value};h[p]=["color","align","direction"].includes(p)?g:parseInt(g),a("change",h)},C=()=>{const g="#"+Math.floor(Math.random()*16777215).toString(16);m(g,"color")},U=()=>{a("pick")};return(g,p)=>(k(),B("div",Ht,[E(l(ee),{class:"property-max",value:l(u),"onUpdate:modelValue":p[0]||(p[0]=h=>m(h,"max"))},null,8,["value"]),E(l(ee),{class:"property-size",value:l(i),"onUpdate:modelValue":p[1]||(p[1]=h=>m(h,"size"))},null,8,["value"]),E(l(ee),{class:"property-color",value:l(v),"onUpdate:modelValue":p[2]||(p[2]=h=>m(h,"color"))},null,8,["value"]),E(Xt,{color:l(v),onClick:C},null,8,["color"]),E(Ot,{color:l(v),onClick:U},null,8,["color"]),E(l(ve),{label:"start",name:"align",value:"start",checked:l(w)==="start",onToggle:p[3]||(p[3]=h=>m(h,"align"))},null,8,["checked"]),E(l(ve),{label:"center",name:"align",value:"center",checked:l(w)==="center",onToggle:p[4]||(p[4]=h=>m(h,"align"))},null,8,["checked"]),E(l(ve),{class:"property-end",label:"end",name:"align",value:"end",checked:l(w)==="end",onToggle:p[5]||(p[5]=h=>m(h,"align"))},null,8,["checked"]),E(l(ee),{class:"property-text",value:l(t),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"]),E(l(ve),{label:"up",name:"direction",value:"up",checked:l(D)==="up",onToggle:p[6]||(p[6]=h=>m(h,"direction"))},null,8,["checked"]),E(l(ve),{label:"down",name:"direction",value:"down",checked:l(D)==="down",onToggle:p[7]||(p[7]=h=>m(h,"direction"))},null,8,["checked"])]))}}),Ae=1.2,P=11,j=14,He=j*P,Ge=j*P,le=j*P,Ke=j,Gt=(()=>{const e=[];for(let a=1;a<P;a++)e.push([a,0,a,P]),e.push([0,a,P,a]);return e.map(a=>a.map(s=>s*j))})(),Kt=(e,a,s)=>{let t=0,n=e.length-1;for(;t<=n;){const u=Math.floor((t+n)/2),i=s.measureText(e.substring(0,u)).width,v=s.measureText(e.substring(0,u+1)).width;if(i<=a&&v>a)return u;i<a?t=u+1:n=u-1}return-1},qt=(e,a,s)=>{const t=[];let n=0;for(;(n=Kt(e,a,s))!==-1;)t.push(e.substring(0,n)),e=e.substring(n);return e&&t.push(e),t},Le=(e,a,s,t)=>{const{x:n,y:u,font:i,color:v,align:w,max:D,direction:m}=t;e.font=i||"32px sans-serif",e.fillStyle=v||"#000000",e.textAlign=w||"center";const C=D||a,U=i.match(/(\d{1,3})px/)||["","32"],g=Number(U[1]),p=qt(s,C,e);p.forEach((h,x)=>{const M=m==="down"?x:x-(p.length-1);e.fillText(h,n,u+M*g*Ae,C)})},Jt=e=>{e.imageSmoothingEnabled=!1,e.lineCap="round",e.beginPath(),e.strokeStyle="#000000",e.arc(P*j/2,P*j/2,P*j/2-1,0,Math.PI*2),e.stroke(),e.clip(),e.strokeStyle="#D6D6D6",Gt.forEach(a=>{const{0:s,1:t,2:n,3:u}=a;e.moveTo(s,t),e.lineTo(n,u)}),e.stroke(),e.beginPath(),e.strokeStyle="#FF0000",e.rect((P-1)*j/2,(P-1)*j/2,1*j,1*j),e.stroke()},qe=(e,a,s,t)=>{a.style.left=`${s+Ke}px`,a.style.top=`${t+Ke}px`;const n=a.getContext("2d"),u=Math.min(Math.max(0,s-5),e.width-P),i=Math.min(Math.max(0,t-5),e.height-P);n.clearRect(0,0,He,Ge),n.drawImage(e,u,i,P,P,0,0,He,Ge),Jt(n)},Je=(e,a,s)=>{const n=`image/${["jpeg","jpg"].includes(a)?"jpeg":"png"}`,u=e.toDataURL(n),i=document.createElement("a");i.setAttribute("download",s),i.setAttribute("href",u),i.setAttribute("target","_blank"),i.click()};const Zt={class:"container"},Qt={class:"container-header"},ea={class:"container-title"},ta={key:0,class:"container-wall"},aa={class:"container-wraper"},na=["width","height"],oa={class:"container-footer"},sa=V({props:{story:null},emits:["change","create","replace"],setup(e,{emit:a}){const t=oe(e).story,n=b(null),u=b(null),i=b(null),v=b(!0),w=b(!0);let D=null;const m=b(!1),C=b(!1),U=b(null),g=b("\u91D1\u9986\u957F"),p=c=>{g.value=c,K()};de("text",g),de("updateText",p);const h=b(0),x=b(0),M=(c,f)=>{t.value.x=c,t.value.y=f},L=c=>{const{max:f,size:y,color:$,align:W,direction:H}=c;t.value.max=f,t.value.font=`${y}px sans-serif`,t.value.color=$,t.value.align=W,t.value.direction=H},T=N(()=>{const c=t.value.font.match(/(\d{1,3})px/)||["","32"];return Number(c[1])}),A=N(()=>{var $;return(($=t.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:$[0])||"png"}),te=N(()=>`${t.value.title}.${A.value} ${h.value} * ${x.value} (${t.value.x}, ${t.value.y})`),pe=N(()=>{const c=t.value.max||h.value;return{start:0,center:Math.floor(c/2),end:c}[t.value.align]}),X=new Image,ae=()=>{X.onload=async()=>{const c=n.value;c.width=X.naturalWidth,c.height=X.naturalHeight,h.value=c.width,x.value=c.height,_e(),K(),re()},X.onerror=c=>{console.error(c)},X.src=t.value.image},_e=()=>{const c=u.value;c.style.width=`${h.value}px`,c.style.height=`${x.value}px`},K=()=>{const c=n.value,f=c.getContext("2d");f.drawImage(X,0,0),Le(f,c.width,g.value,t.value)},re=()=>{const{x:c,y:f,max:y}=t.value,$=i.value;$.style.width=`${y}px`,$.style.height=`${T.value*Ae}px`,$.style.top=`${f-T.value+2}px`,$.style.left=`${c-pe.value}px`};he(t,(c,f)=>{c.mid!==f.mid?ae():(K(),re())},{deep:!0});let q=0,J=0;const S=20;let O=!1;const ye=c=>{O=!0;const{clientX:f,clientY:y}=c;q=f,J=y},xe=c=>{if(!O)return;const{clientX:f,clientY:y}=c,$=i.value,{width:W,height:H}=$.getBoundingClientRect();let o=$.offsetLeft+f-q,r=$.offsetTop+y-J;o<-S||r<-S||o>h.value-W+S||r>x.value-H+S?O=!1:(q=f,J=y),o=Math.max(Math.min(o,h.value-W+S),-S),r=Math.max(Math.min(r,x.value-H+S),-S),o+=pe.value,r+=T.value-2,M(o,r)},we=()=>{!O||(O=!1)},$e=()=>{v.value?v.value=!1:(v.value=!0,w.value=!0,D?(ge(D),D=null):ae())},Ce=()=>{const c=n.value,f=`imeme_${t.value.title}_${g.value}`;Je(c,A.value,f)},Fe=()=>{v.value?a("change",t.value):w.value||(a("create",t.value),v.value=!0,w.value=!0)},be=({name:c,base64:f})=>{w.value=!1;const{mid:y,title:$,feature:W,image:H,x:o,y:r,max:d,font:_,color:I,align:R,direction:z,senior:Y}=t.value;D={mid:y,title:$,feature:W,image:H,x:o,y:r,max:d,font:_,color:I,align:R,direction:z,senior:Y};const ne=c.slice(0,c.lastIndexOf("."));ge({mid:`meme_${new Date().getTime()}`,title:ne,feature:ne,image:f,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",senior:0})},ge=c=>{a("replace",c)},ke=()=>{m.value=!0},De=(c,f)=>{const y=n.value,$=U.value;qe(y,$,c,f)},Me=async c=>{if(!m.value)return!1;const{offsetX:f,offsetY:y}=c;f<0||y<0||(C.value=!0,De(f,y))},Ee=()=>{if(!m.value)return!1;C.value=!1},Te=c=>{const f=o=>o.toString(16).padStart(2,"0"),{0:y,1:$,2:W,3:H}=c.data;return`#${f(y)}${f($)}${f(W)}${f(H)}`.toUpperCase()},Ie=(c,f)=>{const W=n.value.getContext("2d").getImageData(c,f,1,1);return Te(W)},ue=c=>{if(!m.value)return!1;const{offsetX:f,offsetY:y}=c;if(f<0||y<0)return;const $=Ie(f,y);t.value.color=$,C.value=!1,m.value=!1};return Re(()=>{ae()}),(c,f)=>(k(),B("div",Zt,[F("div",Qt,[F("div",ea,se(l(te)),1),E(l(Q),{label:v.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:$e},null,8,["label"]),E(l(Q),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ce})]),!v.value&&w.value?(k(),B("div",ta,[E(l(Pt),{onChange:be})])):(k(),B(Se,{key:1},[F("div",aa,[F("canvas",{ref:(y,$)=>{$.canvasRef=y,n.value=y},class:ce({"container-canvas":!0,"container-pointer":m.value}),onMousemove:Me,onMouseleave:Ee,onClick:ue},null,34),fe(F("div",{class:"container-area",ref:(y,$)=>{$.areaRef=y,u.value=y},onMousemove:xe,onMouseup:we},[F("div",{class:"container-drag",ref:(y,$)=>{$.dragRef=y,i.value=y},onMousedown:ye},null,544)],544),[[me,!m.value]]),fe(F("canvas",{ref:(y,$)=>{$.layerRef=y,U.value=y},class:"container-layer",style:We({borderRadius:`${l(le)}px`}),width:l(le),height:l(le)},null,12,na),[[me,m.value&&C.value]])]),E(Oe,{max:l(t).max,color:l(t).color,size:l(T),align:l(t).align,direction:l(t).direction,onChange:L,onPick:ke},null,8,["max","color","size","align","direction"])],64)),F("footer",oa,[E(l(Q),{label:v.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:Fe},null,8,["label"])])]))}});const la={class:"feature-property"},ra=V({props:{width:null,height:null,ipath:null},emits:["change"],setup(e,{emit:a}){const s=e,t=ie("text"),n=ie("updateText"),{width:u,height:i,ipath:v}=oe(s),w=(D,m)=>{const C={width:u.value,height:i.value,ipath:v.value};C[m]=["ipath"].includes(m)?D:parseInt(D),a("change",C)};return(D,m)=>(k(),B("div",la,[E(l(ee),{class:"property-size",value:l(u),"onUpdate:modelValue":m[0]||(m[0]=C=>w(C,"width"))},null,8,["value"]),E(l(ee),{class:"property-size",value:l(i),"onUpdate:modelValue":m[1]||(m[1]=C=>w(C,"height"))},null,8,["value"]),E(l(ee),{class:"property-text",value:l(t),"onUpdate:modelValue":l(n)},null,8,["value","onUpdate:modelValue"])]))}});const ua={class:"container"},ca={class:"container-header"},ia={class:"container-title"},da=["onMousedown"],va=["width","height"],pa={class:"container-footer"},ga=V({props:{feature:null},emits:["change"],setup(e,{emit:a}){const t=oe(e).feature,n=b(null),u=b(null),i=b(null),v=b(!1),w=b(!1),D=b(null),m="\u91D1\u9986\u957F",C=b("\u91D1\u9986\u957F"),U=o=>{C.value=o,K()};de("text",C),de("updateText",U);const g=b(0),p=b(0),h=N(()=>t.value.type==="TEXT"),x=N(()=>{var o;if(h.value){const r=((o=t.value.et)==null?void 0:o.font.match(/(\d{1,3})px/))||["","32"];return Number(r[1])}return 0}),M=N(()=>{var _;return((_=t.value.story.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:_[0])||"png"}),L=N(()=>{const o=h.value?T.value:A.value;return`${t.value.story.title}.${M.value} ${g.value} * ${p.value} (${o.x}, ${o.y})`}),T=N(()=>t.value.et),A=N(()=>t.value.ei),te=N(()=>{if(h.value){const o=T.value.max||g.value;return{start:0,center:Math.floor(o/2),end:o}[T.value.align]}return 0}),pe=o=>{const{max:r,size:d,color:_,align:I,direction:R}=o;t.value.et.max=r,t.value.et.font=`${d}px sans-serif`,t.value.et.color=_,t.value.et.align=I,t.value.et.direction=R},X=new Image,ae=()=>{X.onload=async()=>{const o=n.value;o.width=X.naturalWidth,o.height=X.naturalHeight,g.value=o.width,p.value=o.height,_e(),K(),re()},X.onerror=o=>{console.error(o)},X.src=t.value.story.image},_e=()=>{const o=u.value;o.style.width=`${g.value}px`,o.style.height=`${p.value}px`},K=()=>{const o=n.value,r=o.getContext("2d");r.drawImage(X,0,0),r.save(),Le(r,o.width,m,t.value.story),h.value&&(r.restore(),Le(r,o.width,C.value,T.value))},re=()=>{let o=0,r=0,d=0,_=0;if(h.value){const{x:R,y:z,max:Y}=T.value;o=Y,r=x.value*Ae,d=z-x.value+2,_=R-te.value}else{const{x:R,y:z,width:Y,height:ne}=A.value;o=Y,r=ne,d=z,_=R}const I=i.value;I.style.width=`${o}px`,I.style.height=`${r}px`,I.style.top=`${d}px`,I.style.left=`${_}px`};he(t,(o,r)=>{o.mid!==r.mid?ae():(K(),re())},{deep:!0});let q=0,J=0;const S=20;let O=!1;const ye=o=>{O=!0;const{clientX:r,clientY:d}=o;q=r,J=d},xe=o=>{if(!O)return;const{clientX:r,clientY:d}=o,_=i.value,{width:I,height:R}=_.getBoundingClientRect();let z=_.offsetLeft+r-q,Y=_.offsetTop+d-J;z<-S||Y<-S||z>g.value-I+S||Y>p.value-R+S?O=!1:(q=r,J=d),z=Math.max(Math.min(z,g.value-I+S),-S),Y=Math.max(Math.min(Y,p.value-R+S),-S),we(z,Y)},we=(o,r)=>{h.value?(T.value.x=o+te.value,T.value.y=r+x.value-2):(A.value.x=o,A.value.y=r)},$e=()=>{!O||(O=!1)},Ce=()=>{const o=n.value,r=`imeme_${t.value.story.title}_${C.value}`;Je(o,M.value,r)},Fe=()=>{const{mid:o,type:r,et:d,ei:_}=t.value;a("change",{mid:o,type:r,options:h.value?d:_})},be=()=>{v.value=!0},ge=(o,r)=>{const d=n.value,_=D.value;qe(d,_,o,r)},ke=async o=>{if(!v.value)return!1;const{offsetX:r,offsetY:d}=o;r<0||d<0||(w.value=!0,ge(r,d))},De=()=>{if(!v.value)return!1;w.value=!1},Me=o=>{const r=z=>z.toString(16).padStart(2,"0"),{0:d,1:_,2:I,3:R}=o.data;return`#${r(d)}${r(_)}${r(I)}${r(R)}`.toUpperCase()},Ee=(o,r)=>{const I=n.value.getContext("2d").getImageData(o,r,1,1);return Me(I)},Te=o=>{if(!v.value)return!1;const{offsetX:r,offsetY:d}=o;if(r<0||d<0)return;const _=Ee(r,d);t.value.et.color=_,w.value=!1,v.value=!1},Ie=b(null);let ue=0,c=0,f=!1;const y=o=>{f=!0;const{clientX:r,clientY:d}=o;ue=r,c=d},$=o=>{if(!f)return;const{clientX:r,clientY:d}=o,_=u.value,{x:I,y:R,width:z,height:Y}=_.getBoundingClientRect();if(r<I||d<R||r>I+z||d>R+Y){f=!1;return}const ne=r-ue,Qe=d-c,{width:et,height:tt}=A.value,Pe=i.value;Pe.style.width=`${et+ne}px`,Pe.style.height=`${tt+Qe}px`},W=o=>{if(!f)return;f=!1;const{clientX:r,clientY:d}=o,_=r-ue,I=d-c,{width:R,height:z}=A.value;A.value.width=R+_,A.value.height=z+I},H=o=>{const{width:r,height:d,ipath:_}=o;t.value.ei.width=r,t.value.ei.height=d,t.value.ei.ipath=_};return Re(()=>{ae()}),(o,r)=>(k(),B("div",ua,[F("div",ca,[F("div",ia,se(l(L)),1),E(l(Q),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ce})]),F("div",{class:"container-wraper",onMousemove:$,onMouseup:W},[F("canvas",{ref:(d,_)=>{_.canvasRef=d,n.value=d},class:ce({"container-canvas":!0,"container-pointer":v.value}),onMousemove:ke,onMouseleave:De,onClick:Te},null,34),fe(F("div",{class:"container-area",ref:(d,_)=>{_.areaRef=d,u.value=d},onMousemove:xe,onMouseup:$e},[F("div",{class:"container-drag",ref:(d,_)=>{_.dragRef=d,i.value=d},onMousedown:ye},[l(h)?ze("",!0):(k(),B("div",{key:0,ref:(d,_)=>{_.cornerRef=d,Ie.value=d},class:"container-drag-corner",onMousedown:dt(y,["stop","prevent"])},null,40,da))],544)],544),[[me,!v.value]]),fe(F("canvas",{ref:(d,_)=>{_.layerRef=d,D.value=d},class:"container-layer",style:We({borderRadius:`${l(le)}px`}),width:l(le),height:l(le)},null,12,va),[[me,v.value&&w.value]])],32),l(h)?(k(),Z(Oe,{key:0,max:l(T).max,color:l(T).color,size:l(x),align:l(T).align,direction:l(T).direction,onChange:pe,onPick:be},null,8,["max","color","size","align","direction"])):(k(),Z(ra,{key:1,width:l(A).width,height:l(A).height,ipath:l(A).ipath,onChange:H},null,8,["width","height","ipath"])),F("footer",pa,[E(l(Q),{label:"\u66F4\u65B0",u:"primary",onClick:Fe})])]))}}),Ze={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getCommands:{url:"/image/commands",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"},saveFeatureImage:{url:"/image/feature/save",method:"post"}},ha=()=>"https://imeme.vercel.app";var fa=e=>async(a={},s={})=>{const{url:t,method:n}=e,u=ha();return vt.request({withCredentials:!1,url:u+t,method:n,[n==="get"?"params":"data"]:a}).then(i=>{const v=i.data;return(s==null?void 0:s.stream)?i:v.errNo===0?v.data:Promise.reject(v)}).catch(i=>Promise.reject(i))};const G={};for(const e in Ze)G[e]=fa(Ze[e]);const ma={class:"image-wrap"},_a=V({setup(e){const a=b([]),s=b(""),t=b("");let n=b({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",senior:0}),u=b({mid:"",feature:"",type:"",story:n});const i=async()=>{const x=await G.getCatalog({});a.value=x},v=({type:x,child:M})=>{s.value!==M.mid&&(s.value=M.mid,t.value=x)};he([s,t],()=>{w(s.value,t.value)});const w=(x,M)=>{p.value?G.openImage({mid:x,type:M}).then(L=>{n.value=L}):G.getFeatureImage({mid:x}).then(L=>{u.value=L})},D=x=>{const M=Ue(Be({},x),{image:""});G.saveImage(M)},m=x=>{n.value=x},C=async x=>{const M=await G.createImage(x).catch(L=>{alert(L.message)});await i(),s.value=M.mid},U=b([]);de("commands",U);const g=async()=>{const x=await G.getCommands({});U.value=x},p=N(()=>["STORY","SERIES","SPECIAL"].includes(t.value)),h=({mid:x,type:M,options:L})=>{M==="TEXT"?G.saveImage(L):G.saveFeatureImage(Be({mid:x,type:M},L))};return Re(()=>{i(),g()}),(x,M)=>(k(),B("div",ma,[E(Ct,{current:s.value,"catalog-list":a.value,onChange:v},null,8,["current","catalog-list"]),l(p)&&l(n).image&&l(n).mid?(k(),Z(sa,{key:0,story:l(n),onChange:D,onReplace:m,onCreate:C},null,8,["story"])):ze("",!0),t.value==="FEATURE"&&l(u).mid?(k(),Z(ga,{key:1,feature:l(u),onChange:h},null,8,["feature"])):ze("",!0)]))}});const ya={class:"material-center"},xa=V({setup(e){return(a,s)=>(k(),B("div",ya," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),wa=[{path:"/",component:_a},{path:"/center",component:xa}],$a=pt({history:gt(),routes:wa});ht(yt).use($a).mount("#app");
