var $e=Object.defineProperty,Ce=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var ae=(a,t,s)=>t in a?$e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,K=(a,t)=>{for(var s in t||(t={}))we.call(t,s)&&ae(a,s,t[s]);if(te)for(var s of te(t))De.call(t,s)&&ae(a,s,t[s]);return a},ne=(a,t)=>Ce(a,Fe(t));import{d as B,t as M,o as h,c as $,F as W,r as le,u as d,a as y,b as V,n as X,e as C,w as ke,f as Y,i as se,g as H,h as F,p as oe,j as re,k as Be,l as ue,m as Ee,q as Ie}from"./vendor.dc539dd1.js";const Le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerpolicy&&(r.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?r.credentials="include":l.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(l){if(l.ep)return;l.ep=!0;const r=s(l);fetch(l.href,r)}};Le();const Ae={class:"side"},Te={class:"side-content-title"},Me=["onClick"],Ve=B({props:{catalogList:null,current:null},emits:["change"],setup(a,{emit:t}){const n=M(a).catalogList,l=(r,i)=>{t("change",K({type:r},i))};return(r,i)=>(h(),$("div",Ae,[(h(!0),$(W,null,le(d(n),c=>(h(),$("div",{key:c.id,class:"side-content"},[y("p",Te,V(c.text),1),(h(!0),$(W,null,le(c.children,_=>(h(),$("div",{key:_.mid,class:X({"side-content-cell":!0,"side-content-cell-active":a.current===_.mid}),onClick:x=>l(c.type,_)},V(_.title),11,Me))),128))]))),128))]))}});var ie=(a,t)=>{for(const[s,n]of t)a[s]=n;return a};const Pe=B({name:"Button",props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(a){const{label:t}=M(a);return{localLabel:t}}});function ze(a,t,s,n,l,r){return h(),$("button",{class:X(["meme-button",{disabled:a.disabled}])},V(a.localLabel),3)}var J=ie(Pe,[["render",ze]]);const Ne=B({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(a,{emit:t}){const s=C(null),n=r=>{t("update:modelValue",r.target.value)};return{input:s,blur:r=>{n(r),t("blur")}}}}),Re=["title","value"];function Se(a,t,s,n,l,r){return h(),$("input",{ref:"input",class:X(["meme-input",{disabled:a.disabled}]),title:a.title,value:a.modelValue,onBlur:t[0]||(t[0]=(...i)=>a.blur&&a.blur(...i)),onKeyup:t[1]||(t[1]=ke(i=>{var c;return(c=a.input)==null?void 0:c.blur()},["enter"]))},null,42,Re)}var N=ie(Ne,[["render",Se]]);const je=500,Ue=300;B({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:je},interval:{type:Number,default:Ue}},created(){this.showChange(this.show)},setup(a){const{show:t,interval:s,min:n}=M(a),l=C(t.value);let r,i=0;const c=()=>{const v=new Date().getTime()-i;v>n.value?l.value=!1:setTimeout(()=>{l.value=!1},Math.max(n.value-v,0))},_=x=>{x?s.value===0?(l.value=!0,i=new Date().getTime()):r=window.setTimeout(()=>{l.value=!0,i=new Date().getTime()},s.value):(clearTimeout(r),c())};return Y(t,()=>{_(t.value)}),{localShow:l,showChange:_}}});const Oe={class:"meme-radio"},qe=["name","value","checked"],Ge={class:"meme-radio-label"},ce=B({props:{label:null,name:null,value:null,checked:null},emits:["toggle"],setup(a,{emit:t}){const s=n=>{t("toggle",n)};return(n,l)=>(h(),$("label",Oe,[y("input",{class:"meme-radio-input",type:"radio",name:a.name,value:a.value,checked:a.checked,onChange:l[0]||(l[0]=r=>s(a.value))},null,40,qe),y("span",Ge,V(a.label),1)]))}});const Ke={class:"meme-file-upload"},We={class:"file-button"},Xe=y("i",{class:"file-glyphicon"},null,-1),Ye=y("span",null,"UPLOAD FILE",-1),He=y("i",{class:"file-tips"},"Drop files here to upload",-1),Je=[He],Ze=B({emits:["change"],setup(a,{emit:t}){const s=e=>{const u=e.target.files;if(!u)return!1;x(u)},n=e=>{e.stopPropagation(),e.preventDefault()},l=e=>{e.stopPropagation(),e.preventDefault()},r=e=>{e.stopPropagation(),e.preventDefault();const u=e.dataTransfer.files;x(u)},i=e=>{e.stopPropagation(),e.preventDefault();const u=e.clipboardData.files;x(u)},c=2*1024*1024,_=/^image\//,x=e=>{if(e.length!==1)return v("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const u=e[0],{name:R,size:S,type:L}=u;if(!_.test(L))return v(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${L}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;if(S>c)return v("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52362M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const A=new FileReader;A.onload=E=>{const z=E.target.result;f(R,z)},A.onerror=()=>{v(A.error.message)},A.readAsDataURL(u)},v=e=>{alert(e)},f=(e,u)=>{t("change",{name:e,base64:u})};return(e,u)=>(h(),$("div",Ke,[y("div",We,[Xe,Ye,y("input",{class:"file-input",type:"file",name:"file",accept:"image/*",onChange:s},null,32)]),y("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:l,onDrop:r,onPaste:i},Je,32)]))}});const Qe={class:"property"},et=B({props:{max:null,size:null,color:null,align:null},emits:["change"],setup(a,{emit:t}){const s=a,n=se("text"),l=se("updateText"),{max:r,size:i,color:c,align:_}=M(s),x=H(()=>_.value==="start"),v=(f,e)=>{const u={max:r.value,size:i.value,color:c.value,align:_.value};u[e]=["color","align"].includes(e)?f:parseInt(f),t("change",u)};return(f,e)=>(h(),$("div",Qe,[F(d(N),{class:"property-max",value:d(r),"onUpdate:modelValue":e[0]||(e[0]=u=>v(u,"max"))},null,8,["value"]),F(d(N),{class:"property-size",value:d(i),"onUpdate:modelValue":e[1]||(e[1]=u=>v(u,"size"))},null,8,["value"]),F(d(N),{class:"property-color",value:d(c),"onUpdate:modelValue":e[2]||(e[2]=u=>v(u,"color"))},null,8,["value"]),F(d(ce),{label:"start",name:"align",value:"start",checked:d(x),onToggle:e[3]||(e[3]=u=>v(u,"align"))},null,8,["checked"]),F(d(ce),{label:"end",name:"align",value:"end",checked:!d(x),onToggle:e[4]||(e[4]=u=>v(u,"align"))},null,8,["checked"]),F(d(N),{class:"property-text",value:d(n),"onUpdate:modelValue":d(l)},null,8,["value","onUpdate:modelValue"])]))}});const tt={class:"container"},at={class:"container-header"},nt={class:"container-title"},lt={key:0,class:"container-wall"},st={class:"container-wraper"},ot={class:"container-footer"},rt=B({props:{story:null},emits:["change","create","replace"],setup(a,{emit:t}){const n=M(a).story,l=C(null),r=C(null),i=C(null),c=C(!0),_=C(!0);let x=null;const v=C("\u91D1\u9986\u957F"),f=o=>{v.value=o,j()};oe("text",v),oe("updateText",f);const e=C(0),u=C(0),R=(o,g)=>{n.value.x=o,n.value.y=g},S=o=>{const{max:g,size:p,color:m,align:b}=o;n.value.max=g,n.value.font=`${p}px sans-serif`,n.value.color=m,n.value.align=b},L=H(()=>{const o=n.value.font.match(/(\d{1,3})px/)||["","32"];return Number(o[1])*1}),A=H(()=>{var m;return((m=n.value.image.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:m[0])||"png"}),E=new Image,z=()=>{E.onload=async()=>{const o=l.value;o.width=E.naturalWidth,o.height=E.naturalHeight,e.value=o.width,u.value=o.height,pe(),j(),Z()},E.onerror=o=>{console.error(o)},E.src=n.value.image},pe=()=>{const o=r.value;o.style.width=`${e.value}px`,o.style.height=`${u.value}px`},j=()=>{const o=l.value,g=o.getContext("2d");g.drawImage(E,0,0);const{x:p,y:m,font:b,color:w,align:D,max:k}=n.value;g.font=b,g.fillStyle=w,g.textAlign=D,g.fillText(v.value,p,m,k||o.width)},Z=()=>{const{x:o,y:g,max:p,align:m}=n.value,b=i.value;b.style.width=`${p}px`,b.style.height=`${L.value}px`,b.style.top=`${g-L.value+2}px`,b.style.left=m==="start"?`${o}px`:`${o-p}px`};Y(n,(o,g)=>{o.mid!==g.mid?z():(j(),Z())},{deep:!0});let U=0,O=0;const I=20;let T=!1;const ge=o=>{T=!0;const{clientX:g,clientY:p}=o;U=g,O=p},me=o=>{if(!T)return;const{clientX:g,clientY:p}=o,m=i.value,{width:b,height:w}=m.getBoundingClientRect();let D=m.offsetLeft+g-U,k=m.offsetTop+p-O;D<-I||k<-I||D>e.value-b+I||k>u.value-w+I?T=!1:(U=g,O=p),D=Math.max(Math.min(D,e.value-b+I),-I),k=Math.max(Math.min(k,u.value-w+I),-I);const{align:q,max:G}=n.value;D+=q==="end"?G:0,k+=L.value-2,R(D,k)},ve=()=>{!T||(T=!1)},fe=()=>{c.value?c.value=!1:(c.value=!0,_.value=!0,Q(x))},_e=()=>{const o=l.value;let p=`image/${["jpeg","jpg"].includes(A.value)?"jpeg":"png"}`;const m=o.toDataURL(p),b=`imeme_${n.value.title}_${v.value}`,w=document.createElement("a");w.setAttribute("download",b),w.setAttribute("href",m),w.setAttribute("target","_blank"),w.click()},he=()=>{c.value?t("change",n.value):_.value||(t("create",n.value),c.value=!0)},ye=({name:o,base64:g})=>{_.value=!1;const{mid:p,title:m,feature:b,image:w,x:D,y:k,max:q,font:G,color:xe,align:be}=n.value;x={mid:p,title:m,feature:b,image:w,x:D,y:k,max:q,font:G,color:xe,align:be};const ee=o.slice(0,o.lastIndexOf("."));Q({mid:`meme_${new Date().getTime()}`,title:ee,feature:ee,image:g,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start"})},Q=o=>{t("replace",o)};return re(()=>{z()}),(o,g)=>(h(),$("div",tt,[y("div",at,[y("div",nt,V(`${d(n).title}.${d(A)}`),1),F(d(J),{label:c.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:fe},null,8,["label"]),F(d(J),{label:"\u4E0B\u8F7D",u:"primary",onClick:_e})]),!c.value&&_.value?(h(),$("div",lt,[F(d(Ze),{onChange:ye})])):(h(),$(W,{key:1},[y("div",st,[y("canvas",{class:"container-canvas",ref:(p,m)=>{m.canvasRef=p,l.value=p}},null,512),y("div",{class:"container-area",ref:(p,m)=>{m.areaRef=p,r.value=p},onMousemove:me,onMouseup:ve},[y("div",{class:"container-drag",ref:(p,m)=>{m.dragRef=p,i.value=p},onMousedown:ge},null,544)],544)]),F(et,{max:d(n).max,color:d(n).color,size:d(L),align:d(n).align,onChange:S},null,8,["max","color","size","align"])],64)),y("footer",ot,[F(d(J),{label:c.value?"\u66F4\u65B0":"\u6DFB\u52A0",u:"primary",onClick:he},null,8,["label"])])]))}}),de={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"}},ut=()=>"https://imeme.vercel.app";var it=a=>async(t={},s={})=>{const{url:n,method:l}=a,r=ut();return Be.request({withCredentials:!1,url:r+n,method:l,[l==="get"?"params":"data"]:t}).then(i=>{const c=i.data;return(s==null?void 0:s.stream)?i:c.errNo===0?c.data:Promise.reject(c)}).catch(i=>Promise.reject(i))};const P={};for(const a in de)P[a]=it(de[a]);const ct={class:"image-wrap"},dt=B({setup(a){const t=C([]),s=C(""),n=C("");let l=C({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start"});const r=async()=>{const f=await P.getCatalog({});t.value=f},i=({type:f,mid:e})=>{s.value!==e&&(s.value=e,n.value=f)};Y([s,n],()=>{c(s.value,n.value)});const c=(f,e)=>{P.openImage({mid:f,type:e}).then(u=>{l.value=u})},_=f=>{const e=ne(K({},f),{image:""});P.saveImage(e)},x=f=>{l.value=f},v=async f=>{const e=await P.createImage(f);await r(),s.value=e.mid};return re(()=>{r()}),(f,e)=>(h(),$("div",ct,[F(Ve,{current:s.value,"catalog-list":t.value,onChange:i},null,8,["current","catalog-list"]),d(l).image&&d(l).mid?(h(),ue(rt,{key:0,story:d(l),onChange:_,onReplace:x,onCreate:v},null,8,["story"])):Ee("",!0)]))}});const pt=B({setup(a){return(t,s)=>(h(),ue(dt))}});Ie(pt).mount("#app");
