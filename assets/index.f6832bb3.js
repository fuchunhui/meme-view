var rt=Object.defineProperty,ut=Object.defineProperties;var ct=Object.getOwnPropertyDescriptors;var je=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,dt=Object.prototype.propertyIsEnumerable;var We=(t,a,l)=>a in t?rt(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,Pe=(t,a)=>{for(var l in a||(a={}))it.call(a,l)&&We(t,l,a[l]);if(je)for(var l of je(a))dt.call(a,l)&&We(t,l,a[l]);return t},Oe=(t,a)=>ut(t,ct(a));import{r as vt,c as ae,o as $,d as U,t as re,a as B,F as ye,b as Ve,u as o,e as b,f as ne,n as me,g as pt,h as gt,i as x,w as ht,j as xe,k as ue,l as N,m as He,p as S,q as ce,s as we,v as $e,x as Ce,y as Ge,z as ft,A as mt,B as Ue,C as _t,D as yt,E as xt}from"./vendor.9cc933d0.js";const wt=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function l(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerpolicy&&(r.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?r.credentials="include":n.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(n){if(n.ep)return;n.ep=!0;const r=l(n);fetch(n.href,r)}};wt();var Ke=(t,a)=>{const l=t.__vccOpts||t;for(const[e,n]of a)l[e]=n;return l};const $t={};function Ct(t,a){const l=vt("router-view");return $(),ae(l)}var bt=Ke($t,[["render",Ct]]);const Ft={class:"side"},kt={class:"side-content-title"},Mt=["onClick"],Dt=U({props:{catalogList:null,current:null},emits:["change"],setup(t,{emit:a}){const e=re(t).catalogList,n=(r,c)=>{a("change",{type:r,child:c})};return(r,c)=>($(),B("div",Ft,[($(!0),B(ye,null,Ve(o(e),d=>($(),B("div",{key:d.id,class:"side-content"},[b("p",kt,ne(d.text),1),($(!0),B(ye,null,Ve(d.children,_=>($(),B("div",{key:_.mid,class:me({"side-content-cell":!0,"side-content-cell-active":t.current===_.mid}),onClick:F=>n(d.type,_)},ne(_.title),11,Mt))),128))]))),128))]))}});const le=U({props:{label:{type:String,default:"\u63D0\u4EA4"},disabled:{type:Boolean,default:!1}},setup(t){return(a,l)=>($(),B("button",{class:me(["meme-button",{disabled:t.disabled}])},[pt(a.$slots,"default",{},()=>[gt(ne(t.label),1)])],2))}});const Et=U({name:"Input",props:{modelValue:{type:[String,Number],default:""},title:{type:String,default:""},disabled:{type:Boolean,default:!1}},emits:["update:modelValue","blur"],setup(t,{emit:a}){const l=x(null),e=r=>{a("update:modelValue",r.target.value)};return{input:l,blur:r=>{e(r),a("blur")}}}}),Tt=["title","value"];function It(t,a,l,e,n,r){return $(),B("input",{ref:"input",class:me(["meme-input",{disabled:t.disabled}]),title:t.title,value:t.modelValue,onBlur:a[0]||(a[0]=(...c)=>t.blur&&t.blur(...c)),onKeyup:a[1]||(a[1]=ht(c=>{var d;return(d=t.input)==null?void 0:d.blur()},["enter"]))},null,42,Tt)}var oe=Ke(Et,[["render",It]]);const Bt=500,St=300;U({name:"Loading",props:{show:{type:Boolean,default:!0},min:{type:Number,default:Bt},interval:{type:Number,default:St}},created(){this.showChange(this.show)},setup(t){const{show:a,interval:l,min:e}=re(t),n=x(a.value);let r,c=0;const d=()=>{const k=new Date().getTime()-c;k>e.value?n.value=!1:setTimeout(()=>{n.value=!1},Math.max(e.value-k,0))},_=F=>{F?l.value===0?(n.value=!0,c=new Date().getTime()):r=window.setTimeout(()=>{n.value=!0,c=new Date().getTime()},l.value):(clearTimeout(r),d())};return xe(a,()=>{_(a.value)}),{localShow:n,showChange:_}}});const Rt={class:"meme-radio"},Lt=["name","value","checked"],zt={class:"meme-radio-label"},_e=U({props:{label:null,name:null,value:null,checked:{type:Boolean}},emits:["toggle"],setup(t,{emit:a}){const l=e=>{a("toggle",e)};return(e,n)=>($(),B("label",Rt,[b("input",{class:"meme-radio-input",type:"radio",name:t.name,value:t.value,checked:t.checked,onChange:n[0]||(n[0]=r=>l(t.value))},null,40,Lt),b("span",zt,ne(t.label),1)]))}});const At={class:"meme-file-upload"},Pt={class:"file-button"},Vt=b("i",{class:"file-glyphicon"},null,-1),Ut=b("span",null,"UPLOAD FILE",-1),Nt=b("i",{class:"file-tips"},"Drop files here to upload",-1),Xt=[Nt],Yt=U({emits:["change"],setup(t,{emit:a}){const l=ue("commands"),e=m=>{const y=m.target.files;if(!y)return!1;k(y)},n=m=>{m.stopPropagation(),m.preventDefault()},r=m=>{m.stopPropagation(),m.preventDefault()},c=m=>{m.stopPropagation(),m.preventDefault();const y=m.dataTransfer.files;k(y)},d=m=>{m.stopPropagation(),m.preventDefault();const y=m.clipboardData.files;k(y)},_=1*1024*1024,F=/^image\//,k=m=>{if(m.length!==1)return h("\u4E0D\u652F\u6301\u591A\u4E2A\u6587\u4EF6\u540C\u65F6\u64CD\u4F5C\uFF0C\u8BF7\u4EC5\u9009\u62E9\u5355\u4E2A\u6587\u4EF6"),!1;const y=m[0],{name:p,size:v,type:C}=y;if(!F.test(C))return h(`\u5F53\u524D\u6587\u4EF6\u7C7B\u578B\u4E3A${C}\uFF0C\u7C7B\u578B\u4E0D\u7B26\uFF0C\u8BF7\u9009\u62E9\u56FE\u7247\u7C7B\u578B\uFF01`),!1;const R=p.replace(/\.\w*$/g,"");if(l.value.includes(R))return h(`\u5F53\u524D\u6587\u4EF6\u540D\u79F0\u3010${p}\u3011\u4E0E\u7CFB\u7EDF\u9ED8\u8BA4\u5173\u952E\u6307\u4EE4\u3010${R}\u3011\u51B2\u7A81\uFF0C\u8BF7\u91CD\u547D\u540D\u4E0A\u4F20\u6587\u4EF6\uFF01`),!1;if(v>_)return h("\u6587\u4EF6\u8D85\u8FC7\u6700\u5927\u9650\u52361M\uFF0C\u8BF7\u91CD\u65B0\u9009\u62E9"),!1;const T=new FileReader;T.onload=A=>{const P=A.target.result;E(p,P)},T.onerror=()=>{h(T.error.message)},T.readAsDataURL(y)},h=m=>{alert(m)},E=(m,y)=>{a("change",{name:m,base64:y})};return(m,y)=>($(),B("div",At,[b("div",Pt,[Vt,Ut,b("input",{class:"file-input",type:"file",name:"file",accept:"image/*",title:"",onChange:e},null,32)]),b("div",{class:"file-area",draggable:!0,contenteditable:!0,onDragenter:n,onDragover:r,onDrop:c,onPaste:d},Xt,32)]))}});const jt=["value","selected"],Wt=U({props:{options:null,selected:null},emits:["change","update:model-value"],setup(t,{emit:a}){const l=e=>{const n=e.target.value;e.target.blur(),a("update:model-value",n),a("change",n)};return(e,n)=>($(),B("select",{class:"meme-select",onChange:l},[($(!0),B(ye,null,Ve(t.options,r=>($(),B("option",{key:r.value,class:"meme-option",value:r.value,selected:t.selected===r.value},ne(r.label),9,jt))),128))],32))}});const Ot={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Ht=b("title",null,"dice",-1),Gt=["fill"],Kt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const l=t,e=N(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),n=()=>{a("click")};return(r,c)=>($(),ae(o(le),{class:"dice-button",u:"icon",onClick:n},{default:He(()=>[($(),B("svg",Ot,[Ht,b("path",{fill:o(e),d:"M27 6h-16c-2.75 0-5 2.25-5 5v16c0 2.75 2.25 5 5 5h16c2.75 0 5-2.25 5-5v-16c0-2.75-2.25-5-5-5zM13 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM13 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM19 22c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 28c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25 16c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zM25.899 4c-0.467-2.275-2.491-4-4.899-4h-16c-2.75 0-5 2.25-5 5v16c0 2.408 1.725 4.432 4 4.899v-19.899c0-1.1 0.9-2 2-2h19.899z"},null,8,Gt)]))]),_:1}))}});const qt={version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 32 32"},Jt=b("title",null,"picker",-1),Zt=["fill"],Qt=U({props:{color:{type:String,default:"#FF0000"}},emits:["click"],setup(t,{emit:a}){const l=t,e=N(()=>["transparent","#FFFFFF"].includes(l.color)?"gray":l.color),n=()=>{a("click")};return(r,c)=>($(),ae(o(le),{class:"picker-button",u:"icon",onClick:n},{default:He(()=>[($(),B("svg",qt,[Jt,b("path",{fill:o(e),d:"M30.828 1.172c-1.562-1.562-4.095-1.562-5.657 0l-5.379 5.379-3.793-3.793-4.243 4.243 3.326 3.326-14.754 14.754c-0.252 0.252-0.358 0.592-0.322 0.921h-0.008v5c0 0.552 0.448 1 1 1h5c0 0 0.083 0 0.125 0 0.288 0 0.576-0.11 0.795-0.329l14.754-14.754 3.326 3.326 4.243-4.243-3.793-3.793 5.379-5.379c1.562-1.562 1.562-4.095 0-5.657zM5.409 30h-3.409v-3.409l14.674-14.674 3.409 3.409-14.674 14.674z"},null,8,Zt)]))]),_:1}))}});const ea={class:"property"},qe=U({props:{max:null,size:null,color:null,align:null,direction:null,blur:null},emits:["change","pick"],setup(t,{emit:a}){const l=t,e=ue("text"),n=ue("updateText"),{max:r,size:c,color:d,align:_,direction:F,blur:k}=re(l),h=(y,p)=>{const v={max:r.value,size:c.value,color:d.value,align:_.value,direction:F.value,blur:k.value};v[p]=["color","align","direction"].includes(p)?y:parseInt(y),a("change",v)},E=()=>{const y="#"+Math.floor(Math.random()*16777215).toString(16);h(y,"color")},m=()=>{a("pick")};return(y,p)=>($(),B("div",ea,[S(o(oe),{class:"property-max",value:o(r),"onUpdate:modelValue":p[0]||(p[0]=v=>h(v,"max"))},null,8,["value"]),S(o(oe),{class:"property-size",value:o(c),"onUpdate:modelValue":p[1]||(p[1]=v=>h(v,"size"))},null,8,["value"]),S(o(oe),{class:"property-color",value:o(d),"onUpdate:modelValue":p[2]||(p[2]=v=>h(v,"color"))},null,8,["value"]),S(Kt,{color:o(d),onClick:E},null,8,["color"]),S(Qt,{color:o(d),onClick:m},null,8,["color"]),S(o(_e),{label:"start",name:"align",value:"start",checked:o(_)==="start",onToggle:p[3]||(p[3]=v=>h(v,"align"))},null,8,["checked"]),S(o(_e),{label:"center",name:"align",value:"center",checked:o(_)==="center",onToggle:p[4]||(p[4]=v=>h(v,"align"))},null,8,["checked"]),S(o(_e),{class:"property-end",label:"end",name:"align",value:"end",checked:o(_)==="end",onToggle:p[5]||(p[5]=v=>h(v,"align"))},null,8,["checked"]),S(o(oe),{class:"property-text",value:o(e),"onUpdate:modelValue":o(n)},null,8,["value","onUpdate:modelValue"]),S(o(_e),{label:"up",name:"direction",value:"up",checked:o(F)==="up",onToggle:p[6]||(p[6]=v=>h(v,"direction"))},null,8,["checked"]),S(o(_e),{label:"down",name:"direction",value:"down",checked:o(F)==="down",onToggle:p[7]||(p[7]=v=>h(v,"direction"))},null,8,["checked"])]))}}),Ne=1.2,X=11,W=14,Je=W*X,Ze=W*X,ie=W*X,Qe=W,ta=(()=>{const t=[];for(let a=1;a<X;a++)t.push([a,0,a,X]),t.push([0,a,X,a]);return t.map(a=>a.map(l=>l*W))})(),aa=(t,a,l)=>{let e=0,n=t.length-1;for(;e<=n;){const r=Math.floor((e+n)/2),c=l.measureText(t.substring(0,r)).width,d=l.measureText(t.substring(0,r+1)).width;if(c<=a&&d>a)return r;c<a?e=r+1:n=r-1}return-1},na=(t,a,l)=>{const e=[];let n=0;for(;(n=aa(t,a,l))!==-1;)e.push(t.substring(0,n)),t=t.substring(n);return t&&e.push(t),e},Xe=(t,a,l,e)=>{const{x:n,y:r,font:c,color:d,align:_,max:F,direction:k,blur:h}=e;t.font=c||"32px sans-serif",t.fillStyle=d||"#000000",h&&(t.filter=`blur(${h}px)`),t.textAlign=_||"center";const E=F||a,m=be(c),y=na(l,E,t);y.forEach((p,v)=>{const C=k==="down"?v:v-(y.length-1);t.fillText(p,n,r+C*m*Ne,E)})},la=t=>{t.imageSmoothingEnabled=!1,t.lineCap="round",t.beginPath(),t.strokeStyle="#000000",t.arc(X*W/2,X*W/2,X*W/2-1,0,Math.PI*2),t.stroke(),t.clip(),t.strokeStyle="#D6D6D6",ta.forEach(a=>{const{0:l,1:e,2:n,3:r}=a;t.moveTo(l,e),t.lineTo(n,r)}),t.stroke(),t.beginPath(),t.strokeStyle="#FF0000",t.rect((X-1)*W/2,(X-1)*W/2,1*W,1*W),t.stroke()},et=(t,a,l,e)=>{a.style.left=`${l+Qe}px`,a.style.top=`${e+Qe}px`;const n=a.getContext("2d"),r=Math.min(Math.max(0,l-5),t.width-X),c=Math.min(Math.max(0,e-5),t.height-X);n.clearRect(0,0,Je,Ze),n.drawImage(t,r,c,X,X,0,0,Je,Ze),la(n)},be=t=>{const a=t.match(/(\d{1,3})px/)||["","32"];return Number(a[1])},tt=t=>{var e;return((e=t.split(";base64,")[0].match(/[a-z]+$/g))==null?void 0:e[0])||"png"},at=(t,a,l)=>{const n=`image/${["jpeg","jpg"].includes(a)?"jpeg":"png"}`,r=t.toDataURL(n),c=document.createElement("a");c.setAttribute("download",l),c.setAttribute("href",r),c.setAttribute("target","_blank"),c.click()};const oa={class:"container"},sa={class:"container-header"},ra={class:"container-title"},ua={key:0,class:"container-wall"},ca={class:"container-wraper"},ia=["width","height"],da={class:"container-footer"},va=U({props:{story:null},emits:["change","create","replace"],setup(t,{emit:a}){const e=re(t).story,n=x(null),r=x(null),c=x(null),d=x(!0),_=x(!0);let F=null;const k=x(!1),h=x(!1),E=x(null),m=x("\u91D1\u9986\u957F"),y=i=>{m.value=i,G()};ce("text",m),ce("updateText",y);const p=x(0),v=x(0),C=(i,f)=>{e.value.x=i,e.value.y=f},R=i=>{const{max:f,size:M,color:D,align:j,direction:q,blur:Y}=i;e.value.max=f,e.value.font=`${M}px sans-serif`,e.value.color=D,e.value.align=j,e.value.direction=q,e.value.blur=Y},T=N(()=>be(e.value.font)),A=N(()=>tt(e.value.image)),P=N(()=>`${e.value.title}.${A.value} ${p.value} * ${v.value} (${e.value.x}, ${e.value.y})`),de=N(()=>{const i=e.value.max||p.value;return{start:0,center:Math.floor(i/2),end:i}[e.value.align]}),ee=new Image,ve=()=>{ee.onload=async()=>{const i=n.value;i.width=ee.naturalWidth,i.height=ee.naturalHeight,p.value=i.width,v.value=i.height,se(),G(),pe()},ee.onerror=i=>{console.error(i)},ee.src=e.value.image},se=()=>{const i=r.value;i.style.width=`${p.value}px`,i.style.height=`${v.value}px`},G=()=>{const i=n.value,f=i.getContext("2d");f.drawImage(ee,0,0),Xe(f,i.width,m.value,e.value)},pe=()=>{const{x:i,y:f,max:M}=e.value,D=c.value;D.style.width=`${M}px`,D.style.height=`${T.value*Ne}px`,D.style.top=`${f-T.value+2}px`,D.style.left=`${i-de.value}px`};xe(e,(i,f)=>{i.mid!==f.mid?ve():(G(),pe())},{deep:!0});let ge=0,Z=0;const O=20;let Q=!1;const he=i=>{Q=!0;const{clientX:f,clientY:M}=i;ge=f,Z=M},K=i=>{if(!Q)return;const{clientX:f,clientY:M}=i,D=c.value,{width:j,height:q}=D.getBoundingClientRect();let Y=D.offsetLeft+f-ge,J=D.offsetTop+M-Z;Y<-O||J<-O||Y>p.value-j+O||J>v.value-q+O?Q=!1:(ge=f,Z=M),Y=Math.max(Math.min(Y,p.value-j+O),-O),J=Math.max(Math.min(J,v.value-q+O),-O),Y+=de.value,J+=T.value-2,C(Y,J)},te=()=>{!Q||(Q=!1)},Fe=()=>{d.value?d.value=!1:(d.value=!0,_.value=!0,F?(fe(F),F=null):ve())},ke=()=>{F&&(fe(F),F=null)},Me=()=>{const i=n.value,f=`imeme_${e.value.title}_${m.value}`;at(i,A.value,f)},De=()=>{d.value?a("change",e.value):_.value||(a("create",e.value,ke),d.value=!0,_.value=!0)},Ee=({name:i,base64:f})=>{_.value=!1;const{mid:M,title:D,feature:j,image:q,x:Y,y:J,max:s,font:u,color:g,align:w,direction:I,senior:z,blur:L}=e.value;F={mid:M,title:D,feature:j,image:q,x:Y,y:J,max:s,font:u,color:g,align:w,direction:I,senior:z,blur:L};const V=i.slice(0,i.lastIndexOf("."));fe({mid:`meme_${new Date().getTime()}`,title:V,feature:V,image:f,x:60,y:60,max:100,font:"32px sans-serif",color:"#FF0000",align:"start",direction:"down",blur:0,senior:0})},fe=i=>{a("replace",i)},Te=()=>{k.value=!0},Ie=(i,f)=>{const M=n.value,D=E.value;et(M,D,i,f)},Be=async i=>{if(!k.value)return!1;const{offsetX:f,offsetY:M}=i;f<0||M<0||(h.value=!0,Ie(f,M))},Se=()=>{if(!k.value)return!1;h.value=!1},Re=i=>{const f=Y=>Y.toString(16).padStart(2,"0"),{0:M,1:D,2:j,3:q}=i.data;return`#${f(M)}${f(D)}${f(j)}${f(q)}`.toUpperCase()},Le=(i,f)=>{const j=n.value.getContext("2d").getImageData(i,f,1,1);return Re(j)},ze=i=>{if(!k.value)return!1;const{offsetX:f,offsetY:M}=i;if(f<0||M<0)return;const D=Le(f,M);e.value.color=D,h.value=!1,k.value=!1};return we(()=>{ve()}),(i,f)=>($(),B("div",oa,[b("div",sa,[b("div",ra,ne(o(P)),1),S(o(le),{label:d.value?"\u6DFB\u52A0":"\u53D6\u6D88\u6DFB\u52A0",u:"primary",onClick:Fe},null,8,["label"]),S(o(le),{label:"\u4E0B\u8F7D",u:"primary",onClick:Me})]),!d.value&&_.value?($(),B("div",ua,[S(o(Yt),{onChange:Ee})])):($(),B(ye,{key:1},[b("div",ca,[b("canvas",{ref_key:"canvasRef",ref:n,class:me({"container-canvas":!0,"container-pointer":k.value}),onMousemove:Be,onMouseleave:Se,onClick:ze},null,34),$e(b("div",{class:"container-area",ref_key:"areaRef",ref:r,onMousemove:K,onMouseup:te},[b("div",{class:"container-drag",ref_key:"dragRef",ref:c,onMousedown:he},null,544)],544),[[Ce,!k.value]]),$e(b("canvas",{ref_key:"layerRef",ref:E,class:"container-layer",style:Ge({borderRadius:`${o(ie)}px`}),width:o(ie),height:o(ie)},null,12,ia),[[Ce,k.value&&h.value]])]),S(qe,{max:o(e).max,color:o(e).color,size:o(T),align:o(e).align,direction:o(e).direction,blur:o(e).blur,onChange:R,onPick:Te},null,8,["max","color","size","align","direction","blur"])],64)),b("footer",da,[S(o(le),{label:d.value?"\u66F4\u65B0":"\u786E\u8BA4",u:"primary",onClick:De},null,8,["label"])])]))}});const pa={class:"feature-property"},ga=U({props:{width:null,height:null,ipath:null},emits:["change"],setup(t,{emit:a}){const l=t,e=ue("text"),n=ue("updateText"),r=ue("paths"),{width:c,height:d,ipath:_}=re(l),F=(k,h)=>{const E={width:c.value,height:d.value,ipath:_.value};E[h]=["ipath"].includes(h)?k:parseInt(k),a("change",E)};return(k,h)=>($(),B("div",pa,[S(o(oe),{class:"feature-property-size",value:o(c),"onUpdate:modelValue":h[0]||(h[0]=E=>F(E,"width"))},null,8,["value"]),S(o(oe),{class:"feature-property-size",value:o(d),"onUpdate:modelValue":h[1]||(h[1]=E=>F(E,"height"))},null,8,["value"]),S(o(Wt),{class:"feature-property-path",options:o(r),selected:o(_),"onUpdate:modelValue":h[2]||(h[2]=E=>F(E,"ipath"))},null,8,["options","selected"]),S(o(oe),{class:"feature-property-text",value:o(e),"onUpdate:modelValue":o(n)},null,8,["value","onUpdate:modelValue"])]))}}),nt={getCatalog:{url:"/image/catalog",method:"get"},openImage:{url:"/image/open",method:"get"},saveImage:{url:"/image/save",method:"post"},createImage:{url:"/image/create",method:"post"},getConfig:{url:"/image/config",method:"get"},getFeatureImage:{url:"/image/feature/open",method:"get"},saveFeatureImage:{url:"/image/feature/save",method:"post"},getMaterialBase64:{url:"/material/base64",method:"get"},getMaterialCatalog:{url:"/material/catalog",method:"get"}},ha=()=>"https://imeme.vercel.app";var fa=t=>async(a={},l={})=>{const{url:e,method:n}=t,r=ha();return ft.request({withCredentials:!1,url:r+e,method:n,[n==="get"?"params":"data"]:a}).then(c=>{const d=c.data;return(l==null?void 0:l.stream)?c:d.errNo===0?d.data:Promise.reject(d)}).catch(c=>Promise.reject(c))};const H={};for(const t in nt)H[t]=fa(nt[t]);const ma={class:"container"},_a={class:"container-header"},ya={class:"container-title"},xa=["onMousedown"],wa=["width","height"],$a={class:"container-footer"},Ca=U({props:{feature:null},emits:["change"],setup(t,{emit:a}){const e=re(t).feature,n=x(null),r=x(null),c=x(null),d=x(!1),_=x(!1),F=x(null),k="\u91D1\u9986\u957F",h=x("\u91D1\u9986\u957F"),E=x(""),m=s=>{h.value=s,v.value?Z():H.getMaterialBase64({ipath:P.value.ipath,value:s}).then(u=>{E.value=u,u?se.src=u:Z()})};ce("text",h),ce("updateText",m);const y=x(0),p=x(0),v=N(()=>e.value.type==="TEXT"),C=N(()=>{var s;return v.value?be((s=e.value.et)==null?void 0:s.font):0}),R=N(()=>tt(e.value.story.image)),T=N(()=>{const s=v.value?A.value:P.value;return`${e.value.story.title}.${R.value} ${y.value} * ${p.value} (${s.x}, ${s.y})`}),A=N(()=>e.value.et),P=N(()=>e.value.ei),de=N(()=>{if(v.value){const s=A.value.max||y.value;return{start:0,center:Math.floor(s/2),end:s}[A.value.align]}return 0}),ee=N(()=>{const{font:s,color:u,direction:g,blur:w}=e.value.story,{x:I,y:z,width:L}=P.value;return{x:I+L/2,y:z+be(s),max:L,font:s,color:u,align:"center",direction:g,blur:w}}),ve=s=>{const{max:u,size:g,color:w,align:I,direction:z,blur:L}=s;e.value.et.max=u,e.value.et.font=`${g}px sans-serif`,e.value.et.color=w,e.value.et.align=I,e.value.et.direction=z,e.value.et.blur=L},se=new Image;se.onerror=s=>{console.error(s)},se.onload=()=>{Z()};const G=new Image,pe=()=>{G.onload=async()=>{const s=n.value;s.width=G.naturalWidth,s.height=G.naturalHeight,y.value=s.width,p.value=s.height,ge(),Z(),O()},G.onerror=s=>{console.error(s)},G.src=e.value.story.image},ge=()=>{const s=r.value;s.style.width=`${y.value}px`,s.style.height=`${p.value}px`},Z=()=>{const s=n.value,u=s.getContext("2d");if(u.drawImage(G,0,0),u.save(),Xe(u,s.width,k,e.value.story),v.value||!v.value&&!E.value){const g=v.value?A.value:ee.value;u.restore(),Xe(u,s.width,h.value,g)}else{const{x:g,y:w,width:I,height:z}=P.value;u.drawImage(se,g,w,I,z)}},O=()=>{let s=0,u=0,g=0,w=0;if(v.value){const{x:z,y:L,max:V}=A.value;s=V,u=C.value*Ne,g=L-C.value+2,w=z-de.value}else{const{x:z,y:L,width:V,height:Ae}=P.value;s=V,u=Ae,g=L,w=z}const I=c.value;I.style.width=`${s}px`,I.style.height=`${u}px`,I.style.top=`${g}px`,I.style.left=`${w}px`};xe(e,(s,u)=>{s.mid!==u.mid?pe():(Z(),O())},{deep:!0});let Q=0,he=0;const K=20;let te=!1;const Fe=s=>{te=!0;const{clientX:u,clientY:g}=s;Q=u,he=g},ke=s=>{if(!te)return;const{clientX:u,clientY:g}=s,w=c.value,{width:I,height:z}=w.getBoundingClientRect();let L=w.offsetLeft+u-Q,V=w.offsetTop+g-he;L<-K||V<-K||L>y.value-I+K||V>p.value-z+K?te=!1:(Q=u,he=g),L=Math.max(Math.min(L,y.value-I+K),-K),V=Math.max(Math.min(V,p.value-z+K),-K),Me(L,V)},Me=(s,u)=>{v.value?(A.value.x=s+de.value,A.value.y=u+C.value-2):(P.value.x=s,P.value.y=u)},De=()=>{!te||(te=!1)},Ee=()=>{const s=n.value,u=`imeme_${e.value.story.title}_${h.value}`;at(s,R.value,u)},fe=()=>{const{mid:s,type:u,et:g,ei:w}=e.value;a("change",{mid:s,type:u,options:v.value?g:w})},Te=()=>{d.value=!0},Ie=(s,u)=>{const g=n.value,w=F.value;et(g,w,s,u)},Be=async s=>{if(!d.value)return!1;const{offsetX:u,offsetY:g}=s;u<0||g<0||(_.value=!0,Ie(u,g))},Se=()=>{if(!d.value)return!1;_.value=!1},Re=s=>{const u=L=>L.toString(16).padStart(2,"0"),{0:g,1:w,2:I,3:z}=s.data;return`#${u(g)}${u(w)}${u(I)}${u(z)}`.toUpperCase()},Le=(s,u)=>{const I=n.value.getContext("2d").getImageData(s,u,1,1);return Re(I)},ze=s=>{if(!d.value)return!1;const{offsetX:u,offsetY:g}=s;if(u<0||g<0)return;const w=Le(u,g);e.value.et.color=w,_.value=!1,d.value=!1},i=x(null);let f=0,M=0,D=!1;const j=s=>{D=!0;const{clientX:u,clientY:g}=s;f=u,M=g},q=s=>{if(!D)return;const{clientX:u,clientY:g}=s,w=r.value,{x:I,y:z,width:L,height:V}=w.getBoundingClientRect();if(u<I||g<z||u>I+L||g>z+V){D=!1;return}const Ae=u-f,lt=g-M,{width:ot,height:st}=P.value,Ye=c.value;Ye.style.width=`${ot+Ae}px`,Ye.style.height=`${st+lt}px`},Y=s=>{if(!D)return;D=!1;const{clientX:u,clientY:g}=s,w=u-f,I=g-M,{width:z,height:L}=P.value;P.value.width=z+w,P.value.height=L+I},J=s=>{const{width:u,height:g,ipath:w}=s;e.value.ei.width=u,e.value.ei.height=g,e.value.ei.ipath=w};return we(()=>{pe()}),(s,u)=>($(),B("div",ma,[b("div",_a,[b("div",ya,ne(o(T)),1),S(o(le),{label:"\u4E0B\u8F7D",u:"primary",onClick:Ee})]),b("div",{class:"container-wraper",onMousemove:q,onMouseup:Y},[b("canvas",{ref_key:"canvasRef",ref:n,class:me({"container-canvas":!0,"container-pointer":d.value}),onMousemove:Be,onMouseleave:Se,onClick:ze},null,34),$e(b("div",{class:"container-area",ref_key:"areaRef",ref:r,onMousemove:ke,onMouseup:De},[b("div",{class:"container-drag",ref_key:"dragRef",ref:c,onMousedown:Fe},[o(v)?Ue("",!0):($(),B("div",{key:0,ref_key:"cornerRef",ref:i,class:"container-drag-corner",onMousedown:mt(j,["stop","prevent"])},null,40,xa))],544)],544),[[Ce,!d.value]]),$e(b("canvas",{ref_key:"layerRef",ref:F,class:"container-layer",style:Ge({borderRadius:`${o(ie)}px`}),width:o(ie),height:o(ie)},null,12,wa),[[Ce,d.value&&_.value]])],32),o(v)?($(),ae(qe,{key:0,max:o(A).max,color:o(A).color,size:o(C),align:o(A).align,direction:o(A).direction,blur:o(A).blur,onChange:ve,onPick:Te},null,8,["max","color","size","align","direction","blur"])):($(),ae(ga,{key:1,width:o(P).width,height:o(P).height,ipath:o(P).ipath,onChange:J},null,8,["width","height","ipath"])),b("footer",$a,[S(o(le),{label:"\u66F4\u65B0",u:"primary",onClick:fe})])]))}});const ba={class:"image-wrap"},Fa=U({setup(t){const a=x([]),l=x(""),e=x("");let n=x({mid:"",title:"",feature:"",image:"",x:0,y:0,max:100,font:"32px sans-serif",color:"#FFFFFF",align:"start",direction:"down",blur:0,senior:0}),r=x({mid:"",feature:"",type:"",story:n});const c=async()=>{const C=await H.getCatalog({});a.value=C},d=({type:C,child:R})=>{l.value!==R.mid&&(l.value=R.mid,e.value=C)};xe([l,e],()=>{_(l.value,e.value)});const _=(C,R)=>{p.value?H.openImage({mid:C,type:R}).then(T=>{n.value=T}):H.getFeatureImage({mid:C}).then(T=>{r.value=T})},F=C=>{const R=Oe(Pe({},C),{image:""});H.saveImage(R)},k=C=>{n.value=C},h=async(C,R)=>{const T=await H.createImage(C).catch(A=>{alert(A.message)});T?(await c(),l.value=T.mid):R()},E=x([]),m=x();ce("commands",E),ce("paths",m);const y=async()=>{const{commands:C,paths:R}=await H.getConfig({});E.value=C,m.value=R.map(T=>({label:T,value:T}))},p=N(()=>["STORY","SERIES","SPECIAL"].includes(e.value)),v=({mid:C,type:R,options:T})=>{R==="TEXT"?H.saveImage(T):H.saveFeatureImage(Pe({mid:C,type:R},T))};return we(()=>{c(),y()}),(C,R)=>($(),B("div",ba,[S(Dt,{current:l.value,"catalog-list":a.value,onChange:d},null,8,["current","catalog-list"]),o(p)&&o(n).image&&o(n).mid?($(),ae(va,{key:0,story:o(n),onChange:F,onReplace:k,onCreate:h},null,8,["story"])):Ue("",!0),e.value==="FEATURE"&&o(r).mid?($(),ae(Ca,{key:1,feature:o(r),onChange:v},null,8,["feature"])):Ue("",!0)]))}});const ka={class:"material-center"},Ma=U({setup(t){const a=()=>{H.getMaterialCatalog({type:"DB".toLowerCase()}).then(l=>{console.log(l)})};return we(()=>{a()}),(l,e)=>($(),B("div",ka," \u4EC0\u4E48\u90FD\u6CA1\u6709\u7684\u8352\u539F "))}}),Da=[{path:"/",component:Fa},{path:"/center",component:Ma}],Ea=_t({history:yt(),routes:Da});xt(bt).use(Ea).mount("#app");
